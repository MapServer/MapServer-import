<?xml version='1.0' standalone='no'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">

<article>

<articleinfo>
  <!-- insert title here, include the word HOWTO -->
  <title>HOWTO template for MapServer Documentation</title>

  <author>
     <firstname>Jamie</firstname>
     <surname>Smedsmo</surname>
     <affiliation>
        <orgname>University of Minnesota, Department of Forest Resources</orgname>
         <orgdiv>TerraSIP Project</orgdiv>
        <address>
            <email>jsmedsmo@gis.umn.edu</email>
        </address>
     </affiliation>
  </author>
  
  <author>
     <firstname>Ken</firstname>
     <surname>Boss</surname>
     <affiliation>
        <orgname>Minnesota Department of Natural Resources</orgname>
        <orgdiv>Forestry Resource Assessment</orgdiv>
        <address>
          <email>kenboss@dilbert.dnr.state.mn.us</email>
        </address>
     </affiliation>
  </author>

  <author>
     <firstname>Jean-Francois</firstname>
     <surname>Doyon</surname>
     <affiliation>
        <orgname>Natural Resources Canada</orgname>
         <orgdiv>GeoAccess Division</orgdiv>
        <address>
            <email>jdoyon@nrcan.gc.ca</email>
        </address>
     </affiliation>
  </author>
  <author>
    <firstname>Jeff</firstname>
    <surname>McKenna</surname>
    <affiliation>
      <orgname>DM Solutions Group Inc.</orgname>
      <address>
        <email>mckenna@dmsolutions.ca</email>
      </address>
    </affiliation>
  </author>  

<!-- TRANSLATORS to other languages will be specified in the "contrib" tag -->
  <othercredit>
     <contrib>Translation</contrib>
     <firstname>Jamie</firstname>
     <surname>Smedsmo</surname>
     <affiliation>
        <orgname>University of Minnesota, Department of Forest Resources</orgname>
         <orgdiv>TerraSIP Project</orgdiv>
        <address>
            <email>jsmedsmo@gis.umn.edu</email>
        </address>
     </affiliation>
  </othercredit>

  <abstract>  <!-- a short description of the contents of the doc -->
    <para>
    This document describes a suggested structure for an MDP HOWTO, including 
    explanations of each section and examples of DocBook markup tags.  <emphasis>
    The author should include the version of MapServer described in this HOWTO.</emphasis>
    Information given here refers to MapServer version 3.5.
    </para>

    <para>Last Updated:  06-14-2002</para>
  </abstract>

</articleinfo>


<sect1 id='intro'>
  <title>Introduction</title>

  <para>
   This Template is a suggestion and a starting point for new MDP authors.
   It will not fit all HOWTOs and should be modified to fit your topic
   <emphasis>
    In this template, comments to the reader are in this style (emphasized).
   </emphasis>
   Example lines are in plain roman style.  Examples have been taken from the 
   Mapplet-HOWTO.  
  </para>

  <para>
   <emphasis>
   The introduction will include a basic description of what the reader can expect to learn 
   from this document.  The URL to an example of the type of application that can be developed 
   using the methods covered in this document may be appropriate.  Also include the version of 
   the MapServer software that you are describing.  For long documents, you may consider 
   recommending a reading structure for readers with different levels of expertise.
   </emphasis>
  </para>

  <para>
  <emphasis>If appropriate, indicate previous knowledge needed.</emphasis>
    This document assumes no previous knowledge or experience with
    Java programming or applet installation.  It does, however, assume
    the following:
  </para>

  <itemizedlist>
    <listitem>
      <para>
        Familiarity with fundamental aspects of managing the
        MapServer software and the web server.
      </para>
    </listitem>
    <listitem>
      <para>
        Basic familiarity with the JavaScript browser scripting language.  
        If this is a limitation, JavaScript reference materials can be found on the web
        (the <ulink
        url="http://devedge.netscape.com/docs/manuals/index.html?content=javascript.html">
        Netscape JavaScript documentation pages</ulink> are a good place to start).
      </para>
    </listitem>
    <listitem>
      <para>
        The ability to download and unpack (unzip) archive files
        (e.g., .tar or .zip files) from the internet.
      </para>
    </listitem>
    <listitem>
      <para>
        The MapServer/MapScript software is installed and functioning on a web server.
      </para>
    </listitem>
    <listitem>
      <para>
        The MapServer demo application is running on your server (see
        both the download and documentation sections of the <ulink
        url="http://MapServer.gis.umn.edu">MapServer web-site</ulink>).
        If you don't have the demo running, but you do have your own
        MapServer application in place, you probably won't have any
        difficulty adapting the instructions given here to your
        application.
      </para>
    </listitem>
  </itemizedlist>

</sect1>

<!-- Section1: obtaining and installing -->
<sect1 id="obtain">
  <title>Obtaining and Installing the Software</title>

  <para>
    <emphasis>Explain how the reader obtains, compiles, and/or installs 
    needed software and files.  If the instructions are very long, you may
    want to break this up into multiple sections.</emphasis>
    The <application>mapplet</application> can be obtained at 
    <ulink url="http://MapServer.gis.umn.edu/contributed.html">
    http://MapServer.gis.umn.edu/contributed.html</ulink>.
    Click on the <application>mapplet</application> link and save the zip file 
    to a local disk...
  </para>
</sect1>



<!-- Section1: Integration or developing  an application-->
<sect1 id="integrate">
  <title>Integrating the <application>mapplet</application> with an existing mapserver application</title>
   <para>
    <emphasis>
    Explain how the reader will integrate the application being discussed
    or develop one of their own.
    It is a good idea to use an example here, such as the MapServer demo
    application, rather than explaining in abstract terms. I'll include this
    entire section from the Mapplet-HOWTO for an example of a complete, 
    multi-layer section.
    </emphasis>
   </para>
 
  <para>
    Now that the class files are in a web-accessible space, they can
    easily be integrated into a MapServer application.  We'll use the 
    MapServer demo as an example.
  </para>

  <para>
    The only changes will be to the html template
    file that defines how your map pages are displayed.  For the
    MapServer demo this is the file <filename>demo.html</filename>.
    There are essentially four steps:
  </para>

  <itemizedlist>
    <listitem>
      <para>add a name attribute to the form that controls the map interface,</para>
    </listitem>
    <listitem>
      <para>add a couple of hidden variables to the form,</para>
    </listitem>
    <listitem>
      <para>add a couple of small JavaScript functions to the &lt;head&gt; section,</para>
    </listitem>
    <listitem>
      <para>replace the output map image definition with the applet definition.</para>
    </listitem>
  </itemizedlist>

  <para>
    Each of these steps is addressed separately below.
  </para>
  
  <sect2 id="nameform">
    <title>Add a name attribute to the html form</title>
 
    <para>
      The html form that controls the map interface in
      <filename>demo.html</filename> is defined by this line:
    </para>

    <programlisting>
      &lt;form method=GET action="/cgi-bin/mapserv3.3"&gt;
    </programlisting>

    <para>
      The addition of the name attribute enables us to
      refer to the form by name in JavaScript functions.  
      So change the line above to look like this:
    </para>

    <programlisting>
      &lt;form name="mapserv" method=GET action="/cgi-bin/mapserv3.3"&gt;
    </programlisting>
  </sect2>

  <sect2 id="addvars">
    <title>Add hidden variables to the form</title>
 
    <para>
      Next, we need to establish two html form variables that
      will be passed back and forth between the applet and the
      JavaScript functions.  Add the following lines just
      after the form definition that we doctored in the previous step:
    </para>

    <programlisting>
      &lt;input type="hidden" name="imgxy" value="299.5 299.5"&gt;
      &lt;input type="hidden" name="imgbox" value="-1 -1 -1 -1"&gt;
    </programlisting>

    <para>
      Note that the name attributes for these variables must be typed
      exactly as shown.  The <varname>imgxy</varname> variable is used to
      communicate the position of a user's mouse click.  The
      <varname>imgbox</varname> variable is used to communicate the
      bounds of a box the user drags with their mouse.  The values for
      both variables are given in terms of image pixel coordinates.
    </para>

    <para>
      In this step we have initialized the two variables
      and assigned default values to them.  Reasonable default values
      were determined from the output
      map image size, set in <filename>demo.map</filename> to 600x600
      pixels.  The <varname>imgxy</varname> coordinate pair is set
      to the center of the map image, less half a pixel in both the 
      x and y directions.
      The <varname>imgbox</varname> pixel coordinates are set to -1 all around, which
      translates essentially to "no box".  Generally speaking, these
      default values will be replaced in accordance with the user's mouse
      actions before they are passed to the applet.
    </para>
  </sect2>

  <sect2 id="addjs">
    <title>Add JavaScript functions</title>
 
    <para>
      Now we need to add two JavaScript functions to enable
      communication with the applet.  Put these in the &lt;head&gt;
      section of <filename>demo.html</filename>, which looks like this
      by default:
    </para>

    <programlisting>&lt;head&gt;&lt;title&gt;MapServer Demo Interface&lt;/title&gt;&lt;/head&gt;</programlisting>

    <para>
      Change that to look like this:
    </para>

    <programlisting>
      &lt;head&gt;&lt;title&gt;MapServer Demo Interface&lt;/title&gt;
      
      &lt;SCRIPT LANGUAGE="JavaScript"&gt;

        function mapplet_apply(name, minx, miny, maxx, maxy, redraw) {
          document.mapserv.imgbox.value = minx + " " + miny + " " + maxx + " " + maxy;
          document.mapserv.imgxy.value = minx + " " + miny;
        }

        function mapplet_error(message) {
          alert(message);
        } 

      &lt;/SCRIPT&gt;

      &lt;/head&gt;
    </programlisting>

    <para>
      Note the use of "mapserv" on the left side of the assignment 
      statements in the <function>mapplet_apply</function> function:
    </para>

    <programlisting>
      document.mapserv.imgbox.value = ...
      document.mapserv.imgxy.value = ...
    </programlisting>

    <para>
      This is the name attribute that we assigned to the form above.
      The <function>mapplet_apply</function> function sets the values of
      the hidden variables we established earlier, and that the
      <function>mapplet_error</function> function provides a means for
      the applet to pass error messages out to the user.
      However, you don't even really need to understand
      the functions, as you will never call them yourself - that is up
      to the applet.  
    </para>
  </sect2>

  <sect2 id="replacedef">
    <title>Replace output map image definition</title>
 
      <para>
        Finally, we need to replace the output map image definition
        with the applet definition.  Find the following html snippet
        in <filename>demo.html</filename> (it may be strung out all on
        one line):
      </para>
    
      <programlisting>
        &lt;tr&gt;
          &lt;td colspan="2"&gt;
            &lt;INPUT NAME="img" TYPE="image" SRC="[img]" width=600 height=600 border=0&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      </programlisting>
    
      <para>
        This is the definition of an html table cell that contains the
        output map image generated by MapServer.  We need to replace
        this with the applet definition.  Change the above block so
        that it looks like this instead:
      </para>
    
      <programlisting>
        &lt;tr&gt;
          &lt;td colspan="2"&gt;
            &lt;applet codebase="/java/mapplet" code="mapplet.class" width="600" height="600" name="mapplet" MAYSCRIPT&gt;
              &lt;param name="image" value="http://[host][img]"&gt;
            &lt;/applet&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      </programlisting>
  
      <para>
        Let's pick this applet definition apart a bit.
      </para>
  
      <sect3>
        <title>A Closer Look</title>

        <variablelist><title>The &lt;applet&gt; tag</title>

          <varlistentry><term>codebase</term>
            <listitem>
              <para>
                Specifies the path, relative to the html document
                root, to the directory containing the needed class file(s).  If
                you put your class files in a directory structure other than
                <filename class="directory">/java/mapplet</filename>, you will
                need to change the codebase attribute accordingly.
                  <note><para>
                    You can also use a url for the codebase attribute,
                    so that the class files could actually be located just about
                    anywhere on the internet.
                  </para></note>
              </para>
            </listitem>
          </varlistentry>
          <varlistentry><term>code</term>
            <listitem>
              <para>
                Specifies the name of the class file that is to be executed.
              </para>
            </listitem>
          </varlistentry>
          <varlistentry><term>width</term>
            <listitem>
              <para>
                Defines the width (in pixels) of the space to be allocated to
                the applet on the html page.  This value should be the same as
                the width of your output map image, which is set to 600 in
                <filename>demo.map</filename>.
              </para>
            </listitem>
          </varlistentry>
          <varlistentry><term>height</term>
            <listitem>
              <para>
                Defines the height (in pixels) of the space to be allocated to
                the applet on the html page.  This value should be the same as
                the height of your output map image.
              </para>
            </listitem>
          </varlistentry>
          <varlistentry><term>name</term>
            <listitem>
              <para>
                Assigns a name to the applet for use within the html page.  This
                is handy for use in referring to the applet within JavaScript
                code.
              </para>
            </listitem>
          </varlistentry>
          <varlistentry><term>MAYSCRIPT</term>
            <listitem>
              <para>
                Permits the Java applet to access JavaScript functions
                (required for the <application>mapplet</application>).  Accessing JavaScript
                when the MAYSCRIPT attribute is not specified results
                in an exception.
              </para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>
            Parameters to be passed to the applet are specified in
            &lt;param&gt; tags embedded between the opening and
            closing &lt;applet&gt; tags.  Here we have defined only one:
        </para>
        <variablelist><title>Applet parameters</title>
          <varlistentry><term>image</term>
            <listitem>
              <para>
                Specifies the map image to be loaded into the applet.  Must be a
                fully-qualified URL.  The "[host]" and "[img]" specifiers used here are
                standard MapServer template substitutions, and will be swapped
                out for the appropriate values when the MapServer parses
                <filename>demo.html</filename>.
              </para>
            </listitem>
          </varlistentry>
        </variablelist>
          
      </sect3>

  </sect2>

</sect1>


<!-- Section1: running your application -->
<sect1 id="running">
  <title>Running your application</title>
  <para>
    <emphasis>After you have given an example of how to build an application,
    you'll want to let your reader know what to expect when they try to run
    it in a web browser.</emphasis>
  </para>
</sect1>

<!-- Section1: Fine-tuning -->
<sect1 id="finetune">
<title>Fine-tuning with JavaScript</title>
  <para>
    <emphasis>Explain how to fix small problems the user may run into with
    application they have just built.
    </emphasis>
  </para>
</sect1>

<!-- Section1: Advanced Methods -->
<sect1 id="advanced">
<title>Advanced Methods</title>
  <para>
    <emphasis> You may want to include an advanced section for
    those who want to develop more complex applications.
    </emphasis>
  </para>
</sect1>

<!-- Section1: Optional Parameters -->
<sect1 id="parameters">
<title>Optional <application>Mapplet</application> Parameters</title>

  <para>
    <emphasis>If a brief reference section is appropriate, include
     it here.
    </emphasis>
  </para>
</sect1>

<!-- Section1: Frequently Asked Questions -->
<sect1>
<title>Frequently Asked Questions</title>
  <qandaset defaultlabel="qanda">
    <qandaentry>
      <question>
        <para>
        How can I find the EPSG code for my data's projection?
        </para>
      </question>
      <answer>
        <para>
        If you know the parameters of your data's projection, then you 
        can browse the "epsg" file that comes with PROJ4 and look for a
        projection definition that matches your data's projection.  It's a
        simple text file and the EPSG code is inside brackets (&lt;...&gt;) at 
        the beginning of every line.
        </para>
        <para>
        The "epsg" file is usually located in <filename>/usr/local/share/proj</filename> on Unix
        systems and in <filename>C:\proj\</filename> on Windows systems.
        </para>
      </answer>
    </qandaentry>
    <qandaentry>
      <question>
        <para>
        My WMS server produces the error "msProcessProjection(): no system
        list, errno: .."
        </para>
      </question>
      <answer>
        <para>
        That's likely PROJ4 complaining that it cannot find the "epsg" 
        projection definition file.  Make sure you have installed PROJ 4.4.3
        or more recent and that the "epsg" file is installed at the right
        location.  On Unix it should be under <filename>/usr/local/share/proj/</filename>, and 
        on Windows PROJ looks for it under <filename>C:\PROJ\</filename>.
        </para>
        <para>
        If you don't have the "epsg" file then you can get it as part of the
        PROJ4 distribution at <ulink url="http://www.remotesensing.org/proj/">
        http://www.remotesensing.org/proj/</ulink> or you can 
        download it at <ulink url="http://www2.dmsolutions.ca/mapserver/dl/proj4-epsg.zip">
        http://www2.dmsolutions.ca/mapserver/dl/proj4-epsg.zip</ulink>.
        </para>
      </answer>
    </qandaentry>
  </qandaset>
</sect1>

<!-- Section1: Document Info -->
<sect1 id='docinfo'> 
  <title>About This Document</title>
  
  <para>
   <emphasis>This section is optional.  The Linux Documentation project,
    which we are using as a model, recommends including these things in
    the first section of your document.  I've tacked them on at the end
    to avoid all the clutter at the beginning of the document.</emphasis>
  </para>

  <sect2 id='copyright'>
   <title>Copyright Information</title>
   
   <para>
    Copyright (c) 2001 Your name here.
   </para>
   <para>
    This documentation is covered by the same Open Source license as the MapServer software.
    See MapServer's
    <ulink url='http://mapserver.gis.umn.edu/license.html'>License and 
    Credits</ulink> page for the complete text.
   </para>
  </sect2>

  <sect2 id='disclaimer'>
   <title>Disclaimer</title>

   <para>
    No liability for the contents of this document can be accepted.
    Use the concepts, examples and other content at your own risk.
    As this is a new edition of this document, there may be errors
    and inaccuracies that may be damaging to your system.
    Although this is highly unlikely, the author(s) do not take any 
    responsibility for that:  proceed with caution.
   </para>

  </sect2>

  <sect2 id='acknowledgmements'>
   <title>Acknowledgments</title>
   <para>
    This document was heavily influenced by the <ulink url='http://www.linuxdoc.org/authors/template/'>
    LDP HOWTO-template for Big HOWTOs</ulink> 
    by Stein Gjoen, Gregory Leblanc, and Greg Ferguson.  
   </para>
  </sect2>

<!-- Section2: feedback -->

  <sect2 id='feedback'>
   <title>Feedback</title>
   <para>
    Send any comments or suggestions to the document author(s).
   </para>
   </sect2>

 </sect1>
</article>
