<html>
  <head>
      <title>MapServer - Documentation: CGI Reference</title>
      <script language="javascript" src="javascript/include.js"></script>
  </head>
  <body bgcolor="#FFFFFF" marginheight=0 marginwidth=0 style="margin:0px">

  <script language="javascript">header("doc");</script>

    <a name="top"><FONT COLOR="#3366cc" SIZE=+2><B>CGI Reference</B></FONT>
    <p>
    <b>Purpose:</b> Mapserv is the CGI portion for the MapServer package. It handles user input and directs image creation or query requests. The program accepts input via either "GET" or "POST" methods and can be used in an interactive manner or as an image engine.
    <p>
    <b>Notes:</b> Variable names are not case sensitive. In cases where multiple values are associated with a variable (eg. mapext), the values must be seperated by spaces (or their escaped equivalents for GET requests). Variable contents are checked for appropriate data types and magnitude as they are loaded. 
    <p>
    <b>Format:</b> Mapserv accepts input in the form of CGI variables as described below.
    <p>
    <FONT face="arial,helvetica" COLOR="#3366cc" SIZE=+1><b>CGI Variables</b></font>
    <p>
    <menu>
      <li> <b>buffer [distance]:</b> A distance, in the same coordinate system as the shapefiles, used in conjunction with mapxy to create an new map extent.<br>
      <p>
      <li> <b>img:</b> The name associated with the inline map image used to record user clicks. What actually is passed are two variables, img.x and img.y.<br>
      <p>
      <li> <b>imgbox [x1] [y1] [x2] [y2]:</b> Coordinates (in pixels) of a box drag in the image. We're using this in conjunction with Java based front ends to the MapServer.<br>
      <p>
      <li> <b>imgext [minx] [miny] [maxx] [maxy]:</b> The spatial extent of the existing inline image.<br>
      <p>
      <li> <b>imgsize [cols] [rows]:</b> The size (in pixels) of the exiting inline image.<br>
      <p>
      <li> <b>imgxy [x] [y]:</b> Coordinates (in pixels) of a single mouse click. We're using this in conjunction with Java based front ends to the MapServer.<br>
      <p>
      <li> <b>item [name]:</b> The name of an attribute in a layer attribute table. Used for item/value lookups.<br>
      <p>
      <li> <b>layer [name]:</b> The name of a layer as it appears in the <a href="mapfile.html">map file</a>. Sending mapserv a layer name turns that layer ON.<br>
      <p>
      <li> <b>layers [name name ...]:</b> The names of the layers to be turned on. Layer names must be seperated by spaces.
      <p>
      <li> <b>map [filename]:</b> Path, relative to the CGI directory, of the <a href="mapfile.html">map file</a> to be used.<br>
      <p>
      <li> <b>mapext [minx] [miny] [maxx] [maxy]:</b> The spatial extent of the map to be created.<br>
      <p>
      <li> <b>mapsize [cols] [rows]:</b> The size (in pixels) of the image to be created. Useful for allowing users to change the resolution of output images interactively.<br>
      <p>
      <li> <b>mapshape [x1 y1 x2 y2 ...]:</b> An arbitrary polygon shape to be used for query purposes. Multiple instances simply add parts to the shape so it is possible to construct a shape with holes. Used with modes NQUERY and NQUERYMAP. (development version only)
      <p>
      <li> <b>mapxy [x] [y]:</b> A point, in the same coordinate system as the shapefiles, to be used in conjuction with a buffer or a scale to construct a map extent.<br>
      <p>
      <li> <b>minx|miny|maxx|maxy [number]:</b> Minimum x coordinate of the spatial extent for a new map/query. <br>
      <p>
      <li> <b>mode [value]:</b> Mode of operation. The following options are supported.
      <p>

      <menu>
        - <b>browse:</b> Fully interactive interface where maps (and interactive pages) are created.<br>
        - <b>featurequery:</b> A spatial search that uses one feature (from slayer) to query other layers.<br>
        - <b>featurenquery:</b> A spatial search that uses multiple features (from slayer) to query other layers.<br>
        - <b>query:</b> A spatial search (finds closest) is triggered by a click in a map.<br>
        - <b>nquery:</b> A spatial search (finds all) is triggered by a click in a map or by user-define selection box.<br>
        - <b>itemquery:</b> A text search of attribute data is triggered with an item/value pair. Returns 1st match.<br>
        - <b>itemnquery:</b> A text search of attribute data is triggered with an item/value pair. Returns all matches.<br>
        - <b>map:</b> The created map (GIF) is returned. Used with an &lt;img ... &gt; tag.<br>
        - <b>reference:</b> The created reference map is returned. Used with an &lt;img ... &gt; tag.<br>
        - <b>scalebar:</b> The created scalebar is returned. Used with an &lt;img ... &gt; tag.<br>
        - <b>legend:</b> The created legend is returned. Used with an &lt;img ... &gt; tag.<br>
        - <b>coordinate:</b> Returns the users "click" in map coordinates.
      </menu>

      <p> There are several additional modes to retrieve the querymap associated with a particular query. They are
      <b>querymap</b>, <b>nquerymap</b>, <b>itemquerymap</b>, and <b>itemnquerymap</b>. Like the map mode they are to
      be used within an &lt;img ... &gt; tag.

      <p>
      <li> <b>qlayer [name]:</b> Query layer. The name of the layer to be queried as it appears in the <a href="mapfile.html">map file</a>. If not specified then all layers are searched in turn.
      <p>
      <li> <b>queryfile [filename]:</b> Query results to use with modes map or browse (see <b>savequery</b>). The cached query is applied before the map is produced using the QUERYMAP definition of the <a href="mapfile.html">mapfile</a>.
      <p>
      <li> <b>ref:</b> The name associated with the inline reference map image used to record user clicks. What actually is passed are two variables, ref.x and ref.y.
      <p>
      <li> <b>refext [minx] [miny] [maxx] [maxy]:</b> The spatial extent of the reference image.
      <p>
      <li> <b>savequery:</b> When used with any of the query modes this tells the MapServer to save the query results to a temporary file for use in subsequent operations (see <b>queryfile</b>). Useful for making queries sticky.
      <p>
      <li> <b>scale [number]:</b> Scale to create a new map at. Used with mapxy.
      <p>
      <li> <b>searchmap:</b> It is possible to do pan/zoom interfaces using querymaps. In these cases you will likey want information about the contents of the new map rather than the previous map which is the normal way queries work. When searchmap is specified the new map is created an it's extent is used to query layers. Useful with NQUERY, or ITEMNQUERY mode only. 
      <p>
      <li> <b>slayer [name]:</b> Select layer. The name of the layer to be used for queries of type FEATUREQUERY or FEATURENQUERY. The select layer <b>must</b> be a polygon layer. The selection feature(s) are available for presentation to the user. A special version of the reference map with the polygons used for this query highlighted is also generated in lieu of the normal reference map.
      <p>
      <li> <b>template [filename]:</b> Name of the main template file to use for formatting the results. Overrides anything set in the map file.
      <p>
      <li> <b>tile [name]:</b> The name of a tile directory containing shapefiles. Most often used in conjucntion with the shapepath option in the <a href="mapfile.html">map file</a>.
      <p>
      <li> <b>value [expression]:</b> Value (regular expression) to match against in item/value lookups.
      <p>
      <li> <b>zoom [number]:</b> Zoom scaling to apply to the creation of the new map. Values greater than 0 resulting in zooming in, 0 is a pan, and values less than zero are for zooming out. A value of 2 means "zoom in twice".<br>
      <p>
      <li> <b>zoomdir [1|0|-1]:</b> Direction to zoom. See above.
      <p>
      <li> <b>zoomsize [number]:</b> Magnitude (absolute) of a zoom. Used with zoomdir.
    </menu>

    <p>
  
    <b>Changing <a href="mapfile.html">map file</a> parameters using via a form or a url:</b>

    <p>
    Begining with version 3.3 it is now possible to change virtually any map file value from a form or a URL. The syntax for
    this is fairly straight forward. Any value can be expressed using the hierarchy used in a map file. A map contains a layer,
    which contains a class, which contains a label, which has a color. This hierarchy is expressed as a sequence of MapServer
    keywords seperated by underscores. For example to change the color of a layer called "lakes" with only one class defined
    you would use a form variable named "map_lakes_class_color" and could assign it a color like "0 0 255". Layers can be referenced
    by index (i.e. map_<b>layer_0</b>...) or by name as shown above. Layer classes are referenced by index value (i.e. 
    map_layer_0_<b>class_2</b>). If there is only 1 class for a layer then the index should be ommited. These variables must always
    begin with the sequence "map_". Values assigned must conform to the syntax of a map file. 
    <p>
    It is also possible to define inline features using this mechanism. This is the only case where you can add on to the map file.
    You can edit/change layer parameters but you cannot create a new layer. With inline features you have to first create a feature
    and then build upon it, however, the layer the feature belongs to must exist. Here's a snippet from a GET request that adds a
    feature to a webuser layer:
    <p>
      ...&map_webuser_feature=new&map_webuser_feature_points=12345.6789+12345.6789+map_webuser_feature_text=My+House!&...
    <p>
    The "map_webuser_feature=new" creates a new feature for the webuser layer. All subsequent calls to the feature object
    for that layer will modify the new feature. You can repeat the process to create additional features. This is really
    intended for very small (point, rectangle) amounts of data.
    <p>
    It's quite possible that I'll come up with some shortcuts for this processing, but until I know how useful this is
    to users this is it. One potentially very powerful use involves changing class expressions on-the-fly. Anyway, try it out.

  <script language="javascript">footer();</script>
  