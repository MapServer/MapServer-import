<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1//EN">

<article>

<articleinfo>
  <title>MapServer UNIX Compilation & Installation HOWTO</title>

  <author>
     <firstname>Jean-Francois</firstname>
     <surname>Doyon</surname>
     <affiliation>
        <orgname>Natural Resources Canada</orgname>
         <orgdiv>GeoAccess Division</orgdiv>
        <address>
            <email>jdoyon@nrcan.gc.ca</email>
        </address>
     </affiliation>
  </author>

  <abstract>
    <para>
    This document will assist new users in obtaining, compiling and installing MapServer on UNIX-type platforms.
    </para>
  </abstract>

</articleinfo>

<sect1 id="intro">
  <title>Introduction</title>

  <para>
  The University of Minnesota's MapServer is an open-source and freely available map rendering engine for the web.  Due to it's
  open-source nature, it can be compiled on a wide variety of platforms and operating systems.  We will focus on how to obtain, compile
  and install MapServer on UNIX-like platforms. Throughout this document we will use the popular Linux and Apache combination for the
  examples, as well as the MapServer demo package.  
  </para>

  <para>
  This document assumes you are allready familiar with basic aspects of your operating system and web server:
  </para>

  <itemizedlist>
   <listitem>
     <para>Shell environment</para>
   </listitem>
   <listitem>
     <para>File system layout and permissions</para>
   </listitem>
   <listitem>
     <para>Build environment, notably <application>autoconf</application> and <application>make</application></para>
   </listitem>
   <listitem>
     <para>Basic web server configuration, CGI environment</para>
   </listitem>
  </itemizedlist>

</sect1>

<sect1 id="obtain">
  <title>Obtaining the necessary software</title>

  <para>
  You can obtain the source code as well as the demo package from the MapServer site, located at <ulink url="http://mapserver.gis.umn.edu">http://mapserver.gis.umn.edu</ulink>.
  </para>

  <para>
  MapServer also makes use of a variety of external librairies to enhance it's functionality.  Here is a short descriptive list of which
  ones they are an what purpose they serve:
  </para>

  <itemizedlist>
   <listitem>
	<para><ulink url="http://www.boutell.com/gd/">GD</ulink>: The graphics rendering library, used to output GIF's or PNG's (Mandatory, Version 1.2 Included).</para>
   </listitem>
   <listitem>
	<para><ulink url="http://www.freetype.org/">FreeType</ulink>: For TrueType Font rendering (Recommended).</para>
   </listitem>
   <listitem>
	<para><ulink url="http://www.remotesensing.org/proj/">PROJ.4</ulink>: For on-the-fly projection conversion (Recommended).</para>
   </listitem>
   <listitem>
	<para><ulink url="http://www.libtiff.org/">LibTIFF</ulink>: For TIFF support (Optional).</para>
   </listitem>
      <listitem>
	<para><ulink url="http://www.remotesensing.org/geotiff/geotiff.html">LibGeoTIFF</ulink>: For GeoTIFF (Geo-Referenced TIFF Images) Support (Optional).</para>
      </listitem>
   <listitem>
	<para><ulink url="ftp://ftp.uu.net/graphics/jpeg/">LibJPEG</ulink>: For JPEG Support (Optional).</para>
   </listitem>
   <listitem>
	<para><ulink url="http://gdal.velocet.ca/projects/opengis/">OGR Simple Features Library</ulink>: An open-source library (and tools) providing I/O for a variety of vector file formats (Optional).</para>
   </listitem>
      <listitem>
	<para><ulink url="http://www.cbmamiga.demon.co.uk/mpatrol/">MPATROL</ulink>: Debugging library (Developpers only).</para>
      </listitem>
  </itemizedlist>

</sect1>

<sect1 id="compiling">
  <title>Compiling</title>

  <para>The first thing you should do is unpack the source code tar-ball:

  <screen>
  [user@host user]$ tar -zxvf ms_3.4.000.tar.gz
  </screen>

  This will unpack the file into a directory called "mapserver".

  </para>

  <sect2 id="quickcompile">
   <title>The QUICK and DIRTY way</title>

   <para>If you're in a hurry, try this:
   <screen>
   [user@host user]$ cd mapserver
   [user@host mapserver]$ ./configure
   [user@host mapserver]$ make
   </screen>

   That's it ! Unless you got errors, MapServer is now compiled and ready to go.  You can now skip to the <link linkend="installation">
   installation</link> section.

   </para>
  </sect2>

  <sect2 id="compileproper">
   <title>The RIGHT way</title>
  <para>Here we will learn in detail how to properly compile Mapserver.  There are two major steps to compiling a program from source: configuring the source code, and actually compiling it.</para>

      <sect3 id="configure">
	<title>Configuring the source code</title>

  <para>The best way to find out the options available at compile time is to run <application>configure</application> with the help
  parameter:</para>

  <screen>
  [user@host user]$ cd mapserver
  [user@host mapserver]$ ./configure --help
  </screen>

  <para>You will note the ability to specify which library to use, and from which location.  Under normal circumstances the configuration
  script will automatically find all the librairies on your system and use them:</para>

  <screen>
  [user@host mapserver]$ ./configure
  </screen>

  <para>Note the output of the above command and make sure that the configure script located all the librairies you want it to use.  If not, you may have to manually specify the location of the librairies.</para>

  <para>See an example on doing that in the following section.</para>

  <sect4 id="gd">
     <title>The GD Issue</title>

  <para>By default Mapserver will use the system librairies, including GD.  The problem is that nowadays most Linux distribution come
  with recent versions (>1.6) of GD that no longer supports GIF's, but PNG's instead.  This is often not prefered since PNG's, although
  superior, are not yet widely supported by all browsers.  Therefore, most Web developpers still prefer to use GIF's.
  </para>

  <para>The GD library stopped supporting GIF's because UNISYS, the patent holder for the LZW Compression algorythm used in GIF's, has
  started claiming royalty for the use of the said patent.  This makes it illegal for you to use GIF's unless you used a software package   licensed by UNISYS (Packages such as Corel/Adobe are safe, GD, being open-source, couldn't possibly be licensed), or you or your business hold such licenses.  So beware !</para> 

  <para>Thankfully, Mapserver is distributed with it's own older version of GD, which is GIF capable. In order to force it's use you would
  take the following steps:</para>
  
  <screen>
  [user@host mapserver]$ cd gd-1.2
  [user@host gd-1.2]$ make
  [user@host gd-1.2]$ cd .. 
  [user@host mapserver]$ ./configure --with-gd=gd-1.2/ <emphasis>(...and possibly other options)</emphasis>
  </screen>

	</sect4>

  <sect4 id="manlib">
	  <title>Requesting specific librairies</title>
	  <para>Some librairies will NEVER be detected by default, and HAVE to be specified via the configure script.</para>

	  <para>The librairies are:</para>

	  <itemizedlist>
	    <listitem>
	      <para>PROJ.4: The on-the-fly projection conversion librairy (--with-proj).</para>
	    </listitem>
	    <listitem>
	      <para>SDE: Librairies for ESRI's Spatial Data Engine. These come from ESRI's product (--with-sde).</para>
	    </listitem>
	    <listitem>
	      <para>MPATROL: A debugging library (--with-mpatrol).</para>
	    </listitem>
	    <listitem>
	      <para>OGR: The vector file formats I/O library (--with-ogr).</para>
	    </listitem>
	  </itemizedlist>

	  <para>If the configure script can't find the librairies, you can allways specify their location manually by appending the path
          to the option, for the SDE librairies for instance you might type "--with-sde=/usr/lib/sde/".</para>

	</sect4>

      </sect3>

  <sect3 id="compile">
	<title>Compiling the source code</title>
	<para>Now that you have configured your build options and selected all the librairies you wish mapserver to use, you're ready to
        compile the source code into an executable.</para>

	<para>This is actually quite simple, just execute "make":</para>

  <screen>
  [user@host mapserver]$ make
  </screen>

	<para>If all goes well, you should see some information go accross the screen, and the process wil come to a stop, returning you
to the shell prompt.  At this point, your directory should hold your brand new, customized mapserver executable binary !</para>

	<para>To make sure all went well, first just look for the file, it's called "mapserv", and should be set executable:</para>

  <screen>
  [user@host mapserver]$ ls -al mapserv
  -rwxr-xr-x    1 user     user       351177 Dec 21 11:38 mapserv
  </screen>

	<para>Now, another simple test is to try and run it:</para>

  <screen>
  [user@host mapserver]$ ./mapserv
  This script can only be used to decode form results and
  should be initiated as a CGI process via a httpd server.
  [user@host mapserver]$
  </screen>

	<para>The message above is perfectly normal, and means exactly what it says.  If you get anything else, something went terribly
wrong !</para>

	<para>Congratulations! You are now ready to proceed with the installation ...</para>

  </sect3>
  </sect2>
 </sect1>

<sect1 id="installation">
  <title>Installation</title>

  <sect2>
   <title>MapServer binary</title>
   
   <para>The MapServer program itself consists of only one file, the "mapserv" binary executable.  This is a CGI executable, meant to be
   called and run by your webserver.</para>

      <para>For the purpous of this section, we will assume you are running Apache under it's default directory structure in /usr/local/apache.  Depending on your situation, you may need to have privileges to edit your httpd.conf (That's the main apache configuration file), or have someone (Such as your webmaster) that can help you with some of the details here.</para>

      <para>The main goal is to get the "mapserv" binary installed within a publicly accessible directory that is configured to run CGI programs and scripts.</para>

      <sect3>
	<title>The basic install</title>
	<para>Under a default configuration, the CGI directory is "/usr/local/apache/cgi-bin" (RedHat users will use "/home/httpd/cgi-bin").  Placing the mapserv file in this directory would make it accessible by the following URL: "http://yourhostname.com/cgi-bin/mapserv".</para>

      <para>You should expect the following output if all works well : "No query information to decode. QUERY_STRING is set, but empty.". This is normal and a good sign, in fact if you get this message, you're done installing MapServer !</para>
      </sect3>

      <sect3>
	<title>Common problems</title>
	<sect4>
	  <title>File permissions</title>
	  
	  <para>The most common problem one is likely to encounter when attempting to install the binary are permissions issues:</para>

	  <itemizedlist>
	    <listitem>
	      <para>You do not have write permissions into your webserver's CGI Directory: Ask your webmaster to install the file for you.</para>
	    </listitem>
	    <listitem>
	      <para>The web server gives you a "403 Permission denied" error: Make sure the user the webserver runs as (usually "nobody") has execute permission on the binary executable.  Making the file world executable is perfectly fine and safe:</para>
	      <screen>[user@host cgi-bin]$ chmod o+x mapserv</screen>
	    </listitem>
	  </itemizedlist>
	</sect4>

	<sect4>
	  <title>Web server configuration problems</title>
	  
	  <para>You may receive a few different type of errors as well if your webserver configuration isn't right:</para>

	  <itemizedlist>
	    <listitem>
	      <para>500 Internal server error: This is a fairly generic error message.  All it basically tells you is that the webserver was unsuccessfull in running the program.  You will have to consult the webserver's error log to find out more, and may need to enlist the help of your webmaster/system administrator.</para>
	    </listitem>
	  </itemizedlist>
	</sect4>


      </sect3>

      

  </sect2>

  <sect2>
   <title>MapServer Demo</title>

   <para>In order to complete a usable installation of MapServer, you will need some sample data and interfaces.</para>

  </sect2>
 </sect1>

</article>















































