<?xml version="1.0" standalone="no"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<!-- $Id$ -->
<article>
	<articleinfo>
		<!-- insert title here, include the word HOWTO -->
		<title>Mapserver PHP/Mapscript Installation HOWTO</title>
		<author>
			<firstname>Jeff</firstname>
			<surname>McKenna</surname>
			<affiliation>
				<orgname>DM Solutions Group Inc.</orgname>
				<address>
					<email>mckenna@dmsolutions.ca</email>
				</address>
			</affiliation>
		</author>
		<date>2001-08-01</date>
		<abstract>
			<!-- a short description of the contents of the doc -->
			<para>
         This document describes the procedures for obtaining, compiling and installing the PHP/Mapscript Module for Mapserver.
      </para>
			<para>Last Updated: 08/01/2001</para>
		</abstract>
	</articleinfo>
	<sect1 id="intro">
		<title>Introduction</title>
		<para>
			The PHP/MapScript module is a PHP dynamically loadable module that makes <ulink url="http://mapserver.gis.umn.edu/mapscript.html">MapServer's
               MapScript</ulink> functions and classes available in a PHP3/PHP4 environment. 		
          </para>
		<para>
			The original version of MapScript (in Perl) uses <ulink url="http://www.swig.org/">SWIG</ulink>, but since 				SWIG does not support the PHP language, the module has to be maintained separately and may not always be in 			sync with the Perl version. 
          </para>
		<para>
			The PHP module was developed and is currently maintained by <ulink url="http://www.dmsolutions.ca/">DM 				Solutions Group</ulink>. 
          </para>
		<para>
             This document assumes that you are already familiar with certain aspects of your operating system:
          </para>
		<itemizedlist>
			<listitem>
				<para>
                    	For Unix/Linux users, a familiarity with the build environment, notably 'make'.
                </para>
			</listitem>
			<listitem>
				<para>
					For Windows users, some compilation skills if you don't have ready access to a precompiled installation
                    	and need to compile your own copy of MapServer with the PHP/Mapscript module.
				</para>
			</listitem>
		</itemizedlist>
		<!-- Section2: Which version -->
		<sect2 id="version">
			<title>Which version of PHP is supported?</title>
			<para>
				The module was originally developed for PHP-3.0.14 and works with more recent versions of PHP3. It
                    has also been ported to PHP4: PHP4 support started being available with the release of MapServer
                    version 3.4.
			</para>
			<para>    
				Note that a PHP MapScript compiled for PHP3 won't work with PHP4 and vice-versa. The MapServer
                    configure script should automatically detect which version of PHP you are attempting to build with and
                    take the necessary actions. 
			</para>
		</sect2>
		<!-- Section2: More information on the module -->
		<sect2 id="information">
			<title>How to Get More Information on the PHP/Mapscript Module for Mapserver</title>
			<itemizedlist>
				<listitem>
					<para>
                      More information on the PHP/Mapscript Module can be found at 
                      <ulink url="http://www2.dmsolutions.ca/mapserver/php_mapscript/index.html">
                      http://www2.dmsolutions.ca/mapserver/php_mapscript/index.html</ulink>.
               </para>
				</listitem>
				<listitem>
					<para>
		            Questions regarding the module should be forwarded to the <ulink url="http://mapserver.gis.umn.edu/support.html">Mapserver mailing list</ulink>.
			</para>
				</listitem>
			</itemizedlist>
		</sect2>
	</sect1>
	<!-- Section1: obtaining and installing -->
	<sect1 id="obtain">
		<title>Obtaining, Compiling, and Installing PHP and the PHP/Mascript Module</title>
		<sect2 id="download">
			<title>Download PHP and PHP/Mapscript</title>
			<itemizedlist>
				<listitem>
					<para>
					   The PHP source or the Win32 binaries can be obtained from the PHP web site at <ulink url="http://www.php.net/">http://www.php.net/</ulink>.
					</para>
				</listitem>
				<listitem>
					<para>
					  Once you have verified that PHP is installed and is running, you need to get the latest MapServer
                           source (see <ulink url="http://mapserver.gis.umn.edu/dload.html">				                      http://mapserver.gis.umn.edu/dload.html</ulink>) and compile MapServer and the PHP module. 
				    </para>
				</listitem>
			</itemizedlist>
		</sect2>
		<sect2 id="server">
			<title>Setting Up PHP on Your Server</title>
			<sect3 id="unix">
				<title>Unix</title>
				<itemizedlist>
					<listitem>
						<para>
							Check if you have PHP already installed (several Linux distributions have it built in).
						</para>
					</listitem>
					<listitem>
						<para>
							If not, see <ulink url="http://php.net/manual/en/install.unix.php">												http://php.net/manual/en/install.unix.php</ulink>.
						</para>
					</listitem>
				</itemizedlist>
			</sect3>
			<sect3 id="windoze_ohno">
				<title>Windows</title>
				<itemizedlist>
					<listitem>
						<para>
						 	The <ulink url="http://sourceforge.net/projects/foxserv/">SourceForge project FoxServ</ulink> 								provides a single Windows installer containing recent versions of Apache, mySQL, and
							PHP; however, at the time of last update of this HOWTO it appeared
							that the FoxServ project may be abandonned, so the FoxServ install may
							be out of date when you download it.
						</para>
					</listitem>
					<listitem>
						<para>
					    Windows users can follow steps 1 to 9 of the <ulink url="http://www.net-language.com/workshops/Default.asp?workshop=21">Installing Apache, PHP4 and MySQL on Win98						    </ulink>
                    	    workshop to install Apache and PHP4 manually on their system.
					</para>
					</listitem>
					<listitem>
						<para>
				        Window users running IIS4.0 can follow this link for <ulink url="http://www2.dmsolutions.ca/mapserver/php_mapscript/php_mapscript_iis4.html">step by step 						   configurtion of PHP under IIS4.0</ulink>. 
					</para>
					</listitem>
				</itemizedlist>
				<note>
					<para>
						When setting up PHP on Windows, make sure that PHP is configured as a CGI and not as
						an Apache module because <filename>php4_mapscript.dll</filename> is not thread-safe and does
						not work as an Apache module (See <link linkend="example">"Example Steps of a Full Windows 							Installation"</link>).
					</para>
				</note>
			</sect3>
		</sect2>
		<sect2 id="build">
			<title>Build/Install the PHP/Mapscript Module</title>
			<sect3 id="build_lunix">
				<title>Building on a Linux Box</title>
				<para>
					<emphasis>NOTE:</emphasis> For UNIX users, see the <emphasis>README.CONFIGURE							  </emphasis> file in the MapServer source, or 					  see the UNIX/MapServer 						  HOWTO at 
					<ulink url="http://mapserver.gis.umn.edu/doc/unix-install-howto.html">          									http://mapserver.gis.umn.edu/doc/unix-install-howto.html</ulink>.  
			       </para>
				<para>
					<itemizedlist>
						<listitem>
							<para>
				            The main MapServer configure script will automatically setup the main
				              makefile to compile <filename>php_mapscript.so</filename> if you pass the <parameter>
				            --with-php=DIR</parameter> argument to the configure script.
				                    </para>
						</listitem>
						<listitem>
							<para>
				          Copy the <filename>php_mapscript.so</filename> library to your PHP extensions directory,
				            and then use the <function>dl()</function> function to load the module at the beginning of
				            your PHP scripts.   See also the PHP function <ulink url="http://www.php.net/manual/en/function.extension-		loaded.php">
									<function>extension_loaded()</function>
								</ulink>to
				               check whether an extension is already loaded.
				        </para>
						</listitem>
						<listitem>
							<para>
				          The file <filename>mapscript/php3/examples/phpinfo_mapscript.phtml</filename> will test 
				            that the php_mapscript module is properly installed and can be loaded.
				           </para>
						</listitem>
						<listitem>
							<para>
				          If you get an error from PHP complaining that it cannot load the 
				            library, then make sure that you recompiled and reinstalled PHP with
				            support for dynamic libraries.  On RedHat 5.x and 6.x, this means
				            adding "-rdynamic" to the CLDFLAGS in the main PHP3 Makefile after
				            running ./configure
				           Also make sure all directories in the path to the location of 
				           php_mapscript.so are at least r-x for the HTTPd user (usually 'nobody'),
				           otherwise dl() may complain that it cannot find the file even if it's 
				           there.
				        </para>
						</listitem>
					</itemizedlist>
				</para>
			</sect3>
			<sect3 id="windoze">
				<title>Building on Windows</title>
				<itemizedlist>
					<listitem>
						<para>
							For Windows users, it is recommended to look for a precompiled 
  							binary for your PHP version on the MapServer site at
  							<ulink url="http://mapserver.gis.umn.edu/win32binaries.html">												http://mapserver.gis.umn.edu/win32binaries.html</ulink> 
  							or on DM Solutions' site at
  							<ulink url="http://www2.dmsolutions.ca/mapserver/dl/">http://www2.dmsolutions.ca/mapserver/dl/								</ulink>
						</para>
						<para>
							If for some reason you really need to compile your own Windows binary
  							then see the README.WIN32 file in the MapServer source (good luck!). 
						</para>
					</listitem>
				</itemizedlist>
			</sect3>
		</sect2>
		<sect2 id="install">
			<title>Installing PHP/Mapscript</title>
			<itemizedlist>
				<listitem>
					<para>Simply copy the file <filename>php4_mapscript.dll</filename> to your PHP3/PHP4 directory</para>
					<para>
						For PHP4, place the file into the <emphasis>pathto/php/extensions</emphasis> folder.
					</para>
					<para>
						For PHP3, place the file into the <emphasis>pathto/php3</emphasis> folder.
					</para>
				</listitem>
			</itemizedlist>
		</sect2>
		<sect2 id="verify">
			<title>Using phpinfo()</title>
			<para>
			       To verify that PHP and PHP/Mapscript were installed properly, create a '.php' file containing the following code 					  and try to access it through your web server:		
			</para>
			<programlisting>
    &lt;HTML&gt;
    &lt;BODY&gt;

    &lt;?php 
    if (PHP_OS == "WINNT" || PHP_OS == "WIN32")
    {
      dl("php_mapscript.dll");
    }
    else
    {
      dl("php_mapscript.so");
    }
    phpinfo();
    ?&gt;

   &lt;/BODY&gt;
   &lt;/HTML&gt;
			</programlisting>
			<para>
			      If PHP and PHP/Mapscript were installed properly, several tables should be displayed on your page, and 					 'Mapscript' should be listed in the 'Extensions' table.
			</para>
		</sect2>
		<sect2 id="example">
			<title>Example Steps of a Full Windows Installation</title>
			<sect3 id="foxserv">
				<title>Using the SourceForge Project FoxServ</title>
				<orderedlist numeration="lowerroman">
					<listitem>
						<para>
							Download <ulink url="http://sourceforge.net/projects/foxserv/">FoxServ</ulink> and double-click on 								the exe to begin the install.		
						</para>
						<note>
							<para>
								FoxServ should be installed into the root of a directory (eg. c:/FoxServ) in order for Apache to 									function properly.
							</para>
						</note>
					</listitem>
					<listitem>
						<para>
							Enter email and hostname when prompted, such as the following:					
						</para>
						<programlisting>
    email: your_company.com
    hostname: 127.0.0.1						
						</programlisting>
					</listitem>
					<listitem>
						<para>
							After installing, start Apache, open your browser and enter <ulink url="http://127.0.0.1/">									http://127.0.0.1/</ulink>.
							You should see a FoxServ page with the date and some other information in the top right corner if 								Apache and PHP were installed correctly.
						</para>
					</listitem>
					<listitem>
						<para>
							Create a temp directory to store MapServer created GIFs.
							<emphasis>NOTE: This directory is specified in the IMAGEPATH parameter of the WEB Object in the <ulink url="http://mapserver.gis.umn.edu/doc/mapfile-reference.html">MapFile</ulink>
							</emphasis>. For this example we will call the temp directory “ms_tmp” (eg. E:/tmp/ms_tmp).
						</para>
					</listitem>
					<listitem>
						<para>
							Locate the file ‘httpd.conf’ in the ‘conf’ directory of Apache, and open it in a text viewer (eg. 									TextPad, Emacs, Notepad).
						</para>
						<para>
						     In order to setup PHP as a CGI and not as an Apache module, comment the following line:
						</para>
						<programlisting>
    LoadModule php4_module pathto/FoxServ/php/sapi/php4apache.dll
						</programlisting>
						<para>
							In the “Action” section of this file, add an action for the php.exe file:
						</para>
						<programlisting>
    Action application/x-httpd-php "/cgi-php/php.exe"				
						</programlisting>
						<para>
							In the “ScriptAlias” section of this file, add an alias for the PHP folder:
						</para>
						<programlisting>
    ScriptAlias /cgi-php/ "pathto/FoxServ/php/"				
						</programlisting>
						<para>
							In the “Alias” section of this file, add aliases to the ms_tmp folder and any other folder you require								(for this example we will use the “msapps” folder):
						</para>
						<programlisting>
    Alias   /ms_tmp/  "path/to/ms_tmp/"
    Alias   /msapps/  "path/to/msapps/"
						</programlisting>
					</listitem>
					<listitem>
						<para>
						Place the file <filename>php_mapscript.dll</filename> into your <emphasis>FoxServ/php/extensions							</emphasis> folder.	
					</para>
					</listitem>
					<listitem>
						<para>
			       		To verify that PHP and PHP/Mapscript were installed properly, create a '.php' file containing the following 						code and try to access it through your web server:		
					</para>
						<programlisting>
    &lt;HTML&gt;
    &lt;BODY&gt;

    &lt;?php 
      dl("php_mapscript.dll");
      phpinfo();
    ?&gt;

   &lt;/BODY&gt;
   &lt;/HTML&gt;
			</programlisting>
						<para>
			      If PHP and PHP/Mapscript were installed properly, several tables should be displayed on your page, and 					a section should appear on Mapscript, similar to the following:			
			</para>
						<programlisting>
    Mapscript:
    MapScript Version (Jan 9, 2001)
    MapServer Version 3.4 -GD_1_2 -PROJ.4 -FreeType -TIFF -EPPL7 -JPEG -OGR
			</programlisting>
					</listitem>
				</orderedlist>
			</sect3>
			<sect3 id="apache">
				<title>Manual Installation Using Apache Server</title>
				<orderedlist numeration="lowerroman">
					<listitem>
						<para>
									Download <ulink url="http://httpd.apache.org/">Apache Web Server</ulink> and extract it to 										the root of a directory (eg. D:/Apache).
								</para>
					</listitem>
					<listitem>
						<para>
									Download <ulink url="http://www.php.net/">PHP4</ulink> and extract it to your Apache folder 									(eg. D:/Apache/PHP4).
								</para>
					</listitem>
					<listitem>
						<para>
									Create a temp directory to store MapServer created GIFs.
									<emphasis>NOTE: This directory is specified in the IMAGEPATH parameter of the WEB Object in the <ulink url="http://mapserver.gis.umn.edu/doc/mapfile-reference.html">MapFile</ulink>
							</emphasis>. For this 										example we will call the temp directory “ms_tmp” (eg. E:/tmp/ms_tmp).
								</para>
					</listitem>
					<listitem>
						<para>
									Locate the file ‘httpd.conf’ in the ‘conf’ directory of Apache, and open it in a text viewer (eg. 										TextPad, Emacs, Notepad).
								</para>
						<para>
									In the “Alias” section of this file, add aliases to the ms_tmp folder and any other folder you 										require (for this example we will use the “msapps” folder):
								</para>
						<programlisting>
    Alias   /ms_tmp/   "path/to/ms_tmp/"
    Alias   /msapps/   "path/to/msapps/"
						</programlisting>
						<para>
									In the “ScriptAlias” section of this file, add an alias for the PHP4 folder.
								</para>
						<programlisting>
    ScriptAlias    /cgi-php4/     "pathto/apache/php4/"						
								</programlisting>
						<para>
									In the “AddType” section of this file, add a type for php4 files.
								</para>
						<programlisting>
    AddType application/x-httpd-php4   .php
								</programlisting>
						<para>
									In the “Action” section of this file, add an action for the php.exe file.
								</para>
						<programlisting>
    Action application/x-httpd-php4    "/cgi-php4/php.exe"						
								</programlisting>
					</listitem>
					<listitem>
						<para>
									Copy the file ‘php4.ini-dist’ located in your Apache/php4 directory and paste it into your 										WindowsNT folder (eg. c:/winnt), and then rename this file to ‘php.ini’ in your WindowsNT 										folder.
								</para>
					</listitem>
					<listitem>
						<para>
									If you want specific extensions loaded by default, open the 'php.ini' file in a text viewer
									and uncomment the appropriate extension.
								</para>
					</listitem>
					<listitem>
						<para>
							Place the file <filename>php_mapscript.dll</filename> into your <emphasis>										Apache/php4/extensions</emphasis> folder.
						</para>
					</listitem>
				</orderedlist>
			</sect3>
			<sect3 id="iis">
				<title>Installation Using Microsoft's IIS</title>
				<orderedlist numeration="lowerroman">
					<listitem>
						<para>
									Install IIS if required (see the IIS 4.0 installation procedure at <ulink url="http://support.microsoft.com/support/iis/install/install_iis4.asp">http://support.microsoft.com/support/iis/install/install_iis4.asp</ulink>). 
								</para>
					</listitem>
					<listitem>
						<para>
									Install PHP and PHP/Mapscript (see above).
								</para>
					</listitem>
					<listitem>
						<para>
									Open the Internet Service Manager (eg. C\WINNT\system32\inetsrv\inetmgr.exe).
								</para>
					</listitem>
					<listitem>
						<para>
									Select the Default web site and create a virtual directory (right click, select 												New/Virtual directory). <emphasis>For this example we will call the directory 												"msapps"</emphasis>.
								</para>
					</listitem>
					<listitem>
						<para>
									In the Alias field enter "msapps" and click Next. 
								</para>
					</listitem>
					<listitem>
						<para>
									Enter the path to the root of your application (eg. "c:\msapps") and click Next. 
								</para>
					</listitem>
					<listitem>
						<para>
								 	Set the directory permissions and click Finish.
								</para>
					</listitem>
					<listitem>
						<para>
									Select the msapps virtual directory previously created and open the directory 											property sheets (by right clicking and selecting properties) and then click on the Virtual 										directory tab. 
								</para>
					</listitem>
					<listitem>
						<para>
									Click on the Configuration button and then click the App Mapping tab. 
								</para>
					</listitem>
					<listitem>
						<para>
									Click Add and in the Executable box type: path\to\php4\php.exe %s %s. You MUST have 										the %s %s on the end, PHP will not function properly if you fail to do this. In the Extension 										box, type the file name extension to be associated with your PHP scripts. Usual extensions 										needed to be associated are phtml and php. You must repeat this step for each extension. 
								</para>
					</listitem>
					<listitem>
						<para>
								     Create a temp directory in Explorer to store MapServer created GIFs.
									<emphasis>NOTE: This directory is specified in the IMAGEPATH parameter of the WEB Object in the <ulink url="http://mapserver.gis.umn.edu/doc/mapfile-reference.html">MapFile</ulink>
							</emphasis>. For this 										example we will call the temp directory “ms_tmp” (eg. C:\tmp\ms_tmp).
								</para>
					</listitem>
					<listitem>
						<para>
									Open the Internet Service Manager again.
								</para>
					</listitem>
					<listitem>
						<para>
									Select the Default web site and create a virtual directory called ‘ms_tmp’ (right click, select 										New/Virtual directory). Set the path to the ms_tmp directory (eg. C:\tmp\ms_tmp) . The 										directory permissions should at least be set to Read/Write Access. 
								</para>
					</listitem>
				</orderedlist>
			</sect3>
		</sect2>
	</sect1>
	<!-- Section1: FAQ -->
	<sect1 id="FAQ">
		<title>FAQ / Common Problems</title>
		<sect2>
			<title/>
			<qandaset defaultlabel="qanda">
				<qandadiv>
					<title>Questions Regarding Documentation</title>
					<qandaentry>
						<question>
							<para>
							Is there any documentation available? 
						</para>
						</question>
						<answer>
							<para>
								The main reference document is the 
								<ulink url="http://mapserver.gis.umn.edu/doc/phpmapscript-class-guide.html">PHP/Mapscript 									Class Reference Guide</ulink>, which describes all of the current classes, properties and 									methods associated with the PHP/Mapscript module. 
							</para>
							<para>
                    				To get a more complete description of each class and the meaning of their member variables, see 								the MapServer MapScript documentation at: <ulink url="http://mapserver.gis.umn.edu/mapscript.html">http://mapserver.gis.umn.edu/mapscript.html</ulink> and the 										MapFile documentation at: <ulink url="http://mapserver.gis.umn.edu/mapfile.html">										http://mapserver.gis.umn.edu/mapfile.html</ulink>.                   
							</para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
							Where can I find sample scripts?
						</para>
						</question>
						<answer>
							<para>
						Some examples are included in directory mapserver/mapscript/php3/examples/ in the MapServer
                    		source distribution. A good one to get started is 'test_draw_map.phtml': it's a very simple script that
                    		just draws a map, legend and scalebar in an HTML page. 
						</para>
							<para>
                    		Unfortunately there is nothing intermediate yet... the next example is the <ulink url="http://www2.dmsolutions.ca/gmap/gmap75.phtml">GMap demo</ulink>. You can
                    		download the whole source and data files from <ulink url="http://www2.dmsolutions.ca/mapserver/dl">							http://www2.dmsolutions.ca/mapserver/dl</ulink>.
						</para>
						</answer>
					</qandaentry>
				</qandadiv>
				<qandadiv>
					<title>Questions About Installation</title>
					<qandaentry>
						<question>
							<para>
					     How can I tell that the module is properly installed on my server? 
						</para>
						</question>
						<answer>
							<para>
						First, copy the PHP test page mapserver/mapscript/php3/examples/phpinfo_mapscript.phtml and try
                    		to access it through your web server. If you get no error and the MapScript module shows up at the
                    		bottom of the list of PHP modules in the phpinfo() output, then the module is properly installed. 
						</para>
							<para>
                    		You can then try the second test page mapserver/mapscript/php3/examples/test_draw_map.phtml.
                    		This page simply opens a MapServer .map file and inserts its map, legend, and scalebar in an HTML
                    		page. Modify the page to access one of your own MapServer .map files, and if you get the expected
                    		result, then everything is probably working fine. 
						</para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
							I try to display my .phtml or .php page in my browser but the page is shown as it would it Notepad. 
						</para>
						</question>
						<answer>
							<para>
							The problem is that your PHP installation does not recognize ".phtml" as
							a PHP file extension.  Assuming you're using PHP4 under Apache then you
							need to add the following line with the other PHP-related AddType lines
							in the httpd.conf:
						</para>
							<programlisting>
    AddType application/x-httpd-php .phtml 
						</programlisting>
							<para>
							For a more detailed explanation, see the <link linkend="example">"Example Steps of a Full 								Windows Installation"</link> section of this document.
						</para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
						 	 I compiled php_mapscript.so on RedHat 6.2, it loads properly and is listed in the phpinfo()
               				output, but it crashes as soon as it try to open a .map file. What's wrong? 
						</para>
						</question>
						<answer>
							<para>
							On RedHat 6.2, Apache is compiled with the -DEAPI option which apparently has an impact on DSO
                    			modules like libphp3.so. I don't understand what -DEAPI does exactly, but it definitely has an impact
                    			on the way php_mapscript.so should be compiled. 
						</para>
							<para>
                    			You have to install apache-devel-1.3.12-2.i386.rpm, re-run configure in your PHP source directory 								with the --with-apxs switch (and all the other switches that the RH6.2 libphp3.so was compiled with), 							and then run configure in the mapserver directory with the --with-apxs switch as well. 
						</para>
							<para>
                    			Then recompile php_mapscript.so (make clean; make), copy it to /usr/lib/apache and everything
                    			should work fine. 
						</para>
							<para>
                    			See the <ulink url="http://www2.dmsolutions.ca/mapserver/php_mapscript/php_mapscript_redhat.html">step by step instructions for RedHat 							users</ulink> for more details.
						</para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
							I installed the PROJ.4 RPM from remotesensing.org on my system, it is recognized by
               				MapServer's "configure" as a system lib but at runtime I get an error: "libproj.so.0: No such file or
               				directory". 
						</para>
						</question>
						<answer>
							<para>
							You are probably running a RedHat Linux system if this happened to you. This happens because the
                    			RPM installs itself under /usr/local/lib but this directory is not part of the runtime library path by 								default on your system. 
						</para>
							<para>
                    			(I'm still surprised that "configure" picked proj.4 as a system lib since it's not in the system's lib 								path...probably something magic in autoconf that we'll have to look into) 
						</para>
							<para>
                    			There are a couple of possible solutions:
						</para>
							<literallayout>
                  1. Add a "setenv LD_LIBRARY_PATH" to your httpd.conf to contain that directory 
                  2. Edit /etc/ld.so.conf to add /usr/local/lib, and then run "/sbin/ldconfig". This will permanently add
                      /usr/local/lib to your system's runtime lib path. 
                  3. Configure MapServer with the following options:

                         --with-proj=/usr/local --enable-runpath

                      and the /usr/local/lib directory will be hardcoded in the exe and .so files
					</literallayout>
							<para>
                    I personally prefer option #2 because it is permanent and applies to everything running on your
                    system. Proj.4 probably won't be the only package to install itself in /usr/local/lib.
						</para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
							I have compiled PHP as a CGI and when PHP tries to load the php_mapscript.so, I get an
               				"undefined symbol: _register_list_destructors" error. What's wrong? 
						</para>
						</question>
						<answer>
							<para>
							Your PHP CGI executable is probably not linked to support loading shared libraries. The MapServer
                    			configure script must have given you a message about a flag to add to the PHP Makefile to enable
                    			shared libs. 
						</para>
							<para>
                    			Edit the main PHP Makefile and add "-rdynamic" to the LDFLAGS at the top of the Makefile, then
                    			relink your PHP executable. 
						</para>
							<para>
                    			Note: The actual parameter to add to LDFLAGS may vary depending on the system you're running 								on. On Linux it is "-rdynamic", and on *BSD it is "-export-dynamic". 
					     </para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
							Why can't both PHP and MapScript be compiled with Freetype support? 
						</para>
						</question>
						<answer>
							<para>
							You cannot have Freetype enabled in both PHP and MapServer because of a conflict with the gdttf.c
                    			and gdcache.c files that are included in both PHP and MapServer but are not identical. 
						</para>
							<para>
                    			We may try to fix that conflict in the future, but in the meantime, one of PHP or MapServer has to be
                    			compiled using --without-ttf. This is especially important with PHP4 because it includes TTF support
                    			by default. 
						</para>
						</answer>
					</qandaentry>
					<qandaentry>
						<question>
							<para>
						Does MapScript require that PHP3/PHP4 be a DSO? 
					</para>
						</question>
						<answer>
							<para>
						It does not, it will work either way. 
						</para>
							<para>
                    		However, if PHP was compiled as a DSO then you will have to pass the --with-apxs switch to the
                    		Maperver configure script. It is very important that the --with-apxs switch be provided if PHP was
                    		compiled as an Apache DSO, especially on systems like RedHat 6.2 where Apache comes compiled
                   			with the -DEAPI switch and this has an impact on DSO modules. 
						</para>
							<para>
                    We have used the PHP MapScript module with Apache with the 3 following configurations:
						<literallayout>
                         A - With PHP3 as a DSO
                         B - With PHP3 statically linked into Apache (httpd)
                         C - With PHP3 as a CGI
						</literallayout>
							</para>
							<para>
                    Note that for configurations B and C, the "-rdynamic" flag has to be added the LDFLAGS for Apache
                    (configuration B) or for PHP (configuration C) in order to enable loading shared libs (php_mapscript.so)
                    from your static executable (httpd or php). You don't need to do anything special for configuration A
                    because this is already taken care of when Apache is compiled to support DSO modules. 
						</para>
						</answer>
					</qandaentry>
				</qandadiv>
				<qandadiv>
					<title>General Questions</title>
					<qandaentry>
						<question>
							<para>
							I am running PHP 4.0.6 and I get crashes or "Invalid _handle_" errors when calling
               				map->getLayer(). 
						</para>
						</question>
						<answer>
							<para>
							There was a problem with the PHP/MapScript module in version 3.4 (and the development version 3.5
                    			until 2001/07/20) that caused crashes or odd error situations starting with PHP4.0.6, most of the 								time with the map->getLayer() call. This happens on both Windows and Unix. 
						</para>
							<para>
                    			See <ulink url="http://mapserver.gis.umn.edu/bugs/show_bug.cgi?id=23">Bug #23</ulink> for more 								details on this bug. 
						</para>
							<para>
                    			The solution is to either use MapServer 3.5 (dev. version after 2001/07/20) with PHP4.0.6 or newer, or
                    			MapServer 3.4 with PHP4.0.5 or older. PHP3 was not affected by this problem. 
						</para>
							<para>
                    			Note that backtracking to older versions of MapServers such as 3.4 or 3.3.011 with PHP 4.0.6 is not
                    			likely to resolve the problem. 
						</para>
						</answer>
					</qandaentry>
				</qandadiv>
			</qandaset>
		</sect2>
	</sect1>
	<!-- Section1: Document Info -->
	<sect1 id="docinfo">
		<title>About This Document</title>
		<sect2 id="copyright">
			<title>Copyright Information</title>
			<para>
                Copyright (c) 2001, Jeff McKenna, DM Solutions Group Inc.
            </para>
			<para>
                This documentation is covered by the same Open Source license as the
                MapServer software itself.  See MapServer's 
                <ulink url="http://mapserver.gis.umn.edu/license.html">License and 
                Credits</ulink> page for the complete text.
            </para>
		</sect2>
		<sect2 id="disclaimer">
			<title>Disclaimer</title>
			<para>
     				No liability for the contents of this document can be accepted.
    				Use the concepts, examples and other content at your own risk.
    				As this is a new edition of this document, there may be errors
    				and inaccuracies that may be damaging to your system.
    				Although this is highly unlikely, the author(s) do not take any 
    				responsibility for that:  proceed with caution.
                 	</para>
		</sect2>
		<!-- Section2: feedback -->
		<sect2 id="feedback">
			<title>Feedback</title>
			<para>
    				This is a new document for a new project; input is appreciated.  Send any
    				comments or suggestions to the MapServer Documentation Coordinator at
    				<email>mdp@lists.gis.umn.edu</email>.
   			</para>
		</sect2>
	</sect1>
</article>
