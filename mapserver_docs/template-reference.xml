<?xml version='1.0' standalone='no'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<article>
    <articleinfo>
        <title>MapServer Template Reference</title>
        <author>
            <firstname>Frank</firstname>
            <surname>Koormann</surname>
            <affiliation>
                <orgname>Intevation GmbH</orgname>
                <address>
                    <email>frank.koormann@intevation.de</email>
                </address>
            </affiliation>
        </author>
        <abstract>
            <para>
                This document is a reference for the MapServer 
                development version HTML template.
            </para>   
            <para>
                It is based on the previous versions written by Steve Lime
                <email>steve.lime@dnr.state.mn.us</email>
            </para>   
            <para>
                Last Updated:  2005-05-02
            </para>

      		<para><link linkend='rhistory'>Revision History</link></para>

        </abstract>
    </articleinfo>

    <sect1 id="intro">
        <title>MapServer - Documentation: Template File Reference</title>
        <para>
	Templates are used
	</para>
	<itemizedlist>
	    <listitem>
		<para>to define the look of a MapServer CGI application
		      interface and
		</para>
	    </listitem>
	    <listitem>
		<para>to present the results of a query.
		</para>
	    </listitem>
	</itemizedlist>
		
	<para>
	They guide the 
	presentation of results, either a query or a map, to the user. 
	Templates are almost always HTML files although they can also be a URL 
	(e.g.. http://www.somewhere.com/[ATTRIBUTE]/info.html). URL templates 
	can only be used with simple QUERY or ITEMQUERY results so many 
	substitutions defined below are not available for them. Simple pan/zoom 
	interfaces use a single template file while complicated queries often 
	require many templates. Templates often use JavaScript to enhance the 
	basic interface.

        </para>
    </sect1>
  
    <sect1 id="notes">
        <title>Notes</title>
        <itemizedlist>
	    <listitem>
		<para>
		    All <ulink url="cgi-reference.html">CGI parameters</ulink>
		    can be referenced in template
		    substitutions, MapServer specific parameters as well as 
		    user defined ones. In principle parameters are handed 
		    through by the
		    MapServer 1:1. This feature is essential for
		    implementing MapServer applications.
		</para>
		<para>
		    The reference below only lists special template
		    substitution strings which are needed to obtain 
		    information modified by the MapServer, e.g. a new scale,
		    query results, etc.
		</para>
            </listitem>
            <listitem>
                <para>
                    Template substitution strings <emphasis>are</emphasis> 
                    case sensitive. 
                </para>
            </listitem>
            <listitem>    
                <para>
                    Attribute item substitutions must be the same case as 
                    the item names in the dbase file.
                </para>
            </listitem>
            <listitem>
                <para>
                    ArcView and ArcInfo generally produce dbase files with 
                    item names that are all uppercase. Appropriate URL 
                    encoding (i.e. ' ' to '+') is applied when templates 
                    are URLs.
                </para>
            </listitem>
            <listitem>    
                <para>
                    Some substitutions are also available in escaped form
                    (i.e. URL encoded). 
                </para>
                <para>
                    As an example this is needed when 
                    generating links within a template. This might pass 
                    the current mapextent to a new MapServer
                    call. <literal>[mapext]</literal> is substituted by a space delimited set of
                    lower left and upper right coordinates. This would break
                    the URL. <literal>[mapext_esc]</literal> is substituted by a proper encoded
                    set.
                </para>
            </listitem>
        </itemizedlist>
    </sect1>
  
    <sect1 id="format">
        <title>Format</title>
        <para>
            Templates are simply HTML files or URL strings that contains 
            special characters that are replaced by mapserv each time 
            the template is processed. The simple substitution allows 
            information such as active layers or the spatial extent to
            be passed from the user to mapserv and back again.  Most
            often the new values are dumped into  form variables that
            will be passed on again. The list of special characters and
            form variables is given below. HTML templates can include
            just about anything including javascript and java calls.
        </para>

        <sect2 id="general">
        <title>General</title>
        <variablelist>

            <varlistentry>
                <term><literal>[version]</literal></term>
                <listitem>
                    <para> 
                        The MapServer version number.
                    </para>
                </listitem>
            </varlistentry>

            <varlistentry>
                <term><literal>[id]</literal></term>
                <listitem>
                    <para> 
                        Unique session id. The id can be passed in via
                        a form but is more commonly generated by the
                        software. In that case the id is a
                        concatenation of UNIX time (or NT equivalent)
                        and the process id. Unless you're getting more
                        requests in a second than the system has process ids
                        the id can be considered unique. ;->
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[host]</literal></term>
                <listitem>
                    <para> 
                        Hostname of the web server.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[port]</literal></term>
                <listitem>
                    <para> 
                        Port the web server is listening to.
                    </para>
                </listitem>
            </varlistentry>
            
            <varlistentry>
                <term>
                    <literal>[<replaceable>post or get variable name</replaceable>], 
                    [<replaceable>post or get variable
					name</replaceable>_esc]</literal> 
                </term>
                <listitem>
                    <para> 
                        The contents of any variables passed to the
                        MapServer, whether they were used or not, can
                        be echoed this way. One use might be to have
                        the user set a map title or north arrow style
                        in an interactive  map composer. The system
                        doesn't care about the values, but they might
                        be real important in creating the final output, e.g.
						if you specified a CGI parameter like
						<literal>myvalue=....</literal> you can access this in
						the template file with 
						<literal>[myvalue]</literal>.
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>

            <varlistentry>
                <term>
                    <literal>[web_<replaceable>meta data key</replaceable>],
                    [web_<replaceable>meta data key</replaceable>_esc]</literal>
                </term>
                <listitem>
                    <para> 
                        Web object meta data access (e.g <literal>[web_projection]</literal>
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>
            
            <varlistentry>
                <term>
                    <literal>[errmsg], [errmsg_esc]</literal>
                </term>
                <listitem>
                    <para> Current error stack output. Various error messages 
                            are delimited by semi-colons.
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>
        </variablelist>
         </sect2>

        <sect2 id="file_reference">
        <title>File Reference</title>
        <variablelist>
            <varlistentry>
                <term><literal>[img]</literal></term>
                <listitem>
                    <para> 
                        Path (relative to document root) of the new image,
                        just the image name if IMAGE_URL is not set in
                        the mapfile.
                    </para>
		    <para>
		    	In a map interface template, <literal>[img]</literal> 
			is substituted with the path to the map image. 
			In a query results template, it is substituted
			with the path to the querymap image (if a 
			QUERYMAP object is defined in the 
			<ulink url="mapfile-reference.html">map file</ulink>).
		    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[ref]</literal></term>
                <listitem>
                    <para> 
                        Path (relative to document root) of the new
                        reference image.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[legend]</literal></term>
                <listitem>
                    <para> 
                        Path (relative to document root) of new 
                        legend image rendered by the MapServer.
                    </para>
					<para>
					    Since version 3.5.1 a new HTML Legend template
						is provided by MapServer. If a template is defined 
						in the 
						<ulink url="mapfile-reference.html">map file</ulink>
						the <literal>[legend]</literal> string is replaced by the processed 
						legend as. See the specific
						<ulink url="html-legend-howto.html#template-file"
						>HTML Legend HOWTO</ulink> for details.
					</para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[scalebar]</literal></term>
                <listitem>
                    <para> 
                        Path (relative to document root) of new 
                        scalebar image.
                    </para>
                </listitem>
            </varlistentry>
        
        </variablelist>

        <variablelist>
            
            <varlistentry>
                <term><literal>[queryfile]</literal></term>
                <listitem>
                    <para> 
                        Path to the query file (if savequery was set as a
                        <ulink url="cgi-reference.html">CGI Parameter</ulink>). 
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[map]</literal></term>
                <listitem>
                    <para> 
                        Path to the map file (if savemap was set as a
                        <ulink url="cgi-reference.html">CGI Parameter</ulink>). 
                    </para>
                </listitem>
            </varlistentry>
  
        </variablelist>
        </sect2>

        <sect2 id="image_geometry">
        <title>Image Geometry</title>
        <variablelist>
            <varlistentry>
                <term><literal>[center]</literal></term>
                <listitem>
                    <para> 
                        Computed image center in pixels. Useful for
                        setting imgxy form variable when map sizes
                        change.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[center_x], [center_y]</literal></term>
                <listitem>
                    <para> 
                        Computed image center X or Y coordinate in pixels.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[mapsize], [mapsize_esc]</literal></term>
                <listitem>
                    <para> 
                        Current image size in cols and rows (separated
                        by spaces).
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[mapwidth], [mapheight]</literal></term>
                <listitem>
                    <para> 
                        Current image width or height.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[scale]</literal></term>
                <listitem>
                    <para> 
                        Current image scale. The exact value is not 
                        appropriate for user information but essential 
                        for some applications. The value can be rounded
                        e.g. using JavaScript or server side post
                        processing.
                    </para>
                </listitem>
            </varlistentry>
            
            <varlistentry>
                <term><literal>[cellsize]</literal></term>
                <listitem>
                    <para> 
                        Size of an pixel in the current image in map units. 
						Useful for distance measurement tools in user 
						interfaces.
                    </para>
                </listitem>
            </varlistentry>

        </variablelist>
        </sect2>
        
        <sect2 id="map_geometry">
        <title>Map Geometry</title>
        <variablelist>
            <varlistentry>
                <term><literal>[mapx], [mapy]</literal></term>
                <listitem>
                    <para> 
                        X and Y coordinate of mouse click.
                    </para>
                </listitem>
            </varlistentry>
 
            <varlistentry>
                <term><literal>[mapext], [mapext_esc]</literal></term>
                <listitem>
                    <para> 
                        Full mapextent (separated by spaces).
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>
 
            <varlistentry>
                <term><literal>[minx], [miny], [maxx], [maxy]</literal></term>
                <listitem>
                    <para> 
                        Minimum / maximum X or Y coordinate of new map extent.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[dx], [dy]</literal></term>
                <listitem>
                    <para> 
                        The differences of minimum / maximum X or Y 
						coordinate of new map extent. 
                    </para>
                    <para>
						Useful for creating cachable extents (i.e. 0 0 dx dy) 
						with legends and scalebars
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[rawext], [rawext_esc]</literal></term>
                <listitem>
                    <para> 
                        Raw mapextent, that is the extent before
                        fitting to a window size (separated by spaces).
                        In cases where input came from imgbox (via Java
                        or whatever) rawext refers to imgbox
                        coordinates transformed to map units.
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                    <para>
                        Useful for spatial query building.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[rawminx], [rawminy], [rawmaxx], [rawmaxy]</literal></term>
                <listitem>
                    <para> 
                        Minimum / maximum X or Y coordinate of a 
                        raw map/search extent.
                    </para>
                </listitem>
            </varlistentry>
        </variablelist>

        <para>
            The following substitutions are only available if the MapServer was 
            compiled with PROJ support and a projection
            is defined in the <ulink url="mapfile-reference.html#projection">
            mapfile</ulink>
        </para>

        <variablelist>
            <varlistentry>
                <term><literal>[maplon], [maplat]</literal></term>
                <listitem>
                    <para> 
                        Longitude / latitude value of mouse click.
                        Available only when projection enabled.
                    </para>
                </listitem>
            </varlistentry>
            
            <varlistentry>
                <term><literal>[mapext_latlon], [mapext_latlon_esc]</literal></term>
                <listitem>
                    <para> 
                        Full mapextent (separated by spaces).
                        Available only when projection enabled.
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>
            
            <varlistentry>
                <term><literal>[minlon], [minlat], [maxlon] [maxlat]</literal></term>
                <listitem>
                    <para> 
                        Minimum / maximum longitude or latitude value of 
                        mapextent.
                        Available only when projection enabled.
                    </para>
                </listitem>
            </varlistentry>
            
            <varlistentry>
                <term><literal>[refext], [refext_esc]</literal></term>
                <listitem>
                    <para> 
                        Reference map extent (separated by spaces).
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                    <para>
                        This template has been added with version 4.6 on behalf
                        of an enhancement request. See the thread in the 
                        <ulink url="http://mapserver.gis.umn.edu/bugs/show_bug.cgi?id=1102">MapServer Bugtracker (id 1102)</ulink> for potential use cases.
                    </para>
                </listitem>
            </varlistentry>
            
        </variablelist>
        </sect2>
        
        <sect2 id="layer">
        <title>Layer</title>
        <variablelist>
  
            <varlistentry>
                <term><literal>[layers] | [layers_esc]</literal></term>
                    <listitem> 
                        <para> 
                            All active layers space delimited. Used for a
							"POST" request. 
                        </para>
                        <para>
                            Also available as escaped version.
                        </para>
                    </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[toggle_layers] | [toggle_layers_esc]</literal></term>
                    <listitem> 
                        <para> 
                            List of <emphasis>all</emphasis> layers that can be								toggled, i.e. all layers defined in the
							<ulink url="mapfile-reference.html#layer"
							>map file</ulink>)
							which status is currently not
							<literal>default</literal>.
                        </para>
                        <para>
                            Also available as escaped version.
                        </para>
                    </listitem>
            </varlistentry>
  
            <varlistentry>
                <term>
                    <literal>[<replaceable>layername</replaceable>_check | select]</literal>
                </term>
                <listitem>
                    <para> 
                        Used for making layers persistent across a map
                        creation session. String is replaced with the
                        keyword "checked", "selected" or "" if
                        <emphasis>layername</emphasis> is on. Layername
                        is the name of a layer as it appears in the
                        <ulink url="mapfile-reference.html">map
                        file</ulink>.  
                        Does not work for default layers.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term>
                    <literal>[<replaceable>layername</replaceable>_<replaceable>meta
                    data key</replaceable>]</literal>
                </term>
                <listitem>
                    <para> 
                        Layer meta data access (e.g. <literal>[streets_build]</literal> the
						underscore is essential).
                    </para>
                </listitem>
            </varlistentry>
        </variablelist>
        </sect2>
        
        <sect2 id="zoom">
        <title>Zoom</title>
        <variablelist>
            <varlistentry>
                <term>
                    <literal>[zoom_minzoom to maxzoom_check|select]</literal>
                </term>
                <listitem>
                    <para> 
                        Used for making the zoom factor persistent.
                        Zoom values can range from -25 to 25 by
                        default. The string is replaced with the HTML
                        keyword "checked", "selected" or "" depending
                        on the current zoom value.
                    </para>
                    <para>
						E.g. if the zoom is 12, a <literal>[zoom_12_select]</literal> is replaced 
						with "selected", while a <literal>[zoom_13_select]</literal> in the same
						HTML template file is not.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term>
                    <literal>[zoomdir_-1|0|1_check|select]</literal>
                </term>
                <listitem>
                    <para> 
                        Used for making the zoom direction persistent.
                        Use check with a radio control or select with a
                        selection list. See the demo for an example.
                        The string is replaced with the HTML keyword
                        "checked", "selected" or "" depending on the
                        current value of zoomdir.
                    </para>
                </listitem>
            </varlistentry>

        </variablelist>
        </sect2>
        
        <sect2 id="query">
        <title>Query</title>
        <para>
            The following substitutions are only available 
            when
            the template is processed as a result of a query.
        </para>
        <variablelist>
  
            <varlistentry>
                <term><literal>[shpext], [shpext_esc]</literal></term>
                <listitem>
                    <para> 
                        Extent of current shape plus a 5 percent
                        buffer. Available only when processing query
                        results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[shpminx], [shpminy], [shpmaxx], [shpmaxy]</literal></term>
                <listitem>
                    <para> 
                        Minimum / maximum X or Y coordinate of shape extent.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>

            <varlistentry>
                <term><literal>[shpmid]</literal></term>
                <listitem>
                    <para> 
                        Middle of the extent of current shape.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[shpmidx], [shpmidy]</literal></term>
                <listitem>
                    <para> 
                        X or Y coordinate of middle of the extent of the 
                        current shape.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[shpidx]</literal></term>
                <listitem>
                    <para> 
                        Index value of the current shape.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[shpclass]</literal></term>
                <listitem>
                    <para> 
                        Classindex value of the current shape.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[shpxy <emphasis>formatting options</emphasis>]</literal></term>
                <listitem>
                    <para> 
			The list of shape coordinates, 
			with list formatting options, especially useful for SVG.
		    </para>
		    <para>
			The default template [shpxy] returns a comma seperated
			list of space delimited of coordinates 
			(i.e. x1 y1, x2 y2, x3 y3). 
		    </para>
		    <para>
                        Available only when processing query results.
                    </para>
		    <para>
			Available attributes (h = header, f=footer,
			s=seperator):
		    </para>
		    <variablelist>
			<varlistentry>
                	<term>cs=</term>
                	<listitem>
			    <para>
				Coordinate seperator, default is comma (",").
			    </para>
                	</listitem>
			</varlistentry>

			<varlistentry>
                	<term>xh=, xf=</term>
                	<listitem>
			    <para>
				Characters to put before and after the 
				x coordinates (defaults are xh="" and xf=" ").
			    </para>
                	</listitem>
			</varlistentry>

			<varlistentry>
                	<term>yh= yf=</term>
                	<listitem>
			    <para>
				Characters to put before and after the 
				y coordinates (defaults are no characters).
			    </para>
                	</listitem>
			</varlistentry>

			<varlistentry>
                	<term>ph=, pf=, ps=</term>
                	<listitem>
			    <para>
				Characters to put before and after and
				seperators between feature parts 
				(e.g. holes, defaults are no characters).
			    </para>
                	</listitem>
			</varlistentry>

			<varlistentry>
                	<term>sh=, sf=</term>
                	<listitem>
			    <para>
				Characters to put before and after a feature 
				(defaults are no characters) 
			    </para>
                	</listitem>
			</varlistentry>

			<varlistentry>
                	<term>precision=</term>
                	<listitem>
			    <para>
				The number of decimal places to output for 
				coordinates (default is 0).
			    </para>
                	</listitem>
			</varlistentry>

			<varlistentry>
                	<term>proj=</term>
                	<listitem>
			    <para>
				The output projection definition for the 
				coordinates (default is none), a special 
				value of "image" will convert to image 
				coordinates. 
			    </para>
                	</listitem>
			</varlistentry>
		    </variablelist>
		    <para>
			As a simple example [shpxy xh="(" yf=")"] will 
			result in: (x1 y1),(x2 y2),(x3 y3)
		    </para>
                </listitem>
            </varlistentry>
  

            <varlistentry>
                <term><literal>[tileindex]</literal></term>
                <listitem>
                    <para> 
                        Index value of the current tile. If no tiles used for
                        the current shape this is replaced by "-1".
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[<replaceable>DBASE item name</replaceable>],
					  [<replaceable>DBASE item name</replaceable>_esc],
					  [<replaceable>DBASE item name</replaceable>_raw]</literal></term>
                <listitem>
                    <para> 
                        Item name from the attribute table of a queried
                        layer. Only attributes for the active query
                        layers are accessible. Case must be the same as
                        what is stored in the DBASE file. ArcView, for
                        example, uses all caps for shapefile field
                        names.
                        Available only when processing query results.
                    </para>
					<para>
						By default the attributes are encoded especially for 
						HTML representation. In addition the escaped version 
						(for use in URLs) as well as the raw data is available.
					</para>
                </listitem>
            </varlistentry>

            <varlistentry>
                <term><literal>[<replaceable>Join name</replaceable>_<replaceable>DBASE item name</replaceable>],
					  [<replaceable>Join name</replaceable>_<replaceable>DBASE item name</replaceable>_esc],
					  [<replaceable>Join name</replaceable>_<replaceable>DBASE item name</replaceable>_raw]</literal></term>
                <listitem>
                    <para> 
                        One-to-one joins: 
						First the 
						join name (as specified in the 
						<ulink url="mapfile-reference.html#join"
						>map file</ulink>)
						has to be given, second 
						the tables fields can be accessed similar to the layers
						attribute data.
                        Available only when processing query results.
                    </para>
					<para>
						By default the attributes are encoded especially for 
						HTML representation. In addition the escaped version 
						(for use in URLs) as well as the raw data is available.
                    </para>
                </listitem>
            </varlistentry>

			<varlistentry>
                <term><literal>[join_<replaceable>Join name</replaceable>]</literal></term>
				<listitem>
					<para>One-to-many joins: The more complex variant. If the 
						join type is multiple (one-to-many) 
						the template is replaced by 
						the set of header, template file and footer
						specified in the 
						<ulink url="mapfile-reference.html#join"
						>map file</ulink>.
					</para>
				</listitem>
			</varlistentry>

			<varlistentry>
                <term>
                    <literal>[metadata_<replaceable>meta data key</replaceable>],
                    [metadata_<replaceable>meta data key</replaceable>_esc]</literal>
                </term>
                <listitem>
                    <para> 
                        Queried layer meta data access 
						(e.g <literal>[metadata_projection]</literal>
                    </para>
                    <para>
                        Also available as escaped version.
                    </para>
                </listitem>
            </varlistentry>

        </variablelist>
        
        <para>
            For query modes that allow for multiple result sets, the
            following string substitutions are available. For
            FEATURESELECT and FEATURENSELECT modes the totals are
            adjusted so as not to include the selection layer. The
            selection layer results ARE available for display to the
            user.
        </para>

        <variablelist>
            <varlistentry>
                <term><literal>[nr]</literal></term>
                <listitem>
                    <para> 
                        Total number of results. Useful in web header and
                        footers.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[nl]</literal></term>
                <listitem>
                    <para> 
                        Number of layers returning results. Useful in web
                        header and footers.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[nlr]</literal></term>
                <listitem>
                    <para> 
                        Total number of results within the current layer.
                        Useful in web header and footers.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
            <varlistentry>
                <term><literal>[rn]</literal></term>
                <listitem>
                    <para> 
                        Result number within all layers. Starts at
                        1. Useful in web header and footers.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>

            <varlistentry>
                <term><literal>[lrn]</literal></term>
                <listitem>
                    <para> 
                        Result number within the current layer. Starts at
                        1. Useful in query templates.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><literal>[cl]</literal></term>
                <listitem>
                    <para> 
                        Current layer name. Useful in layer headers and
                        footers.
                        Available only when processing query results.
                    </para>
                </listitem>
            </varlistentry>
  
  
        </variablelist>

        </sect2>
    </sect1>

<sect1 id="example">
     <title>Example</title>
     <para>
         A small example to give an idea how to work with templates. 
         Note that it covers 
         MapServer specific templates (e.g. the <literal>[map]</literal>,
         <literal>[mapext]</literal>) and 
         user defined templates (e.g. <literal>[htmlroot]</literal> or 
         <literal>[program]</literal>) used to store application settings.
     </para>
     <para>
       <programlisting>
<![CDATA[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
       "http://www.w3.org/TR/html4/transitional.dtd">
<html>
  <head>
    <title>MapServer Template Sample</title>
  </head>

  <body>
    MapServer Template Sample<br>

    <!-- The central form the application is based on. -->
    <form method="GET" action="[program]">

    <!-- CGI MapServer applications are server stateless in principle, 
         all information must be "stored" in the client. This includes 
         some basic settings as below.                                
         The example is based on the pan and zoom test suite:
         http://maps.dnr.state.mn.us/mapserver_demos/tests36/           -->
      <input type="hidden" name="map" value="[map]">
      <input type="hidden" name="imgext" value="[mapext]">
      <input type="hidden" name="imgxy" value="149.5 199.5">    
      <input type="hidden" name="program" value="[program]">
      <input type="hidden" name="htmlroot" value="[htmlroot]">
      <input type="hidden" name="map_web_imagepath" value="[map_web_imagepath]">
      <input type="hidden" name="map_web_imageurl" value="[map_web_imageurl]">

      <!-- A table for minimal page formatting. -->
      <table border=0 cellpadding=5>
      <tr>
        <!-- First column: Map and scale bar -->
        <td align=center>
          <!-- The map -->
          <input type="image" name="img" src="[img]" 
                 style="border:0;width:300;height:400">
          <br>
          <!-- The scale bar-->
          <img src="[scalebar]" alt="Scale Bar">
        </td>

        <!-- Second column: Zoom direction, Legend and Reference -->
        <td valign=top>
          <!-- Zoom direction -->
          <b>Map Controls</b><br>
          Set your zoom option:<br>
          <select name="zoom" size="1">
            <option value="2" [zoom_2_select]> Zoom in 2 times
            <option value="1"  [zoom_1_select]> Recenter Map
            <option value="-2" [zoom_-2_select]> Zoom out 2 times
          </select>
          <br>
      
          <!-- Legend -->
          <b>Legend</b><br>
          <img src="[legend]" alt="Legend"><br><br><br><br>
               
          <!-- Reference map -->
         <input type="image" name="ref" src="[ref]" 
                style="border:0;width:150;height:150">
        </td>
      </tr>
      </table>
 
    </form>

  </body>
</html>
]]>
       </programlisting>
     </para>
</sect1>
<!-- Section1: Document Info -->
<sect1 id='docinfo'> 
  <title>About This Document</title>

  <para> 
  
  The document revision history starts with UMN MapServer 4.2 altough the
  document is older. The numbering is in parallel with the revision control
  system.
  
  </para>

  <sect2 id='rhistory'><title>Revision History</title>


  <para>
    <revhistory>

      <revision>
        <revnumber>Number: 1.16</revnumber>
        <date>Date: 2005-05-02</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Added [refext], [refext_esc], [errmsg] and [errmsg_esc] 
                   templates.
		</revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.15</revnumber>
        <date>Date: 2004-12-25</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Extended [img] documentation suggested by Ken Boss.
		</revremark>
      </revision>

      <revision>
        <revnumber>Number: 1.13</revnumber>
        <date>Date: 2004-12-13</date>
        <authorinitials>Author: Kari Geurts</authorinitials>
                <revremark>removed the 4.3 version and changed the last updated date
                </revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.12</revnumber>
        <date>Date: 2004-11-30</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Added section with template example.
		</revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.11</revnumber>
        <date>Date: 2004-11-11</date>
        <authorinitials>Author: Daniel Morissette</authorinitials>
		<revremark>Removed obsolete [get_layers] tag.
		</revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.10</revnumber>
        <date>Date: 2004-11-09</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Added note about CGI parameter substitution.
		</revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.9</revnumber>
        <date>Date: 2004-10-15</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Added [shpclass] and [shpxy] templates.
		</revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.9</revnumber>
        <date>Date: 2004-10-15</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Added [shpclass] and [shpxy] templates.
		</revremark>
      </revision>
      <revision>
        <revnumber>Number: 1.8</revnumber>
        <date>Date: 2004-06-04</date>
        <authorinitials>Author: Frank Koormann</authorinitials>
		<revremark>Update to MapServer version 4.2:
        [metadata_<replaceable>meta data key</replaceable>] 
			template and 
			Document info section added.</revremark>
      </revision>
    </revhistory>  
  </para>  
  </sect2>
  <sect2 id='copyright'>
   <title>Copyright Information</title>
   
   <para>
    Copyright (c) 2001, 2002, 2003, 2004, Frank Koormann, Steve Lime.
   </para>
   <para>
    This documentation is covered by the same Free Software license as the MapServer software.
    See MapServer's
    <ulink url='http://mapserver.gis.umn.edu/license.html'>License and 
    Credits</ulink> page for the complete text.
   </para>
  </sect2>

  <sect2 id='disclaimer'>
   <title>Disclaimer</title>

   <para>
    No liability for the contents of this document can be accepted.
    Use the concepts, examples and other content at your own risk.
    As this is a new edition of this document, there may be errors
    and inaccuracies that may be damaging to your system.
    Although this is highly unlikely, the author(s) do not take any 
    responsibility for that:  proceed with caution.
   </para>

  </sect2>

<!-- Section2: feedback -->

  <sect2 id='feedback'>
   <title>Feedback</title>
   <para>
    Send any comments or suggestions to the author(s).
   </para>
   </sect2>

 </sect1>
</article>
