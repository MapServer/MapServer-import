<?xml version='1.0' standalone='no'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<article>
	<articleinfo>
		<title>MapServer Template Reference</title>
		<author>
			<firstname>Stephen</firstname>
			<surname>Lime</surname>
			<affiliation>
				<orgname>Minnesota Department of Natural Resources</orgname>
				<address>
					<email>steve.lime@dnr.state.mn.us</email>
				</address>
			</affiliation>
		</author>
		<abstract>
			<para>
    			This document is a reference for the MapServer version 3.5 HTML template.
    			</para>   
    			<para>Last Updated:  07-24-2001</para>
		</abstract>
	</articleinfo>
  <sect1 id="intro">
    <title>MapServer - Documentation: Template File Reference</title>

    <para>
    Templates are used to define the look of an interface and to guide the presentation of results, 
    either a query or a map, to the user. A template can be eithera URL 
    (eg. http://www.somewhere.com/[ATTRIBUTE]/info.html) or HTML file(s). Simple pan/zoom 
    interfaces use a single template file while compilicated queries often require many templates. 
    URL templates can only be used with simple QUERY or ITEMQUERY results so many substitutions 
    defined below are not available.
    </para>
    
  </sect1>
  
  <sect1 id="notes">
    <itemizedlist>
      <listitem>
        <para>Template substitution strings <emphasis>are</emphasis> case sensitive. </para>
      </listitem>
      <listitem>	
	<para>Attribute item substitutions must be the same case as the item names in the dbase 
	file.</para>
      </listitem>
      <listitem>
        <para>ArcView and ArcInfo generally produce dbase files with item names that are all 
	uppercase. Appropriate URL encoding (i.e. ' ' to '+') is applied when templates are URLs.
	</para>
      </listitem>
    </itemizedlist>
  </sect1>
  
  <sect1 id="notes">
    <title>Format</title>
    <para>Templates are simply HTML files or URL strings that contains special characters that are 
    replaced by mapserv each time the template is processed. The simple substitution allows 
    information such as active layers or the spatial extent to be passed from the user to mapserv 
    and back again.  Most often the new values are dumped into  form variables that will be passed 
    on again. The list of special characters and form variables is given below. HTML templates can 
    include just about anything including javascript and java calls.
    </para>

    <variablelist>
      <varlistentry>
        <term>[id]</term>
	<listitem><para> Unique session id. The id can be passed in via a form but is more commonly
	 generated by the software. In that case the id is a concatenation of UNIX time (or NT 
	 equivalent) and the process id. Unless your getting more requests in a second than 
	 allowable process ids the id can be considered unique. ;->
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[get_layers]</term>
	<listitem><para> All active layers formated for inclusion in a URL. (i.e. 
	layer=layer1&amp;layer=layer2 and so on...)
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[layers]</term><listitem><para> All active layers space delimited.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[<replaceable>layername</replaceable>_check|select]</term>
	<listitem><para> Used for making layers persistant across a map creation session. String is
	 replaced with the keyword "checked", "selected" or "" if <emphasis>layername</emphasis> is
	 on. Layername is the name of a layer as it appears in the <ulink 
	 url="mapfile-reference.html">map file</ulink>.
	 </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[<replaceable>layername</replaceable>_desc]</term>
	<listitem><para> Used for accessing the layer DESCRIPTION for active layers and NOT default
	 layers. Replaced with an empty string if the layer is OFF.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[<replaceable>layername</replaceable>_leg]</term>
	<listitem><para> Used for accessing the layer LEGEND for active layers and NOT default 
	layers. Replaced with an empty string if the layer is OFF.
        </para></listitem>
      </varlistentry>

      </variablelist><variablelist>

      
      <varlistentry>
        <term>[mapx]</term>
	<listitem><para> X coordinate of mouse click.
        </para></listitem>
      </varlistentry>
     
      <varlistentry>
        <term>[mapy]</term>
	<listitem><para> Y coordinate of mouse click.
        </para></listitem>
      </varlistentry>
     
      <varlistentry>
        <term>[mapext]</term>
	<listitem><para> Full mapextent (seperated by spaces).
        </para></listitem>
      </varlistentry>
     
      <varlistentry>
        <term>[minx]</term>
	<listitem><para> Minimum X coordinate of new map extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[miny]</term>
	<listitem><para> Minimum Y coordinate of new map extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[maxx]</term>
	<listitem><para> Maximum X coordinate of new map extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[maxy]</term><listitem>
	<para> Maximum Y coordinate of new map extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[rawext]</term>
	<listitem><para> Raw mapextent, that is the extent before fitting to a window size 
	(seperated by spaces). In cases where input came from imgbox (via Java or whatever) rawext 
	refers to imgbox coordinates transformed to map units.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[rawminx]</term>
	<listitem><para> Minimum X coordinate of aww map/search extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[rawminy]</term>
	<listitem><para> Minimum Y coordinate of raw map/search extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[rawmaxx]</term>
	<listitem><para> Maximum X coordinate of raw map/search extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[rawmaxy]</term>
	<listitem><para> Maximum Y coordinate of raw map/search extent.
        </para></listitem>
      </varlistentry>
      </variablelist><variablelist>

      
      <varlistentry>
        <term>[mapsize]</term>
	<listitem><para> Current image size in cols and rows (seperated by spaces).
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[mapwidth]</term>
	<listitem><para> Current image width.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[mapheight]</term>
	<listitem><para> Current image width.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[center]</term>
	<listitem><para> Computed image center in pixels. Useful for setting imgxy form variable 
	when map sizes change.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[center_x]</term>
	<listitem><para> Computed image center x coordinate in pixels.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[center_y]</term>
	<listitem><para> Computed image center y coordinate in pixels.
        </para></listitem>
      </varlistentry>
      
      </variablelist><variablelist>

      
      <varlistentry>
        <term>[img]</term>
	<listitem><para> Path (relative to document root) of new image, just the image name if 
	IMAGE_URL is not set in the mapfile
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[ref]</term>
	<listitem><para> Path (relative to document root) of new reference image.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[legend]</term>
	<listitem><para> Path (relative to document root) of new legend image.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[scalebar]</term>
	<listitem><para> Path (relative to document root) of new scalebar image.
        </para></listitem>
      </varlistentry>
      </variablelist><variablelist>

      
      <varlistentry>
        <term>[scale]</term>
	<listitem><para> Current image scale.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[host]</term>
	<listitem><para> Hostname of the web server.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[port]</term>
	<listitem><para> Port the web server is listening to.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[pid]</term>
	<listitem><para> Process ID.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[time]</term>
	<listitem><para> Time() at the begining of the MapServer execution. Used with the process 
	ID to build unique file names.
        </para></listitem>
      </varlistentry>
      
      </variablelist><variablelist>
      
      <varlistentry>
        <term>[zoom_minzoom to maxzoom_check|select]</term>
	<listitem><para> Used for making the zoom factor persistant. Zoom values can range from 
	-25 to 25 by default. The string is replaced with the HTML keyword "checked", "selected" 
	or "" depending on the current zoom value.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[zoomdir_-1|0|1_check|select]</term>
	<listitem><para> Used for making the zoom direction persistant. Use check with a radio 
	control or select with a selection list. See the demo for an example. The string is 
	replaced with the HTML keyword "checked", "selected" or "" depending on the current value 
	of zoomdir.
        </para></listitem>
      </varlistentry>
      </variablelist><variablelist>

      <varlistentry>
        <term>[post or get variable name]</term>
	<listitem><para> The contents of any variables passed to the MapServer, whether they were 
	used or not, can be echoed this way. One use might be to have the user set a map title or 
	north arrow style in an interactive  map composer. The system  doesn't care about the 
	values, but they might be real important in creating the final output.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[DBASE item name]</term>
	<listitem><para> Item name from the attribute table of a queried layer. Only attributes for
	 the active query layers are accessible. Case must be the same as what is stored in the 
	 DBASE file. ArcView, for example, uses all caps for shapefile field names.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpext]</term>
	<listitem><para> Extent of current shape plus a 5 percent buffer. Available only when 
	processing query results.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpidx]</term>
        <listitem><para> Index value of the current shape.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpmid]</term>
	<listitem><para> Middle of the extent of current shape. Available only when processing query
        results.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpminx]</term>
	<listitem><para> Minimum X coordinate of shape extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpminy]</term>
	<listitem><para> Minimum Y coordinate of shape extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpmaxx]</term>
	<listitem><para> Maximum X coordinate of shape extent.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[shpmaxy]</term>
	<listitem><para> Maximum Y coordinate of shape extent.
        </para></listitem>
      </varlistentry>
      
      </variablelist><variablelist>

      <varlistentry>
        <term>[zoom_minzoom to maxzoom_check|select]</term>
	<listitem><para> Used for making the zoom factor persistant. Zoom values can range from 
	-25 to 25 by default. The string is replaced with the HTML keyword "checked", "selected" or
	 "" depending on the current zoom value.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[zoomdir_-1|0|1_check|select]</term>
	<listitem><para> Used for making the zoom direction persistant. Use check with a radio 
	control or select with a selection list. See the demo for an example. The string is 
	replaced with the HTML keyword "checked", "selected" or "" depending on the current value 
	of zoomdir.
        </para></listitem>
      </varlistentry>

      <para>
      For query modes that allow for multiple result sets, the following string substitutions are 
      available. For FEATURESELECT and FEATURENSELECT modes the totals are adjusted so as not to 
      include the selection layer. The selection layer results ARE available for display to the 
      user.
      </para>

      
      <varlistentry>
        <term>[cl]</term>
	<listitem><para> Current layer name. Useful in layer headers and footers.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[cld]</term>
	<listitem><para> Current layer description. Useful in layer headers and footers.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[lrn]</term>
	<listitem><para> Result number within the current layer. Starts at 1. Useful in query 
	templates.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[nl]</term>
	<listitem><para> Number of layers returning results. Useful in web header and footers.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[nr]</term>
	<listitem><para> Total number of results. Useful in web header and footers.
        </para></listitem>
      </varlistentry>
      
      <varlistentry>
        <term>[rn]</term>
	<listitem><para> Result number within all query results. Starts at 1. Useful in web header 
	and footers.
        </para></listitem>
      </varlistentry>
    </variablelist>

  </sect1>
</article>
