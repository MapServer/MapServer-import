<?xml version="1.0" standalone="no"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<article>
  <articleinfo>
    <title>             MapServer Styled Layer Descriptor (SLD) HOWTO - Version 4.4</title>
    <author>
      <firstname>       Yewondwossen </firstname>
      <surname>         Assefa</surname>
      <affiliation>
        <orgname>       DM Solutions Group Inc.</orgname>
        <address>
                 <email>assefa@dmsolutions.ca</email>
        </address>
      </affiliation>
    </author>
    <author>
      <firstname>Jeff</firstname>
      <surname>McKenna</surname>
      <affiliation>
        <orgname>DM Solutions Group Inc.</orgname>
        <address>
          <email>jmckenna@dmsolutions.ca</email>
        </address>
      </affiliation>
    </author>
    <abstract>
      <para>
                        This document describes the procedures for taking advantage of the Styled Layer Descriptor (SLD) support in WFS GetMap requests that has been added to MapServer 4.2.                     
      </para>  
      <para>            
                        Last Updated: 2005-01-09
      </para>
      <para>
          <link linkend="rhistory">Revision History</link>
      </para>       
    </abstract>
  </articleinfo>
  <sect1 id="intro">
    <title>             Introduction</title>
    <blockquote><attribution>Styled Layer Descriptor Implementation Specification, OGC</attribution>
      <para>
                        &quot;However, while a WMS currently can provide the user with a choice of style options, the WMS can only tell the user the name of each style. It cannot tell the user what portrayal will look like on the map. More importantly, the user has no way of defining their own styling rules. The ability for a human or machine client to define these rules requires a styling language that the client and server can both understand. Defining this language, called the StyledLayerDescriptor (SLD)...&quot;   
      </para>
    </blockquote>  
    <para>
                        SLD support has been developed for the server side support (ability to read an SLD and apply it with a GetMap request) and for the client side (includes sending SLD requests to server and generate SLD files on the fly from MapServer map file).
    </para>
    <para>
                        This document assumes that you are already familiar with the following aspects of MapServer:
    </para>
      <itemizedlist>
        <listitem>
          <para>
                        MapServer application development and setting up <filename>.map</filename> files. 
          </para>
        </listitem>
        <listitem>
          <para>
                        Familiarity with the WMS specification would be an asset. Links to the MapServer WMS documents are included in the next section.
          </para>
        </listitem>
      </itemizedlist>
      <sect2 id="links">
        <title>         Links to SLD-related Information</title>
        <itemizedlist>
          <listitem>
            <para>
                        <emphasis>Styled Layer Descriptor Implementation Specification</emphasis> at <ulink url="http://www.opengeospatial.org/docs/02-070.pdf">http://www.opengeospatial.org/docs/02-070.pdf</ulink>.
            </para>
          </listitem>
          <listitem>
            <para>
                        <emphasis>MapServer WMS Client HOWTO</emphasis> at <ulink url="http://mapserver.gis.umn.edu/doc/wms-client-howto.html">http://mapserver.gis.umn.edu/doc/wms-client-howto.html</ulink>.
            </para>
          </listitem>
          <listitem>
            <para>
                        <emphasis>MapServer WMS Server HOWTO</emphasis> at <ulink url="http://mapserver.gis.umn.edu/doc/wms-server-howto.html">http://mapserver.gis.umn.edu/doc/wms-server-howto.html</ulink>.
            </para>
          </listitem>          
          <listitem>
            <para>
                        Open GIS Consortium (OGC) home page at <ulink url="http://www.opengeospatial.org">http://www.opengeospatial.org</ulink>.
            </para>
          </listitem>          
        </itemizedlist>
     </sect2>
  </sect1>  
  <sect1 id="server">
    <title>             Server Side Support</title>
    <para>
                        This section describes how to use FE on both the server and client sides.
    </para>                    
    <sect2 id="general">
      <title>           General Information</title>
      <para>
                        There are two ways a WMS request can pass an SLD document with a GetMap request to MapServer:
      </para>
      <itemizedlist>
        <listitem>
          <para>
                        SLD parameter pointing to remote SLD (SLD=http://URL_TO_SLD).
          </para>
        </listitem>
        <listitem>
          <para>
                        SLD_BODY parameter to send the SLD definition in the URL.
          </para>
        </listitem>
      </itemizedlist>
      <para>
                        These two methods are both available through MapServer. An example of a request would be:
      </para>
      <para>
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_simple.xml">
http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_simple.xml</ulink>
      </para>
      <para>
        The SLD in the above request follows:
      </para>
      <programlisting>
        &lt;StyledLayerDescriptor version="1.0.0"&gt;
          &lt;NamedLayer&gt;
            &lt;Name&gt;WorldGen_Outline&lt;/Name&gt;
            &lt;UserStyle&gt;
              &lt;Title&gt;xxx&lt;/Title&gt;
              &lt;FeatureTypeStyle&gt;
                &lt;Rule&gt;
                &lt;LineSymbolizer&gt;
                 &lt;Geometry&gt;
                   &lt;PropertyName&gt;center-line&lt;/PropertyName&gt;
                 &lt;/Geometry&gt;
                 &lt;Stroke&gt;
                   &lt;CssParameter name="stroke"&gt;#0000ff&lt;/CssParameter&gt;
                 &lt;/Stroke&gt;
                &lt;/LineSymbolizer&gt;
                &lt;/Rule&gt;
              &lt;/FeatureTypeStyle&gt;
            &lt;/UserStyle&gt;
          &lt;/NamedLayer&gt;
        &lt;/StyledLayerDescriptor&gt;      
      </programlisting>
      <para>
                        When MapServer gets a valid SLD through a request, it parses this SLD to extract all the styles attached to the NamedLayers, and then it applies these styles to the map before it is returned to the client. When applying the SLD, MapServer compares the names used in the map files with the names of the NamedLayers in the SLD document.
      </para>
      <para>
                        Note : All the examples given in this document use valid SLDs and a MapServer with SLD support installed on DM Solutions site.
      </para>
      <para>
                        Additional WMS features related to SLDs have also been developed:
      </para>
    <table frame='all'><title>Additional WMS Features </title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>            
          <row>
            <entry>Method GET : SLD URL</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>   
          <row>
            <entry>Method GET : SLD_BODY</entry>
            <entry>Yes</entry>
            <entry>Additional item.</entry>
          </row>    
          <row>
            <entry>Describer Layer</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>   
          <row>
            <entry>GetLegendGraphic</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>  
          <row>
            <entry>GetStyles</entry>
            <entry>Yes</entry>
            <entry>Uses MapScript to get the SLD.</entry>
          </row>             
        </tbody>
      </tgroup>
    </table>     
    </sect2>
    <sect2 id="specific">
      <title>Specific SLD Elements Supported</title>
      <para>
                        The following tables give a lot of additional details about SLD support in MapServer.
      </para>                  
      <itemizedlist>
        <listitem>
    <table frame='all'><title>Named Layers and User Layers</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Named Layers</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>User Layers</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>        
        </tbody>
      </tgroup>
    </table>   
    <para>
      
    </para>
        </listitem>
        <listitem>
    <table frame='all'><title>Named Styles and User Styles</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Named Styles</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>User Styles</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>        
        </tbody>
      </tgroup>
    </table>               
    <para>
      
    </para>    
        </listitem>
        <listitem>
    <table frame='all'><title>User Styles</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Name</entry>
            <entry>No</entry>
            <entry>This was removed at implementation time, since it does not fit with MapServer.</entry>
          </row>             
          <row>
            <entry>Title</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row> 
          <row>
            <entry>Abstract</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row>    
          <row>
            <entry>IsDefault</entry>
            <entry>No</entry>
            <entry>Only one style is available per layer.</entry>
          </row>    
          <row>
            <entry>FeatureTypeStyle</entry>
            <entry>Yes</entry>
            <entry>MapServer has a concept of one feature type style per layer (either point, line, polygon, or raster).</entry>
          </row>              
        </tbody>
      </tgroup>
    </table>           
    <para>
      
    </para>    
        </listitem>
        <listitem>
    <table frame='all'><title>FeatureTypeStyle</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Name</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row>             
          <row>
            <entry>Title</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row> 
          <row>
            <entry>Abstract</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row>    
          <row>
            <entry>FeatureTypeName</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row>    
          <row>
            <entry>SemanticTypeIdentifier</entry>
            <entry>No</entry>
            <entry>Still an experimental element in the SLD specifications.</entry>
          </row>  
          <row>
            <entry>Rule</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
        </tbody>
      </tgroup>
    </table>             
    <para>
      
    </para>    
        </listitem>
        <listitem>
    <table frame='all'><title>Rule</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Name</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>Title</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row> 
          <row>
            <entry>Abstract</entry>
            <entry>No</entry>
            <entry>No use in the MapServer environment.</entry>
          </row>    
          <row>
            <entry>LegendGraphic</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>Filter</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>ElseFilter</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>MinScaleDenominator</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>MaxScaleDenominator</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>LineSymbolizer</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>PolygonSymbolizer</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>     
          <row>
            <entry>PointSymbolizer</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>     
          <row>
            <entry>TextSymbolizer</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>     
          <row>
            <entry>RasterSymbolizer</entry>
            <entry>Yes</entry>
            <entry>Applies for 8-bit rasters.</entry>
          </row>               
        </tbody>
      </tgroup>
    </table>     
    <para>
      
    </para>    
          <itemizedlist>
            <listitem>
              <para>
                        Filter and ElseFilter
              </para>
              <para>
                        For each rule containing a filter, there is a class created with the class expression set to reflect that filter. Available filters that can be used are Comparison Filters and Logical Filters (see the 
                        <ulink url="http://mapserver.gis.umn.edu/doc/filter-encoding-howto.html">Filter Encoding HOWTO</ulink>.
              </para>
              <para>
                        The ElseFilter parameters are converted into a class in MapServer and placed at the end of the class list with no expression set. They are used to render elements that did not fit into any other classes.
              </para>
            </listitem>
            <listitem>
              <para>
                        MinScaleDenomibator and MaxScaleDenominator are translated in minscale and maxscale in MapServer.
              </para>
            </listitem>
          </itemizedlist>  
          <para>
                        The following are examples of valid requests using the Filters:
          </para>
          <itemizedlist>
            <listitem>
              <para>
line with one filter: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_one_filter.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_one_filter.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
line with multiple filters: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_multi_filter.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_multi_filter.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
line with one filter and an else filter: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_one_filter_and_else.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_one_filter_and_else.xml">full request</ulink>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
    <table frame='all'><title>LineSymbolizer</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Geometry</entry>
            <entry>No</entry>
            <entry>MapServer uses the data geometry to do the rendering.</entry>
          </row>             
          <row>
            <entry>Stroke: GraphicFill</entry>
            <entry>No</entry>
            <entry>Solid color is used.</entry>
          </row> 
          <row>
            <entry>Stroke: GraphicStroke</entry>
            <entry>No</entry>
            <entry>Solid color is used.</entry>
          </row>    
          <row>
            <entry>Stroke (CssParameter): stroke</entry>
            <entry>Yes</entry>
            <entry>RGB colors are supported.</entry>
          </row>            
          <row>
            <entry>Stroke (CssParameter): width</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>Stroke (CssParameter): opacity</entry>
            <entry>No</entry>
            <entry>Not supported in MapServer.</entry>
          </row>            
          <row>
            <entry>Stroke (CssParameter): linejoin and linecap</entry>
            <entry>No</entry>
            <entry>Not supported in MapServer.</entry>
          </row>            
          <row>
            <entry>Stroke (CssParameter): dasharray</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>            
          <row>
            <entry>Stroke (CssParameter): dashoffset</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>                   
        </tbody>
      </tgroup>
    </table>                
    <para>
      
    </para>    
          <para>         
                        The following are examples of valid requests using the LineSymbolizer:
          </para>
          <itemizedlist>
            <listitem>
              <para>
Simple line: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_simple.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_simple.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
Line with width:  <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_width.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_width.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
Dash line: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_dash.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen_Outline&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_line_dash.xml">full request</ulink>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
    <table frame='all'><title>PolygonSymbolizer</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Geometry</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>Stroke</entry>
            <entry>Yes</entry>
            <entry>Strokes are the same as for the LineSymbolizer.</entry>
          </row> 
          <row>
            <entry>Fill</entry>
            <entry>Yes</entry>
            <entry>Was developed to support symbol fill polygons in addition to solid fill.</entry>
          </row>               
        </tbody>
      </tgroup>
    </table>              
    <para>
      
    </para>    
          <para> 
                        A Fill can be a solid fill or be a Graphic Fill, which is either a well-known Mark symbol (e.g., square, circle, triangle, star, cross, x) or an ExternalGraphic element (e.g., gif, png) available through a URL. 
          </para>
          <para>
                        When a Mark symbol is used in an SLD, MapServer creates a corresponding symbol in the map file and uses it to render the symbols.
          </para>
          <para>
                        When a ExternalGraphic is used, the file is saved locally and a pixmap symbol is created in the mapfile referring to the this file.  Note that the Web object <varname>IMAGEPATH</varname> is used to save the file.
          </para>
          <para>
                        The following are examples of valid requests using the PolygonSymbolizer:
          </para>
          <itemizedlist>
            <listitem>
              <para>
Simple solid fill: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_solid_fill.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_solid_fill.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
solid fill with outline: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_solid_fill_outline.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_solid_fill_outline.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
fill with mark symbol: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_fill_symbol.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_fill_symbol.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
fill with external symbol: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_fill_symbol_external.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldGen&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_polygon_fill_symbol_external.xml">full request</ulink>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
    <table frame='all'><title>PointSymbolizer</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Geometry</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>Graphic: Mark symbol</entry>
            <entry>Yes</entry>
            <entry>Well-known names (square, circle, triangle, star, cross, X) are supported.</entry>
          </row> 
          <row>
            <entry>Graphic: ExternalGraphic</entry>
            <entry>Yes</entry>
            <entry>Was developed to support symbol fill polygons in addition to solid fill.</entry>
          </row>        
          <row>
            <entry>Opacity</entry>
            <entry>No</entry>
            <entry>Not supported in MapServer.</entry>
          </row>   
          <row>
            <entry>Size</entry>
            <entry>Yes</entry>
            <entry>Not supported in MapServer.</entry>
          </row>   
          <row>
            <entry>Rotation</entry>
            <entry>No</entry>
            <entry>Not supported in MapServer.</entry>
          </row>             
        </tbody>
      </tgroup>
    </table>        
    <para>
      
    </para>    
          <para>
                        Note: Refer to the PolygonSymbolizer notes for how the Mark and ExternalGraphic symbols are applied in MapServer.
          </para>
          <para>
                        The following are examples of valid requests using the PointSymbolizer:
          </para>
          <itemizedlist>
            <listitem>
              <para>
filled mark symbol: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_symbol.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldPOI&amp;BBOX=-84.7978536015,41.440374,-75.737539764,45.97524&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_symbol.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
default settings (square, size 6, color 128/128/128):
<ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_symbol_default_settings.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldPOI&amp;BBOX=-84.7978536015,41.440374,-75.737539764,45.97524&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_symbol_default_settings.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
external symbol: <ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_symbol_external.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldPOI&amp;BBOX=-84.7978536015,41.440374,-75.737539764,45.97524&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_symbol_external.xml">full request</ulink>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
    <table frame='all'><title>TextSymbolizer</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Geometry</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>Label</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row> 
          <row>
            <entry>Font(font-family)</entry>
            <entry>Yes</entry>
            <entry>Font names used are those available in MapServer font file. If no fonts are available there, default bitmap fonts are used.</entry>
          </row>        
          <row>
            <entry>Font-style (Italic, ...)</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>   
          <row>
            <entry>Font-weight</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>   
          <row>
            <entry>Font-size</entry>
            <entry>Yes</entry>
            <entry>If true-type fonts are not used, default bitmap sizes are given.</entry>
          </row>  
          <row>
            <entry>LabelPlacement</entry>
            <entry>Yes</entry>
            <entry>Only PointPlacement is supported.</entry>
          </row>  
          <row>
            <entry>Halo</entry>
            <entry>No</entry>
            <entry>Only solid color is available.</entry>
          </row>  
          <row>
            <entry>Fill</entry>
            <entry>No</entry>
            <entry>Only solid color is available.</entry>
          </row>            
        </tbody>
      </tgroup>
    </table>        
    <para>
      
    </para>    
          <para>
                        Notes on the TextSymbolizer:
          </para>
          <itemizedlist>
            <listitem>
              <para>
                        Font names: when converting Font parameters to MapServer, the following rule is applied to get the font name: FontFamily-FontStyle-FontWeight. 
              </para>
              <para>
                        For example, if there is an SLD with a Font Family of arial, a Font Style of italic, and a Font weight equal to bold, the resulting MapServer font name is <varname>arial-italic-bold</varname>. 
              </para>
              <para>
                        Font Style and Weight are not mandatory and, if not available, they are not  used in building the font name.
              </para>
              <para>
                        When a Font Style or a Font Weight is set to <varname>normal</varname> in an SLD, it is also ignored in building the name. For example, if there is an SLD with a Font Family of arial, a Font Style of normal and a Font weight equals to bold, the resulting MapServer font name is <varname>arial-bold</varname>.
              </para>
            </listitem>
            <listitem>
              <para>
                        A TextSymbolizer can be used in MapServer either on an Annotation layer or on a Point, Line, or Polygon layer - in addition to other symbolizers used for these layers.
              </para>
            </listitem>
            <listitem>
              <para>
                        PointPacement: a point placement includes AnchorPoint (which is translated to Position in MapServer) Displacement (which is translated to Offset) and Angle (which is translated to Angle).
              </para>
            </listitem>
          </itemizedlist>
          <para>
                        The following are examples of valid requests using the TextSymbolizer:
          </para>
          <itemizedlist>
            <listitem>
              <para>
annotation layer : test for label, font, point placement, color, angle:
<ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_text_annotation.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldPlaces&amp;BBOX=-81.366241839,42.39269586,-77.8780568047,44.13861927&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_text_annotation.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
annotation layer with text and symbols using 2 symbolizers:
<ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_text_with_symbols.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldPlaces&amp;BBOX=-81.366241839,42.39269586,-77.8780568047,44.13861927&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_text_with_symbols.xml">full request</ulink>
              </para>
            </listitem>
            <listitem>
              <para>
line layer with text using 2 symbolizers:
<ulink url="http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_text_line.xml">sld</ulink> / 
<ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_world?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=WorldRoads&amp;BBOX=-81.366241839,42.39269586,-77.8780568047,44.13861927&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_text_line.xml">full request</ulink>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
    <table frame='all'><title>RasterSymbolizer</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Geometry</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>Opacity</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row> 
          <row>
            <entry>ChannelSelection</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>        
          <row>
            <entry>OverlapBehaviour</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>   
          <row>
            <entry>ColorMap</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>   
          <row>
            <entry>ContrastEnhancement</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>  
          <row>
            <entry>ShadedRelief</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>  
          <row>
            <entry>ImageOutline</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>       
        </tbody>
      </tgroup>
    </table>  
    <para>
      
    </para>    
          <para>    
                    The current support in MapServer includes only ColorMap parameter support. It can be used to classify 8-bit rasters. Inside the ColorMap parameters, the color and quantity parameters are extracted and used to do the classification.
          </para>
        </listitem>
        <listitem>
    <table frame='all'><title>ColorMap</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='c1'/>
        <colspec colname='c2'/>
        <colspec colname='c3'/>       
        <thead>
          <row>
            <entry align="center">Features</entry>
            <entry align="center">Supported</entry>
            <entry align="center">Notes</entry>                
          </row>
        </thead>      
        <tbody>
          <row>
            <entry>Color</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>             
          <row>
            <entry>Opacity</entry>
            <entry>No</entry>
            <entry> </entry>
          </row> 
          <row>
            <entry>Quantity</entry>
            <entry>Yes</entry>
            <entry> </entry>
          </row>        
          <row>
            <entry>Label</entry>
            <entry>No</entry>
            <entry> </entry>
          </row>   
        </tbody>
      </tgroup>
    </table>       
    <para>
      
    </para>    
          <para>
                        The following is an example of ColorMap usage.
          </para>
          <para>
                        If we have following ColorMap in an SLD: 
          </para>
          <programlisting>
&lt;ColorMap&gt;
&lt;ColorMapEntry color=&quot;#00ff00&quot; quantity=&quot;22&quot;/&gt; 
&lt;ColorMapEntry color=&quot;#00bf3f&quot; quantity=&quot;30&quot;/&gt; 
&lt;ColorMapEntry color=&quot;#007f7f&quot; quantity=&quot;37&quot;/&gt; 
&lt;ColorMapEntry color=&quot;#003fbf&quot; quantity=&quot;45&quot;/&gt; 
&lt;ColorMapEntry color=&quot;#0000ff&quot; quantity=&quot;52&quot;/&gt;
&lt;ColorMapEntry color=&quot;#000000&quot; quantity=&quot;60&quot;/&gt;
&lt;/ColorMap&gt;
          </programlisting>
          <para>
                        the be six classes that are created are:
          </para>
          <itemizedlist>
            <listitem>
              <para>
                        class 1 : [pixel] &gt;= 22 AND [pixel] &lt; 30 with color 00ff00
              </para>
            </listitem>
            <listitem>
              <para>
                        class 2: [pixel] &gt;= 30 AND [pixel] &lt; 37 with color 00bf3f
              </para>
            </listitem>
            <listitem>
              <para>
                        class 3 : [pixel] &gt;= 37 AND [pixel] &lt; 45 with color 007f7f
              </para>
            </listitem>
            <listitem>
              <para>
                        class 4: [pixel] &gt;= 45 AND [pixel] &lt; 52 with color 003fbf
              </para>
            </listitem>
            <listitem>
              <para>
                        class 5: [pixel] &gt;= 52 AND [pixel] &lt; 60 with color 0000ff
              </para>
            </listitem>
            <listitem>
              <para>
                        class 6: [pixel] = 60  with color 000000
              </para>
            </listitem>
          </itemizedlist>
          <para>
                        Note that the ColorMapEntry quantity parameters should be in increasing order.  
          </para>
          <para>
            Examples using 8 bits and 16 bits rasters can be seen at:
          </para>
          <itemizedlist>
            <listitem>
                <para><ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_landsat?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=landsat&amp;BBOX=302100,5029281,530271,5166822&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_raster.xml"></ulink></para>
            </listitem>
            <listitem>
                <para><ulink url="http://www2.dmsolutions.ca/cgi-bin/mswms_landsat2?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;LAYERS=golden_CO&amp;SLD=http://www2.dmsolutions.ca/msapps/world_testdata/tests/sld_tests/sld_raster_16bits.xml"></ulink></para>
            </listitem>            
          </itemizedlist>
        </listitem>
      </itemizedlist>  
    </sect2>
  </sect1>
  <sect1 id="client">
    <title>             Client Side Support</title>
    <para>
                        Client side support of the SLD consists of two parts:
    </para>
    <itemizedlist>
      <listitem>
        <para>
                        The first part is using MapServer as a WMS client to send a GetMap request with an SLD. This is done using two metadata that can be placed at a layer level in a MapServer mapfile. These two metadata are:
        </para>
        <itemizedlist>
          <listitem>
            <para>
                        <varname>wms_sld_url</varname>, which takes a valid URL as a value and  appends SLD=xxx to the GetMap request.
            </para>
          </listitem>
          <listitem>
            <para>
                        <varname>wms_sld_body</varname>, which takes a valid SLD string and appends SLD_BODY=xxx to the GetMap request. If the value of <varname>wms_sld_body</varname> is set to <varname>AUTO</varname>, MapServer generates an SLD based on the classes found in the layer and send this SLD as the value of the <varname>SLD_BODY</varname> parameter in the GetMap request.
            </para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>
                        The other major item is the generation of an SLD document from MapServer classes. These functions are currently available through MapServer/MapScript interface. Here are the functions available:
        </para>
        <itemizedlist>
          <listitem>
            <para>
                        On a map object: generatesld
            </para>
          </listitem>
          <listitem>
            <para>
                        On a layer object: generatesld
            </para>
          </listitem>
        </itemizedlist>
        <para>
                        Additional MapScript functions have been added or will be added to complement these functions:
        </para>
        <itemizedlist>
          <listitem>
            <para>
                        On a map object: applysld
            </para>
          </listitem>
          <listitem>
            <para>
                        On a layer object: applysld
            </para>
          </listitem>
        </itemizedlist>
        <para>
                        Note: When generating an SLD from MapServer classes, if there is a pixmap symbol you need to have this symbol available through a URL so it can be converted as an ExternalGraphic symbol in the SLD. To do this, you need to define the URL through a web object level metadata called <varname>WMS_SLD_SYMBOL_URL</varname> in your map file. The SLD generated uses this URL and concatenates the name of the pixmap symbol file to get the value that is generated as the ExternaGraphic URL.
        </para>
      </listitem>  
    </itemizedlist>
  </sect1>
  <sect1 id="otheritems">
    <title>             Other Items Implemented</title>
    <itemizedlist>
      <listitem>
        <para>
                        Support of filled polygons with Mark and ExternalGraphic symbols.
        </para>
      </listitem>
      <listitem>
        <para>
                        MapScript functions to parse and apply SLD.
        </para>
      </listitem>
      <listitem>
        <para>
                        <varname>SLD_BODY</varname> request support on client and server side.
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
  <sect1 id="issues">
    <title>             Issues Found During Implementation</title>
    <itemizedlist>
      <listitem>
        <para>
                        Limitation of the FilterEncoding to comparison and logical filters. The spatial filters were not made available since it required major changes in MapServer WMS support.
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
  <sect1 id="docinfo">
    <title>             About this Document</title>
        <sect2 id="rhistory">
            <title>Revision History</title>
            <para>  
  The numbering is in parallel with the revision control
  system. Missing numbers indicate minor maintenance revision updates.
</para>
            <para>
            <revhistory>
              <revision>
                <revnumber>     1.00</revnumber>
                <date>          2005-01-09</date>
                <authorinitials>Author: Jeff McKenna</authorinitials>
                <revremark>     ported to UMN docbook, minor edits</revremark>
              </revision>             
              <revision>
                <revnumber>     0.02</revnumber>
                <date>          2004-03-12</date>
                <authorinitials>Author: Darren Redfern</authorinitials>
                <revremark>     edit and DocBook translation</revremark>
              </revision>             
              <revision>
                <revnumber>     0.01</revnumber>
                <date>          2004-03-10</date>
                <authorinitials>YA</authorinitials>
                <revremark>     initial draft</revremark>
              </revision>     
            </revhistory>
            </para>
        </sect2>    
    <sect2 id="copyright">
      <title>           Copyright/Licensing Information</title>
      <para>
                        Copyright (c) 2004, Yewondwossen Assefa, DM Solutions Group Inc.
      </para>
      <para>
                    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
      </para>
      <para>
                    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
      </para>
      <para>
                    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
      </para>
    </sect2>
    <sect2 id="feedback">
      <title> Feedback</title>
      <para>
            Input is appreciated.  Send any
            comments or suggestions to the MapServer Documentation Coordinator at
            <email>mdp@lists.gis.umn.edu</email>.
        </para>
    </sect2>
  </sect1>
</article>
