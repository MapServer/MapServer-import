<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<article>
	<articleinfo>
		<title>Réference pour MapServer CGI</title>
		<author>
			<firstname>Stephen </firstname>
			<surname>Lime</surname>
			<affiliation>
				<orgname>Minnesota Department of Natural Resources</orgname>
				<address>
					<email>steve.lime@dnr.state.mn.us</email>
				</address>
			</affiliation>
		</author>
		<author>
			<firstname>Frank</firstname>
			<surname>Koormann</surname>
			<affiliation>
				<orgname>Intevation GmbH</orgname>
				<address>
					<email>frank.koormann@intevation.de</email>
				</address>
			</affiliation>
		</author>
		<othercredit>
			<contrib>Traduction</contrib>
			<firstname>Franz-Albert</firstname>
			<surname>Van Den Bussche</surname>
			<affiliation>
				<orgname>Club des Utilisateurs de Linux et des logiciels libres de Toulouse et des environs</orgname>
				<orgdiv>CULTe</orgdiv>
				<address>
					<email>franz@favdb.net</email>
				</address>
			</affiliation>
		</othercredit>
		<othercredit>
			<contrib>Relecture</contrib>
			<firstname>Nathalie</firstname>
			<surname>Vielmas</surname>
			<affiliation>
				<orgname>Club des Utilisateurs de Linux et des logiciels libres de Toulouse et des environs</orgname>
				<orgdiv>CULTe</orgdiv>
				<address>
					<email>nath31@ifrance.com</email>
				</address>
			</affiliation>
		</othercredit>
		<abstract>
			<para>        Ce document constitue la référence pour mapserv CGI version 3.6.        </para>
		</abstract>
	</articleinfo>
	<sect1 id="intro">
		<title>Documentation MapServer: Référence CGI</title>
		<para> Mapserv est la partie CGI du logiciel MapServer. Il gère les demandes d'utilisateurs et restitue les images créées ou le resultat des interrogations. Le programme accepte les données autant via les méthodes "GET" que "POST" et peut être utilisé de manière interactive ou comme moteur d'imagerie.   </para>
	</sect1>
	<!-- NOTES on syntax -->
	<sect1 id="notes">
		<title>Notes</title>
		<itemizedlist>
			<listitem>
				<para>Les noms de variable ne sont pas sensibles à la casse.</para>
			</listitem>
			<listitem>
				<para>Dans le cas où plusieurs valeurs doivent être associées à une variable (mapext par exemple), les valeurs doivent être séparées par des espaces (ou doivent être protégées comme pour les requêtes GET).</para>
			</listitem>
			<listitem>
				<para>Les contenus des variables sont contrôlés par rapport aux types de données et aux valeurs possibles.</para>
			</listitem>
			<listitem>
				<para>
                Toute variable CGI n'apparaissant pas dans la liste qui suit est simplement stockée et peut être référencée avec un <ulink url="template-reference_fr.html">fichier de calibrage</ulink>. 
            </para>
			</listitem>
		</itemizedlist>
	</sect1>
	<!-- Format -->
	<sect1 id="format">
		<title>Format</title>
		<para>Mapserv accepte les données sous la forme de variables CGI suivant la description suivante.</para>
		<sect2 id="cgi-variables">
			<title>Variables CGI</title>
			<variablelist>
				<varlistentry>
					<term>BUFFER [distance]</term>
					<listitem>
						<para>Une distance, dans le même système de coordonnées que celui du mapfile, utilisée de concert avec MAPXY pour créer un nouvel élément de carte. </para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>ID [id-string]</term>
					<listitem>
						<para> 
						Par défaut MapServer génère un identifiant unique de session basé sur l'heure du système et l'identifiant du process. Ce paramètre remplace la valeur par défaut. </para>
						<para>
						Par exemple ce paramètre peut être utilisé pour gérer des fichiers de carte personnalisés en conjonction avec la fonction SAVEMAP.
					</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>IMG</term>
					<listitem>
						<para> Le nom associé avec la carte en ligne utilisé pour enregistrer les clics de l'utilisateur. Ce sont deux variables <screen>img.x</screen> et <screen>img.y</screen> qui sont passées.</para>
						<para>Pour les applications CGI ce sont des variables essentielles,  voyez les exemples pour l'utilisation.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>IMGBOX [x1] [y1] [x2] [y2]</term>
					<listitem>
						<para> Coordonnées (en pixels) du cadre dessiné sur l'image.  La plupart du temps utilisé en conjonction avec un frontal Java pour MapServer.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>IMGEXT [minx] [miny] [maxx] [maxy]</term>
					<listitem>
						<para> L'étendue spatiale de l'image en ligne que l'utilisateur peut visualiser dans son navigateur.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>IMGSHAPE [x1 y1 x2 y2 x3 y3 ...]</term>
					<listitem>
						<para> 
                    Coordonnées de l'image Shape.
                </para>
						<para>Un polygone arbitraire devant être utilisé pour les requêtes. Plusieurs instances peuvent ajouter différents éléments d'une même carte, aussi il est possible de construire une image Shape avec des trous. A utiliser avec les modes NQUERY et NQUERYMAP. 
	            </para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>IMGSIZE [cols] [rows]</term>
					<listitem>
						<para> La taille (en pixels) de l'image en ligne.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>IMGXY [x] [y]</term>
					<listitem>
						<para> Coordonnées (en pixels) d'un simple clique de souris. Utilisé le plus souvent par une interface Java pour MapServer.</para>
					</listitem>
				</varlistentry>
				<!-- Comment by Steve Lime: Not used in version 3.5
        <varlistentry>
            <term>ITEM [name]</term>
	        <listitem>
                <para>
                    The name of an attribute in a layer attribute table. 
                    Used for item/value lookups.
	            </para>
            </listitem>
        </varlistentry>
-->
				<varlistentry>
					<term>LAYER [name]</term>
					<listitem>
						<para> Le nom d'une couche tel qu'il apparaît dans le <ulink url="mapfile-reference_fr.html">mapfile</ulink>. Envoi à mapserv le nom d'une couche dont l'état (STATUS) passera à ON.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>LAYERS [name name ...]</term>
					<listitem>
						<para> Les noms des couches qui doivent apparaître. Les noms doivent être séparés par des espaces.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MAP [filename]</term>
					<listitem>
						<para> Chemin, relatif par rapport au répertoire CGI, du <ulink url="mapfile-reference_fr.html">mapfile</ulink> à utiliser.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MAPEXT [minx] [miny] [maxx] [maxy]</term>
					<term>MAPEXT (shape)</term>
					<listitem>
						<para> La zone spatiale de la carte à créer.    </para>
						<para>Peut être renseignée avec <emphasis>shape</emphasis>. Dans ce cas MAPEXT sera renseigné automatiquement par la zone décrivant cet élément. A utiliser avec les requêtes.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MAPSIZE [cols] [rows]</term>
					<listitem>
						<para> La taille (en pixels) de l'image à créer. Particulièrement utile pour permettre à l'utilisateur de changer dynamiquement la résolution de la carte.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MAPSHAPE [x1 y1 x2 y2 x3 y3 ...]</term>
					<listitem>
						<para> Elément Shape en coordonnées de la carte.</para>
						<para> Un polygone arbitraire à utiliser pour les requêtes. Plusieurs instances ajoutent simplement des éléments aussi il est possible de construire une image Shape avec des trous. A utiliser avec les modes NQUERY et NQUERYMAP.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MAPXY [x] [y]</term>
					<term>MAPXY (shape)</term>
					<listitem>
						<para> Un point, dans le même système de coordonnées que les shapefiles, à utiliser avec une mémoire tampon (buffer) ou une échelle pour construire un élément de carte.</para>
						<para>Peut être renseigné avec <emphasis>shape</emphasis>. Dans ce cas MAPEXT sera renseigné automatiquement par la zone décrivant cet élément. A utiliser avec les requêtes.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MINX | MINY | MAXX | MAXY [number]</term>
					<listitem>
						<para> Coordonnées x minimum de la zone pour une nouvelle carte/requête. Ces ensembles de paramètres sont des éléments de MAPEXT.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>MODE [value]</term>
					<listitem>
						<para> Mode de l'opération. Les options suivantes sont autorisées: (notez que tous les modes de requêtes sont aussi applicables aux modes carte seule, par exemple ITEMQUERYMAP, lesquels ne sont listés pour être bref):</para>
						<variablelist>
							<varlistentry>
								<term>BROWSE</term>
								<listitem>
									<para> Interface totalement interactive dans laquelle les cartes (et les pages interactives) sont créées. Ceci est le mode par défaut.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>QUERY</term>
								<listitem>
									<para> Une zone de recherche (la plus proche) est matérialisée par un clique sur une carte.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>NQUERY</term>
								<listitem>
									<para> Une zone de recherche (la totalité) est matérialisée par un clique sur une carte ou par un cadre de sélection établi par l'utilisateur.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>ITEMQUERY</term>
								<listitem>
									<para> Une recherche textuelle de données "attribut" établie en utilisant une couche de filtrage FILTER.  Retourne la première correspondance.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>ITEMNQUERY</term>
								<listitem>
									<para> Une recherche textuelle de données "attribut" établie en utilisant une couche de filtrage (FILTER). Retourne toutes les correspondances.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>INDEXQUERY</term>
								<listitem>
									<para> Consulte une fonction basée sur les valeurs des paramètres SHAPEINDEX et TILEINDEX. SHAPEINDEX est obligatoire, TILEINDEX est facultatif et est utilisé seulement avec les couches shapefile assemblées. </para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>FEATUREQUERY</term>
								<listitem>
									<para> Une recherche de zone qui utilise une fonction issue de SLAYER pour interroger les autres couches.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>FEATURENQUERY</term>
								<listitem>
									<para> Une recherche de zone qui utilise diverses fonctions issues de SLAYER pour interroger les autres couches.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>ITEMFEATUREQUERY</term>
								<listitem>
									<para> Une recherche textuelle de données "attribut" établie en utilisant une couche de filtrage (FILTER).  Retourne la première correspondance. La couche cherchée est définie en utilisant le paramètre slayer. Les résultats de cette recherche sont appliqués à d'autres couches interrogeables (qui peuvent être limitées par le paramètre QLAYER).</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>ITEMFEATURENQUERY</term>
								<listitem>
									<para> Une recherche textuelle de données "attribut" établie en utilisant une couche de filtrage (FILTER). Retourne toutes les correspondances. La couche à chercher est définie en utilisant le paramètre slayer. Les résultats de cette recherche sont appliqués à d'autres couches interrogeables (qui peuvent être limitées par le paramètre QLAYER).</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>MAP</term>
								<listitem>
									<para> La carte créée est retournée. Utilisé dans l'indicateur (tag) &lt;img ... &gt; tag.     </para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>REFERENCE</term>
								<listitem>
									<para> La carte référence est retournée.  Utilisé dans l'indicateur (tag) &lt;img ... &gt; tag.    </para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>SCALEBAR</term>
								<listitem>
									<para> L'échelle créée est retournée. Utilisé dans l'indicateur (tag) &lt;img ... &gt; tag.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>LEGEND</term>
								<listitem>
									<para> La légende créée est retournée. Utilisé dans l'indicateur (tag) &lt;img ... &gt; tag.</para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>ZOOMIN</term>
								<listitem>
									<para> Modifie le mode de navigation avec ZOOMDIR=1
                   </para>
								</listitem>
							</varlistentry>
							<varlistentry>
								<term>ZOOMOUT</term>
								<listitem>
									<para> Modifie le mode de navigation avec ZOOMDIR=-1
                   </para>
								</listitem>
							</varlistentry>
			    COORDINATE
				PROCESSING
            </variablelist>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>QLAYER [name]</term>
					<listitem>
						<para> Interrogation de couche. Le nom de la couche qui doit être interrogée tel qu'il apparaît dans le <ulink url="mapfile-reference_fr.html">mapfile</ulink>. S'il n'est pas indiqué alors toutes les couches sont interrogées successivement.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>QUERYFILE [filename]</term>
					<listitem>
						<para> Utilisé avec le mode BROWSE ou NQUERY. Cette option identifie un fichier requête à charger avant tout processus régulier. Dans le mode BROWSE une carte requise produite en lieu et place d'une carte normale. Ceci est particulièrement utile quand vous voulez mettre en évidence une fonctionnalité lors d'un changement de zoom. Dans le mode NQUERY vous obtenez l'accès à tous les éléments temporaires que la requête représente, ainsi vous avez accès aux cartes requises ET aux informations d'attribut. Voyez l'option SAVEQUERY.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>REF</term>
					<listitem>
						<para> Le nom associé avec l'image de la carte référence en ligne utilisé pour enregistrer les cliques de l'utilisateur. Ce sont deux variables qui son passées, ref.x and ref.y.</para>
						<para>Pour les applications CGI il s'agit de variables essentielles quand les cartes références sont utilisées, voyez les exemples pour l'utilisation.
			  </para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>REFXY [x] [y]</term>
					<listitem>
						<para> Coordonnées (en pixels) d'un simple clique de souris sur l'image référence. Utilisé avec l'interface Java pour MapServer.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>SAVEMAP</term>
					<listitem>
						<para> Sauvegarde les paramètres de la carte dans un nouveau mapfile dans le répertoire temporaire spécifié (<ulink url="mapfile-reference_fr.html#web">imagepath</ulink>). Le fichier peut être référencé en utilisant l'indicateur (tag) [map] dans <ulink url="template-reference_fr.html">templates</ulink>. Notez que le chemin relatif dans le mapfile est relatif à la localisation du mapfile.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>SAVEQUERY</term>
					<listitem>
						<para> Utilisé avec n'importe quel autre des modes de requête ceci indique à MapServer de sauvegarder les résultats de la requête de manière à les réutiliser lors des opérations ultérieures (voir QUERYFILE). Très utile pour rendre des requêtes permanentes.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>SCALE [number]</term>
					<listitem>
						<para> Echelle à laquelle créer une nouvelle carte. Utilisé avec MAPXY. Scale est donné comme le dénominateur d'une fraction, par exemple pour une carte à l'échelle 1:24 000 utilisez 24000.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>SEARCHMAP</term>
					<listitem>
						<para> Il est possible de faire une interface pour gérer le zoom en utilisant des "cartes recherches". Dans ce cas, vous aimerez avoir l'information sur le contenu de la nouvelle carte plutôt que celle qui est affichée au fin d'interrogation. Quand SEARCHMAP est spécifié la nouvelle carte est créée et son contenu est utilisé pour les couches de recherches. Très utile seulement avec le mode NQUERY.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>SHAPEINDEX [index]</term>
					<listitem>
						<para> Utilisé pour indexer les recherches (en combinaison avec INDEXQUERY).</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>SLAYER [name]</term>
					<listitem>
						<para> Couche de sélection. Le nom de la couche devant être utilisé pour l'une quelconque des fonctions des modes de recherche (par exemple STAGED). La couche de sélection <emphasis>DOIT</emphasis> être une couche de polygone. La(les) fonction(s) de sélection est disponible pour être présentée à l'utilisateur.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>TEMPLATE [filename]</term>
					<listitem>
						<para> Nom du fichier principal de mise en forme temporaire à utiliser pour préparer les résultats. Remplace tout autre indication (dans la section WEB) dans le mapfile.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>TILEINDEX [index]</term>
					<listitem>
						<para> Utilisé pour indexer les requêtes (en combinaison avec INDEXQUERY), utilisé avec les couches de fichiers shape assemblées (tiled shapefiles).</para>
					</listitem>
				</varlistentry>
				<!-- Comment by Steve Lime: Not used in version 3.5
	        <varlistentry>
                <term>VALUE [expression]</term>
                <listitem>
                    <para> 
                        Value (regular expression) to match 
	                    against in item/value lookups.
	                </para>
                </listitem>
            </varlistentry>
-->
				<varlistentry>
					<term>ZOOM [number]</term>
					<listitem>
						<para> Echelle de zoom à appliquer lors de la création d'une nouvelle carte. Les valeurs supérieures à 0 indiquent un agrandissement, 0 pour la vue entière, et les valeurs négatives indiquent un rétrécissement. Une valeur de 2 indique "agrandissement par deux".</para>
						<para>ZOOM peut être utilisé comme raccourci de la combinaison ZOOMDIR/ZOOMSIZE.</para>
						<para>Le zoom est limité par le paramètre MINZOOM/MAXZOOM compilé dans  MapServer (-25/25) par défaut.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>ZOOMDIR [1 | 0 | -1]</term>
					<listitem>
						<para> Direction à zoomer. Voir ci-après.    </para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>ZOOMSIZE [number]</term>
					<listitem>
						<para> Grandeur absolue d'un zoom. Utilisé avec ZOOMDIR.</para>
						<para> ZOOMDIR est limité par MAXZOOM compilé dans MapServer (25 par défaut).</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<sect3 id="rosa">
				<title>ROSA-Applet specific</title>
				<para>Les paramètres de l'applet ROSA ont été ajoutés au CGI MapServer depuis la version 3.6. Cette applet Java fournit une interface utilisateur plus intuitive. Les <ulink url="http://www2.dmsolutions.ca/webtools/index.html">pages OWT </ulink> de DM Solutions fournissent les  <ulink url="http://www2.dmsolutions.ca/webtools/rosa/">informations détaillées sur l'applet ROSA</ulink>.</para>
				<para>Ces paramètres peuvent aussi être utilisés par d'autres interfaces/outils, à condition d'être correctement paramétrés. Notez que les deux paramètres doivent être gérés par l'application CGI selon l'ordre suivant.
	  </para>
				<variablelist>
					<varlistentry>
						<term>INPUT_TYPE (auto_rect | auto_point)</term>
						<listitem>
							<para>Le paramètre INPUT_TYPE est nécessaire pour identifier les coordonnées gérées par MapServer pour être interprétés comme un rectangle ou un point.</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>INPUT_COORD [minx,miny;maxx,maxy]</term>
						<listitem>
							<para>L'applet ROSA renseigne toujours la paire de coordonnées. Dans le cas d'un point (input_type=auto_point) les coordonnées min et max sont égales (Mapserver utilise la valeur min).</para>
						</listitem>
					</varlistentry>
				</variablelist>
			</sect3>
		</sect2>
		<!-- mapfile changes -->
		<sect2 id="mapfile">
			<title>Paramètres de changement du <ulink url="mapfile-reference_fr.html">mapfile</ulink> via un formulaire ou une URL</title>
			<para>Depuis la version 3.3 il est possible de changer virtuellement toute valeur du mapfile depuis un formulaire ou une URL. La syntaxe est un peu délicate. Toute valeur peut être exprimée en utilisant la hiérarchie du mapfile. Une carte contient une couche, qui contient une classe, qui contient une étiquette, qui a une couleur. Cette hiérarchie est exprimée comme une séquence de mots clés MapServer séparés par des soulignés (underscores). Par exemple pour changer la couleur d'une couche nommée "lakes" avec une seule classe définie vous devriez utiliser une variable de formulaire nommée "map_lakes_class_color" et lui assigner une couleur comme "0 0 255". Les couches peuvent être référencées par un index (par exemple map_layer_0...) ou par un nom. Les classes de couche sont référencées par une valeur d'index (comme map_layer_0_class_2). S'il n'y a qu'une seule classe pour une couche alors l'index devrait être omis. Ces variables doivent toujours commencer par la séquence "map_". Les valeurs assignées doivent être conformes à la syntaxe d'un mapfile.</para>
			<para>Il est possible de définir des fonctions en ligne en utilisant ce mécanisme. C'est le seul cas où vous pouvez ajouter des choses au mapfile.  Vous pouvez editer/changer les paramètres de couche mais vous ne pouvez pas créer une nouvelle couche. Avec les fonctions en ligne vous devez créer en premier une fonction et ensuite construire sur cette base; De toute façon, la couche à laquelle correspond la fonction doit exister. Voici un instantané d'une requête GET qui ajoute une fonction à une couche utilisateur:
        <programlisting><![CDATA[
      ...&map_webuser_feature=new&map_webuser_feature_points=12345.6789+12345.6789+map_webuser_feature_text=My+House!&...
      ]]></programlisting>
        Le "map_webuser_feature=new" crée une nouvelle fonction pour la couche utilisateur. Tous les appels ultérieurs à cet élément pour cette couche modifieront la nouvelle fonction. Vous pouvez répéter ce processus pour créer des fonctions supplémentaires. Ceci reste réellement applicable pour de très petits ensembles de données (point, rectangle).</para>
			<para>Il est fort possible que nous implémentions ici quelques informations supplémentaires sur ce processus, mais avant il nous faut un retour sur son utilité. L'une des potentialités est la possibilité d'effectuer des changements sur les classes d'expression à la volée. Donc essayez cette fonction.</para>
		</sect2>
		<!--
	<sect2 id="experimental">
		<title>Experimental</title>
		<variablelist>
        	<varlistentry>
            	<term>EGIS {none}</term>
            	<listitem>
                	<para>
                    	OV - eGIS - additional token "none" is defined to 
                    	create somewhat mutual exculsiveness between 
                    	mapserver and eGIS.
     	           </para>
        	        <para>
            	        This parameter is only available if Mapserv was 
                	    built with the <emphasis>USE_EGIS</emphasis> flag.
             	   </para>
           	 	</listitem>
        	</varlistentry>
		</variablelist>
	</sect2>
-->
	</sect1>
</article>
