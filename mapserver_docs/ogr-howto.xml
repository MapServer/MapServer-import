<?xml version="1.0" standalone="no"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<!-- $Id$ -->
<article>
	<articleinfo>
		<!-- insert title here, include the word HOWTO -->
		<title>HOWTO for OGR Use in MapServer</title>
		<author>
			<firstname>Jeff</firstname>
			<surname>McKenna</surname>
			<affiliation>
				<orgname>DM Solutions Group Inc.</orgname>
				<address>
					<email>mckenna@dmsolutions.ca</email>
				</address>
			</affiliation>
		</author>
		<date>2001-05-07</date>
		<abstract>
			<!-- a short description of the contents of the doc -->
			<para>
                 This document describes the procedures for using OGR vector data sources within MapServer applications.
               </para>
			<para>Last Updated: 05/17/2001</para>
		</abstract>
	</articleinfo>
	<sect1 id="intro">
		<title>Introduction</title>
		<para>
             Starting with version 3.5, MapServer included the ability to access 
             vector data sets in their native format using the OGR library.  
             The following document describes the process for implementing OGR support within MapServer applications.
          </para>
		<para>
			<emphasis>Note that experimental OGR support was included in MapServer version 3.4
            but this initial implementation had some limitations and is not covered in
            this document.</emphasis>
		</para>
		<para>
             This document assumes that you are already familiar with certain aspects of MapServer:
          </para>
		<itemizedlist>
			<listitem>
				<para>
                    MapServer application development and especially setting up .map files.
                </para>
			</listitem>
			<listitem>
				<para>
					Some compilation skills if you don't have ready access to a precompiled installation
                    and need to compile your own copy of MapServer with OGR support.
				</para>
			</listitem>
		</itemizedlist>
		<!-- Section2: What is OGR? -->
		<sect2 id="definition">
			<title>What is OGR?</title>
			<para>
                      The OGR Simple Features Library is a C++ open source library (and commandline tools) 
                      providing read (and sometimes write) access to a variety of vector file formats 
                      including ESRI Shapefiles, and MapInfo mid/mif and TAB formats.  
                    </para>
		</sect2>
		<!-- Section2: What does it add to MapServer? -->
		<sect2 id="addtition">
			<title>What Does OGR Add to MapServer?</title>
			<para>
                      The OGR Simple Features Library allows MapServer users to display several types of vector data files in their native
                      formats.  For example, MapInfo Mid/Mif and TAB data do not need to be converted to ESRI shapefiles 
                      when using OGR support with MapServer.
               </para>
		</sect2>
		<!-- Section2: What formats are supported? -->
		<sect2 id="supported">
			<title>What Data Formats are Supported?</title>
			<para>
                See <ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/ogr_formats.html">http://gdal.velocet.ca/projects/opengis/ogrhtml/ogr_formats.html</ulink> for 
                the latest list of supported formats.
                At the date this document was written, the following formats were supported:
               </para>
			<itemizedlist>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_shapefile.html">ESRI Shapefiles</ulink>,
                        </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_mitab.html">MapInfo TAB and  
					   MIF/MID files</ulink>,
				    </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_tiger.html">TIGER/Line file sets</ulink>,
				    </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_ogdi.html">OGDI Vectors</ulink>,
				    </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_s57.html">IHO S-57 datasets</ulink>,
				    </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_ntf.html">UK.NTF</ulink> (National 						   Transfer Format),
				    </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_sdts.html">SDTS TVP</ulink> (Topological 					   Vector Profile and Point Profile datasets),
				    </para>
				</listitem>
				<listitem>
					<para>
						<ulink url="http://gdal.velocet.ca/projects/opengis/ogrhtml/drv_pg.html">PostgreSQL</ulink>.
				    </para>
				</listitem>
			</itemizedlist>
			<para>
				<emphasis>Note1: Some of the above formats (e.g. OGDI) have external dependencies
                    and are not always included in the precompiled binary distributions of MapServer with OGR support.
                    </emphasis>
			</para>
			<para>
				<emphasis>Note2: Some of the above formats are not well suited
                    for random access by nature, that's the case of MapInfo MIF/MID files which is a
                    TEXT format and will give very poor performance for a web application.  
                    On the other hand, some binary formats such as MapInfo TAB are better suited for 
                    random access and will give performance comparable to native shapefile access 
                    in Mapserver.
                    </emphasis>
			</para>
		</sect2>
		<!-- Section2: More information on the OGR project -->
		<sect2 id="information">
			<title>How to Get More Information on the OGR Project</title>
			<para>
                      More information on the OGR Simple Features Project can be found at 
                      <ulink url="http://gdal.velocet.ca/projects/opengis/">
                      http://gdal.velocet.ca/projects/opengis/</ulink>.
               </para>
			<para>
		            The main developer of the OGR library is Frank Warmerdam.
		        <address>
					<email>warmerda@home.com</email>
				</address>
			</para>
			<para>
                      The integration of OGR within MapServer was done by Daniel Morissette.
                  <address>
					<email>morissette@dmsolutions.ca</email>
				</address>
			</para>
		</sect2>
	</sect1>
	<!-- Section1: obtaining and installing -->
	<sect1 id="obtain">
		<title>Obtaining and Compiling MapServer with OGR Support</title>
		<para>
			<emphasis>TODO: this is still incomplete</emphasis>
			<itemizedlist>
				<listitem>
					<para>
						Follow the instructions on the OGR page to compile/install OGR (actually GDAL since OGR is part of the GDAL library):
                        <ulink url="http://gdal.velocet.ca/projects/opengis/">http://gdal.velocet.ca/projects/opengis/</ulink>.
                    </para>
				</listitem>
				<listitem>
					<para>
						Obtain the MapServer source from: <ulink url="http://mapserver.gis.umn.edu/dload.html">http://mapserver.gis.umn.edu/dload.html</ulink>.
                    </para>
				</listitem>
			</itemizedlist>
		</para>
		<para>
			 For UNIX users, see the <emphasis>README.CONFIGURE</emphasis> file in the MapServer source, or see
			the UNIX/MapServer HOWTO at <ulink url="http://mapserver.gis.umn.edu/doc/unix-install-howto.html">					http://mapserver.gis.umn.edu/doc/unix-install-howto.html</ulink>.  
	     </para>
		<para>
		     For Windows users, it is recommended to look for a precompiled binary on the MapServer
             site at <ulink url="http://mapserver.gis.umn.edu/win32binaries.html">http://mapserver.gis.umn.edu/win32binaries.html</ulink>  
             (<emphasis>Unfortunately there is no 3.5 executable with OGR support on this site yet.</emphasis>).
             If you want to compile your own then see the <emphasis>README.WIN32</emphasis> file in the MapServer source.
	     </para>
	</sect1>
	<!-- Section1: Integration or developing  an application-->
	<sect1 id="integrate">
		<title>Integrating OGR Support with MapServer Applications</title>
		<para>
                The only change that is needed to integrate OGR support with a MapServer
                application is with the .map file.  The LAYER's DATA parameter is replaced by
                two parameters (CONNECTIONTYPE OGR, and CONNECTION):
             </para>
		<programlisting>
	LAYER
	   ...
	   CONNECTIONTYPE OGR
	   CONNECTION "ogr_connection_string"
	   ...
	END
              </programlisting>
		<para>
                 -where the "ogr_connection_string" is:  &lt;dataset_filename&gt;[,&lt;layer_index&gt;].
          </para>
		<para>
                &lt;dataset_filename&gt;  is:
          </para>
		<para>
			<itemizedlist>
				<listitem>
					<para>
	                     the filename of the data set (including the extension);
	                </para>
				</listitem>
				<listitem>
					<para>
	                     this is the location of the file relative to the location of the .map file.
	               </para>
				</listitem>
			</itemizedlist>
		</para>
		<para>
		     <emphasis>NOTE:</emphasis> SHAPEPATH parameter is ignored when accessing OGR data sources.
	     </para>
		<para>
                &lt;layer_index&gt; is:
                     </para>
		<para>
			<itemizedlist>
				<listitem>
					<para>
	                     optional,
	                </para>
				</listitem>
				<listitem>
					<para>
	                     the OGR layer index number,
	                </para>
				</listitem>
				<listitem>
					<para>
	                     0 by default (the first layer). 
	                </para>
				</listitem>
			</itemizedlist>
		</para>
		<para>
	                    The OGRINFO program can be used to find out the layer indices in a data set.
	        </para>
		<!-- Section2: Examples of Layer Definitions Using OGR -->
		<sect2 id="examples">
			<title>Examples of Layer Definitions Using OGR</title>
			<example>
				<title>
				MapInfo TAB file
			</title>
				<programlisting>
	LAYER
	   NAME "Builtup_Areas_tab"
	   TYPE POLYGON
	   CONNECTIONTYPE OGR
	   CONNECTION "data/tab/092b06_builtup_a.tab"
	   STATUS ON
	   CLASS
	     ...
	   END
	...
	END
               </programlisting>
			</example>
			<example>
				<title>
                    TIGER/Line file
               </title>
				<programlisting>
	LAYER
	   NAME "Roads_tig"
	   TYPE LINE
	   CONNECTIONTYPE OGR
	   CONNECTION "data/tgr_roads.rt1"
	   STATUS ON
	   CLASS
	     ...
	   END
	...
	END
               </programlisting>
			</example>
		</sect2>
		<!-- Section2: How to Use OGRINFO -->
		<sect2 id="ogrinfo">
			<title>How to Use "OGRINFO"</title>
			<para>
				OGRINFO is part of the GDAL/OGR distribution.  It is an executable that can be used 
                to obtain layer information about OGR supported files.  The parameters
				are:
			</para>
			<programlisting>
	ogrinfo [-ro] [-q] datasource_name [layer [layer...]]
			</programlisting>
			<itemizedlist>
				<listitem>
					<para>
			     -ro opens the file as read only (optional)
			  </para>
				</listitem>
				<listitem>
					<para>
			     -q executes in quiet mode, only the layer idex line will be returned (optional)
			  </para>
				</listitem>
				<listitem>
					<para>
			     datasource_name is the filename including extension (eg. roads.tab)
			  </para>
				</listitem>
			</itemizedlist>
			<sect3 id="example">
				<title>Examples of OGR in use:</title>
				<example>
					<title>
                         To get the list of layers in a file:
			         </title>
					<programlisting>
    $ ogrinfo  popplace.tab

    Had to open data source read-only.
    INFO: Open of `popplace.tab'
    using driver `MapInfo File' successful.
    1: popplace (Point)
			    </programlisting>
					<para>
						<literallayout>   which shows that there is one point layer in the popplace.tab file.</literallayout>
					</para>
				</example>
				<example>
					<title>
                        To get a dump of a specific layer, including field names, projection, etc:
                   </title>
					<programlisting>
    $ ogrinfo popplace.tab popplace

    Had to open data source read-only.
    INFO: Open of `popplace.tab'
    using driver `MapInfo File' successful.

    Layer name: popplace
    Geometry: Point
    Feature Count: 497
    Layer SRS WKT: PROJCS["unnamed",GEOGCS["unnamed",DATUM["North ...snipped...
    AREA: Real (15.3)
    PERIMETER: Real (15.3)
    POPPLACE_: Real (11.0)
    POPPLACE_I: Real (15.0)
    NAME: String (50.0)
    OGRFeature(popplace):1
      AREA (Real) =           0.000
      PERIMETER (Real) =           0.000
      POPPLACE_ (Real) =           1
      POPPLACE_I (Real) =               1
      NAME (String) = Port Hope Simpson
      POINT (2437287.249 1153656.751)

    OGRFeature(popplace):2
      AREA (Real) =           0.000
      PERIMETER (Real) =           0.000
      POPPLACE_ (Real) =           2
      POPPLACE_I (Real) =               1
      NAME (String) = Hopedale

    ...
    ...
                </programlisting>
				</example>
			</sect3>
		</sect2>
		<sect2 id="queries">
			<title>Queries Through OGR Format</title>
			<para>
				OGR layers can be queried the same way as regular shapefiles in MapServer.
			</para>
		</sect2>
		<sect2 id="formatinfo">
			<title>Format-Specific Information</title>
			<para>
                   This section will contain any format-specific issues that are discovered over time.
              </para>
		</sect2>
	</sect1>
	<!-- Section1: FAQ -->
	<sect1 id="FAQ">
		<title>FAQ / Common Problems</title>
		<sect2>
			<title>What Does "OGR" Stand For?</title>
			<para>
                   Basically, OGR does not stand for anything.  For a detailed explanation of how OGR was named, see Frank
                   Warmerdam's OGR site at <ulink url="http://gdal.velocet.ca/projects/opengis"> 					              http://gdal.velocet.ca/projects/opengis</ulink> in the section 'OGR and OpenGIS'.
              </para>
		</sect2>
	</sect1>
	<!-- Section1: Document Info -->
	<sect1 id="docinfo">
		<title>About This Document</title>
		<sect2 id="copyright">
			<title>Copyright Information</title>
			<para>
                Copyright (c) 2001, Jeff McKenna, DM Solutions Group Inc.
            </para>
			<para>
                This documentation is covered by the same Open Source license as the
                MapServer software itself.  See MapServer's 
                <ulink url="http://mapserver.gis.umn.edu/license.html">License and 
                Credits</ulink> page for the complete text.
            </para>
		</sect2>
		<sect2 id="disclaimer">
			<title>Disclaimer</title>
			<para>
     				No liability for the contents of this document can be accepted.
    				Use the concepts, examples and other content at your own risk.
    				As this is a new edition of this document, there may be errors
    				and inaccuracies that may be damaging to your system.
    				Although this is highly unlikely, the author(s) do not take any 
    				responsibility for that:  proceed with caution.
                 	</para>
		</sect2>
		<!-- Section2: feedback -->
		<sect2 id="feedback">
			<title>Feedback</title>
			<para>
    				This is a new document for a new project; input is appreciated.  Send any
    				comments or suggestions to the MapServer Documentation Coordinator at
    				<email>mdp@lists.gis.umn.edu</email>.
   			</para>
		</sect2>
	</sect1>
</article>
