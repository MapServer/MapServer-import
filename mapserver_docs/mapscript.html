<html>
  <head>
      <title>MapServer - Documentation: MapScript Reference</title>
      <script language="javascript" src="javascript/include.js"></script>
  </head>
  <body bgcolor="#FFFFFF" marginheight=0 marginwidth=0 style="margin:0px">

    <script language="javascript">header("doc");</script>

    <a name="top">
    <FONT FACE="arial,helvetica" COLOR="#3366cc" SIZE=+2><B>MapScript</B></FONT>
    <p>

    <b>Overview:</b> MapScript is a scripting interface for the MapServer. It allows users to more easily build custom applications by hiding
    much of the complexity of the C API behind a simple object-oriented scripting interface. MapScript currently exists as a <a 
    href="http://www.perl.com/">Perl 5</a> module, but it could also made for <a href="http://www.tclconsortium.org">TK/TCL</a>, 
    <a href="http://www.python.org">Python</a> and <a href="http://java.sun.com/">Java</a>.
    <p>
    The orginization of MapScript is very close to that of a <a href="mapfile.html">map file</a>. It does <b>not</b> give you the
    functionality of the MapServer CGI program, rather it gives you the necessary pieces to build your own custom versions for use on the
    web or as standalone programs. Here's a simple perl example that loads a map file, creates an image and saves it

    <pre>
      #!/usr/bin/perl

      use mapscript;

      $map = new mapObj('example.map) or die('Unable to open mapfile.');
      $img = $map->draw() or die('Unable to draw map');
      mapscript::msSaveImage($img, 'example.gif', $map->{interlace}, $map->{transparent});
    </pre>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" SIZE=+1"><B>Usage</B></FONT>
    <p>
    <b>Perl</b> - use mapscript;
    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" SIZE=+1"><B>Constants</B></FONT>
    <p>
    Many <a href="mapfile.html">map file</a> paramters take constant values. The following constants are available in MapScript.
    <p>
    <ul>
      <table cellpadding="5" cellspacing="1" border="0" width="640">
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">boolean values</font></td><td bgcolor="#CCCCCC">MS_TRUE, MS_FALSE, MS_ON, MS_OFF, MS_YES, MS_NO</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">map units</font></td><td bgcolor="#CCCCCC">MS_INCHES, MS_FEET, MS_MILES, MS_METERS, MS_KILOMETERS, MS_DD</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">layer types</font></td><td bgcolor="#CCCCCC">MS_POINT, MS_LINE, MS_POLYGON, MS_POLYLINE, MS_RASTER, MS_ANNOTATION</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">font types</font></td><td bgcolor="#CCCCCC">MS_TRUETYPE, MS_BITMAP</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">label positions</font></td><td bgcolor="#CCCCCC">MS_UL, MS_LR, MS_UR, MS_LL, MS_CR, MS_CL, MS_UC, MS_LC, MS_CC, MS_AUTO</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">symbol set types</font></td><td bgcolor="#CCCCCC">MS_MARKERSET, MS_LINESET, MS_SHADESET</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">shapefile types</font></td><td bgcolor="#CCCCCC">MS_SHP_POINT, MS_SHP_ARC, MS_SHP_POLYGON, MS_SHP_MULTIPOINT</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">query/join types</font></td><td bgcolor="#CCCCCC">MS_SINGLE, MS_MULTIPLE</td></tr>
      </table>
    </ul>
    <p>
    For example, in perl the syntax is $mapscript::MS_ON or $mapscript::MS_OFF.

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" SIZE="+1"><B>Classes/Objects</B></FONT>
    <p>
    Access to the MapServer API is provided largely through a series classes. These classes allow the programmer to:
    <ul>
      - manipulate virtually all aspects of a <a href="mapfile.html">mapfile</a><br> 
      - draw entire maps, layers or individual shapes<br>
      - perform spatial queries using points, areas or other features<br>
      - read/write shapefiles
    </ul>
    The main MapScript classes are given in the table below. Each is described in detail later in this document.
    <p>
    <ul>
      <table cellpadding="5" cellspacing="1" border="0" width="640">
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">mapObj</font></td><td bgcolor="#CCCCCC">holds all <a href="mapfile.html">map file</a> parameters</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">layerObj</font></td><td bgcolor="#CCCCCC">holds all layer parameters, exists within a mapObj</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">classObj</font></td><td bgcolor="#CCCCCC">holds all class parameters, exists within a layerObj</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">featureObj</font></td><td bgcolor="#CCCCCC">holds attributes for a single inline feature, exists within a layerObj</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">queryResultObj</font></td><td bgcolor="#CCCCCC">holds the results of a spatial query (e.g. by point, area or feature)</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">pointObj</font></td><td bgcolor="#CCCCCC">simple class to hold a 2-D point</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">lineObj</font></td><td bgcolor="#CCCCCC">a lineObj is made up of pointObjs, may or may not be a closed ring</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">shapeObj</font></td><td bgcolor="#CCCCCC">a shapeObj is made up of lineObjs</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">rectObj</font></td><td bgcolor="#CCCCCC">class used to represent a 2-D rectangle, defined using minimum and maximum x and y coordinates</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">shapefileObj</font></td><td bgcolor="#CCCCCC">class used to access spatial information (i.e. features) stored in an <a http://www.esri.com">ESRI</a> shapefile</td></tr>
        <tr><td valign="top" align="right" bgcolor="#3366cc"><font color="#ffffff">labelCacheMemberObj</font></td><td bgcolor="#CCCCCC">holds a single element from the label cache</td></tr>    
      </table>
    </ul>

    <p><FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>mapObj</b></font>
    <ul>
      <b>Constructor:</b>
      <ul>
        new mapObj(filename)</font>, for example $map = new mapObj('foo.map'); If the filename is undefined an empty mapObj is created 
        and initialized.
      </ul>
      <p>
      <b>Members:</b> See the <a href="mapfile.html">map file</a> documentation for a list of parameters that can be changed. To get/set layer 
      parameters you'll need to use one of the methods defined below. Parameters that consist of a list (eg. size) can be accessed using
      individual list members- see below. All parameter names <b>are</b> to be given in lowercase. Only members not described via the map file 
      documentation will be detailed for any mapscript objects. There are no seperate objects defined for legends, reference maps or scalebars
      since all of their parameters can be accessed via a mapObj. SymbolSets and the fontSet are not available via MapScript yet.
      <p>
      <ul>
        <li> map, scalebar, and reference map <b>size</b> use <b>height</b> and <b>width</b> (eg. $map->{scalebar}->{width} = 250;)<br>    
        <li> map extent is actually a rectObj (see below)<br>
        <li> legend <b>keysize</b> use <b>keysizex</b> and <b>keysizey</b><br>
        <li> legend <b>keyspacing</b> use <b>keyspacingx</b> and <b>keyspacingy</b><br>
        <li> numlayers - number of layers in the map, read-only<br>
      </ul>
      <p>
      Here are some examples of member access:
      <p>
      <ul>
        $map->{extent}->{minx} = $minx;<br>
        $map->{name} = 'test';<br>
        $map->{scalebar}->{color} = $map->addColor($r, $g, $b);<br>
        $map->{interlace} = $mapscript::MS_TRUE;<br>
        $n = $map->{numlayers}; # numlayers is read-only
      </ul>
      <p>
      <b>Methods:</b>
      <ul>
        <i>integer addColor(red, green, blue)</i> - Adds a color to maps palette, returns a color index. Color values can range from 0 to 255. 
           Must be called prior to running draw() or prepareImage().<p>

        <i>image draw()</i> - renders a map, returns an image.<p>

        <i>image drawQueryMap()</i> - renders a query map, returns an image.<p>

        <i>integer drawLabelCache(image)</i> - renders the labels for a map. This is also done as part of the draw() method, but may need to called when 
           using other object draw methods. Returns -1 for failure.<p>

        <i>image drawLegend()</i> - renders a legend, returns an image.<p>

        <i>image drawReferenceMap()</i> - renders a reference map, returns an image.<p>

        <i>image drawScalebar()</i> - renders a scalebar, return an image.<p>

        <i>integer embedLegend()</i> - embeds a legend. Actually the legend is just added to the label cache so you must invoke drawLabelCache() 
           to actually do the rendering (unless postlabelcache is set).<p>

        <i>integer embedScalebar()</i> - embeds a scalebar. Actually the scalebar is just added to the label cache so you must invoke 
           drawLabelCache() to actually do the rendering (unless postlabelcache is set).<p>

        <i>layerObj getLayer(index)</i> - returns a layerObj given an index value. 0 returns first layer and so on. Total number of layers defined 
           in a map file is $map->{numlayers}.<p>

        <i>layerObj getLayerByName(name)</i> - returns a layerObj given a layer name. 0 returns first layer and so on. Total number of layers 
           defined in a map file is $map->{numlayers}. If multiple layers exist with the same name the first occurance is returned.<p>

        <i>integer getSymbolByName(type, name)</i> - returns the symbol index for a symbol of type MS_MARKERSET, MS_LINESET or MS_SHADESET given a 
           name. Returns -1 if the symbol is not found.<p>

        <i>labelCacheMemberObj nextLabel()</i> - allows you to step through the label cache. One reason to do this would be to produce an imagemap 
           based on the annotation. Another would be to further post process a map by avoiding text. Returns a reference to a labelCacheMemberObj.<p>

        <i>image prepareImage()</i> - initializes an image for drawing a map, return an image. Must be called prior to calling the draw methods 
           for other objects.<p>

        <i>queryResultObj queryByPoint(point, type, buffer)</i> - queries a mapfile (i.e. a group of layers) using a point. Type is MS_SINGLE or 
           MS_MULTIPLE depending on how many results you want. Defaults to tolerances set in the mapfile but can use a constant buffer instead. 
           Returns queryResultObj.<p>

        <i>queryResultObj queryByRect(rect)</i> - queries a mapfile (i.e. a group of layers) using a rectangle. Returns queryResultObj.<p>

        <i>queryResultObj queryByFeature(results)</i> - queries a mapfile (i.e. a group of layers) using a another set of results. Returns 
           queryResultObj.<p>

        <i>integer save(filename)</i> - Writes the contents of the mapfile to disk. Returns -1 for failure.<p>

        <i>integer setProjection(parameters)</i> - Sets the projection and coordinate system for the map. Returns -1 for failure. Parameters 
           are given as a single string of comma delimited PROJ.4 parameters. For example, "proj=utm,ellps=GRS80,zone=15,north,no_defs".<p>
        
        Here's an example that prints the string and bounding polygon(s) for all labels in the cache that are actually drawn:
      <pre>
      while($label = $map->nextLabel()) {
        if($label->{status}) {
          print $label->{string} ."\n";

          $shape = $label->{poly};
          for($i=0; $i<$shape->{numlines}; $i++) {
            $part = $shape->get($i);
            for($j=0; $j<$part->{numpoints}; $j++) {
              $point = $part->get($j);
              print $point->{x} .",". $point->{y} ." ";
            }
            print "\n";
          }
        }
      }
      </pre>

      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>layerObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new layerObj(map), for example $layer = new layerObj($map); Normally you obtain layerObj from an existing layer within a map, however, 
        you can create a new layer (within a mapObj definition).
      </ul>
      <p>
      <b>Members:</b> See the <a href="mapfile.html">map file</a> documentation for a list of parameters that can be changed.<p>
      <ul>
        <li> numclasses - number of classes in the layer, read-only<br>
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>classObj getClass(index)</i> - returns a classObj given an index value. 0 returns first class and so on. Total number of classes 
           defined in a layer is $class->{numclasses}.<p>

        <i>integer draw(map, image)</i> - draws a single layer and adds labels to the cache if required. Returns 0 for success and -1 otherwise.<p>

        <i>queryResultObj queryByPoint(map, point, type, buffer)</i> - queries a single layer using a point. Type is MS_SINGLE or MS_MULTIPLE 
           depending on how many results you want. Defaults to tolerances set in the mapfile but can use a constant (buffer) instead. Returns 
           queryResultObj.<p>

        <i>queryResultObj queryByRect(map, rect)</i> - queries a single layer using a rectangle. Returns queryResultObj.<p>

        <i>queryResultObj queryByFeature(map, results)</i> - queries a single layer using a another set of results. Returns queryResultObj.<p>

        <i>integer setProjection(parameters)</i> - Sets the projection and coordinate system for the map. Returns -1 for failure. Parameters 
           are given as a single string of comma delimited PROJ.4 parameters. For example, "proj=utm,ellps=GRS80,zone=15,north,no_defs".<p>
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>queryResultObj</b></font>
    <ul>  
      <b>Members:</b>
      <ul>
        <li> numresults - total number of matching records<br>
        <li> numquerylayers - total number of layers searched
      </ul>
      <p>
      <b>Methods:</b>
      <ul>
        <i>shapeResultObj next()</i> - returns the next result record. Each record (shapeResultObj) contains 4 index values: layer (layer number), 
           tile (always -1 for now), shape (record number), and query (query number)<p>

        <i>free()</i> - free's memory associated with this result set. Since there is no constructor there is no deconstructor so you must call 
           this method or live with a memory leak.
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>classObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new classObj(layer), for example $class = new classObj($layer);  - provides all access to all class parameters (color, symbol, label, etc...). Normally you obtain a classObj from an existing class within a layer, however, you can create a new class (within a layer definition).
      </ul>
      <p>
      <b>Members:</b> See the <a href="mapfile.html">map file</a> documentation for a list of parameters that can be changed.<br>
      <p>
      <b>Methods:</b> none<br>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>pointObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new pointObj(), for example $point = new pointObj();
      </ul>
      <p>
      <b>Members:</b> <br>
      <ul>
        <li> x - x coordinate<br>
        <li> y - y coordinate
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>integer draw(map, layer, image, class, text)</i> - draws an individual point using layer. The class string is used to classify the point based on the classes defined for layer. The text string is used to annotate the point. Returns 0 for success and -1 otherwise.
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>lineObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new lineObj(), for example $line = new lineObj();
      </ul>
      <p>
      <b>Members:</b> <br>
      <ul>
        <li> numlines - number of lines (i.e. parts) in this shape, read-only<br>
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>add(point)</i> - adds a point to the end of a line.
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>shapeObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new shapeObj(type), for example $shape = new shapeObj($mapscript::MS_POLYGON);<p>
        The type parameter is just a general type used to make MapScript less bulky. With
        it MapScript can make decisions in a few comparision methods (eg. contains or intersects)
        without having to have a bunch of type specific methods. Type is not used in any other
        way right now, so often a value of -1 should suffice. Other valid values are: MS_POINT,
        MS_LINE and MS_POLYGON. Other shape creation methods (see shapefileObj) populate this
        parameter correctly.
      </ul>
      <p>
      <b>Members:</b> <br>
      <ul>
        <li> bounds - a rectObj containing the shapes bounding box, if available<br>
        <li> numlines - number of lines (i.e. parts) in this shape, read-only<br>
        <li> type - generic type (MS_POINT, MS_LINE, MS_POLYGON) of this shape<br>
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>add(line)</i> - adds a line to the shape.<p>
        <i>integer draw(map, layer, image, class, text)</i> - draws an individual shape using layer. The class string is used to classify the point based on the classes defined for layer. The text string is used to annotate the shape. Returns 0 for success and -1 otherwise.
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>featureObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new featureObj(layer), for example $feature = new featureObj($layer);
      </ul>
      <p>
      <b>Members:</b> <br>
      <ul>
        <li> class - used to classify the feature if multiple classes are defined for layer<br>
        <li> text - used to annotate the feature
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>add(line)</i> - adds a line to the feature.
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>rectObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new rectObj()</font>, for example $rect = new rectObj();
      </ul>
      <p>
      <b>Members:</b> <br>
      <ul>
        <li> minx, miny, maxx, maxy
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>integer draw(map, layer, image, class, text)</i> - draws an individual rectangle using layer. The class string is used to classify 
           the point based on the classes defined for layer. The text string is used to annotate the rectangle. Returns 0 for success and -1 
           otherwise.<p>

        <i>double fit(height, width)</i> - adjusts a rectangle (eg. an extent) to fit an image size. The cellsize (in map units) is returned.
      </ul>
    </ul>

    <p>
    <FONT FACE="arial,helvetica" COLOR="#3366cc" size="+0"><b>shapefileObj</b></font>
    <ul>
      <b>Constructor:</b> <br>
      <ul>
        new shapefileObj(filename, type)</font>, for example $shapefile = new shapeObj('lakes'); No extension is necessary. For existing files type should be -1, to create an empty file set type to one of: MS_SHP_POINT,
        MS_SHP_ARC, MS_SHP_POLYGON, or MS_SHP_MULTIPOINT. To close a shapefile you've been writing to you need to undefine the perl reference (i.e. undef $shapefile; or $shapefile = '';).
      </ul>
      <p>
      <b>Members:</b> <br>
      <ul>
        <li> numshapes - number of shapes in the shapefile, read-only<br>
        <li> type - type of shapefile, read-only<br>
        <li> bounds - a rectObj containing the shapefiles bounding box<br>
      </ul>
      <p>
      <b>Methods:</b> <br>
      <ul>
        <i>get(index, shape)</i> - retrieves a shape by index.<p>

        <i>getExtent(index, rect)</i> - retrieves a shape's bounding box by index.<p>

        <i>add(shape)</i> - appends a shape to an open shapefile.
      </ul>
    </ul>

    <FONT COLOR="#3366cc" SIZE=+1" FACE="arial,helvetica"><B>Miscelaneous Functions</B></FONT>
    <p>
    MapScript supports a few miscelaneous functions for image handling. They are:
    <ul>
      <i>msSaveImage(image, filename, transparent, interlace)</i> - saves an image to a file. Set filename to undef to save to stdout. The 
         transparent and interlace flags are boolean values.<p>

      <i>msFreeImage(image)</i> - free the memory associated with an image.
    </ul>
    <p>
    <FONT COLOR="#3366cc" FACE="arial,helvetica" SIZE=+1"><B>Error Handling</B></FONT>
    <p>
    
  <script language="javascript">footer();</script>


