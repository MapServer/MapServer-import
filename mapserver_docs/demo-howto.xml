<?xml version='1.0'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
          "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">

<article>

<articleinfo>
<title>MapServer Demo Application Installation Instructions</title>
  <author>
     <firstname>Pericles S.</firstname>
     <surname>Nacionales</surname>
     <affiliation>
        <orgname>University of Minnesota, Department of Forest Resources</orgname>
        <orgdiv>TerraSIP Project</orgdiv>
        <address>
            <email>pnaciona@gis.umn.edu</email>
        </address>
     </affiliation>
  </author>

  <abstract>
    <para>
      This document provides basic instructions on setting up the MapServer Demo
      Application. It assumes that the MapServer CGI program (e.g. mapserv or
      mapserv.exe) has been installed on the web server's cgi-bin directory.</para>

    <para>Last Updated:  05-11-2001</para>
  </abstract>

</articleinfo>

<sect1 id='intro'>
  <title>Introduction</title>
  <para> This document describes how to set the map and template file
  parameters so that it works with the installed mapserver CGI software and the
  demo dataset.It is assumed that the MapServer CGI program (mapserv or
  mapserv.exe) has been compiled and installed in the web server's cgi-bin
  directory, and that the web server is running. Although this document might 
  seem targeted for the Unix users, special instructions for Windows users 
  are provided.</para>

  <para>Note on WINDOWS, UNIX, and URL paths usage:
  When specifying paths or subdirectories, WINDOWS uses the
  backslash (\) while UNIX uses the forward slash (/). When writing a path as URL,
  always use the forward slash.</para>
</sect1>


<sect1 id="install">
  <title>Installation</title>
  <para>If you have not already done so, decompress and untar the
  ms_demo package into a web accessible directory (e.g. <filename>/home/httpd/htdocs</filename>
  or <filename class="directory">C:\Inetpub\wwwroot</filename>).</para>
  <para>One of the two example commands below can do the trick for
  you.</para>

  <para><command>gunzip -c ms_demo.tar.gz | tar xvf</command></para>

  <para><command>tar xzvf ms_demo.tar.gz</command></para>

  <para>(If you have Windows, WinZip or similar utilities can
  decompress this package for you.)</para>
  <para>As an example, I will extract my files in <filename class="directory">/home/httpd/htdocs</filename>
  which is also my web root directory. If I use Windows NT and IIS 4.0, I would
  have extracted the files in <filename class="directory">C:\Inetpub\wwwroot</filename>. This should
  decompress several files in a directory tree as below:</para>
  <simplelist>
    <member><filename class="directory">
           /home/httpd/htdocs/ms_demo</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">/data</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">/graphics</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">/perl</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">/symbols</filename></member>
  </simplelist>

  <para>Or in Windows NT:</para>
  <simplelist>
    <member><filename class="directory">
           C:\Inetpub\wwwroot\ms_demo</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">\data</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">\graphics</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">\perl</filename></member>
    <member>&nbsp;&nbsp;<filename class="directory">\symbols</filename></member>
  </simplelist>

  <para>To make this demo application work with your MapServer, you will need to edit
  three files--the application initialization html file, the map file, and the
  main html template file.</para>


  <sect2 id="init">
    <title>The <filename>demo_init.html</filename> File</title>
    <para>One of the three files, in this demo, that the user has to
    edit is the <filename>demo_init.html</filename> file. This is an html form that
    submits the initial parameters to the MapServer CGI. You need to make sure that the correct
    MapServer CGI program is being called. In UNIX, the program is typically
    called <command>mapserv</command> and is invoked from the cgi-bin directory as     <command>/cgi-bin/mapserv</command>.
    In Windows NT, it's typically called <command>mapserv.exe</command> and invoked as
    <command>/cgi-bin/mapserv.exe</command>. Look for the line:</para>

    <para><programlisting><![CDATA[
<form method="GET" action="/cgi-bin/mapserv">
    ]]></programlisting></para>

    <para>and change as appropriate. Unix users typically don't have to
    change this and Windows users will have to add the <filename>.exe
    </filename> extension. Now, look for the line:</para>

    <para><programlisting><![CDATA[
<input type="hidden" name="map" value="ms_demo\demo.map">
    ]]></programlisting></para>

    <para>and change it with the new path of your demo.map. In my
    example, this should now look like:</para>

    <para><programlisting><![CDATA[
<input type="hidden" name="map" value="/home/httpd/htdocs/ms_demo/demo.map">
    ]]></programlisting></para>

    <para>or in Windows NT,</para>

    <para><programlisting><![CDATA[
<input type="hidden" name="map" value="c:\Inetpub\wwwroot\ms_demo\demo.map">
    ]]></programlisting></para>

    <para>That is all that needs to be done with this file.</para>
  </sect2>


  <sect2 id="mapfile">
    <title>The Map File</title>

    <para>The map file is the MapServer application's configuration
    file. This is where you specify paths to the template files and datasets. The
    demonstration map file, demo.map, contains such paths which must be edited before the
    application actually works.</para>

    <para>Open demo.map in your favorite text editor. If you are using
    Windows, this is where the slashes becomes problematic. Most of the paths
    specified in the map file refers to the local subdirectories and not the URL paths.
    There is, however, an instance where you need to specify a URL path and that is
    with the keyword IMAGEURL. Look at the lines:</para>

    <para><programlisting><![CDATA[
IMAGEPATH /usr/local/apache/htdocs/tmp/
IMAGEURL /tmp/
    ]]></programlisting></para>

    <para>In my example, I will have to replace the IMAGEPATH line with:</para>

    <para><programlisting><![CDATA[
IMAGEPATH /home/httpd/htdocs/tmp/
    ]]></programlisting></para>

    <para>If I don't have a <filename>tmp</filename> subdirectory in         <filename>/home/httpd/htdocs</filename>,
    I will have to create it and make sure that web users have write permission to it.
    Make sure to have the extra slash at the end of the path.</para>

    <para>In Windows NT, I will have to change the IMAGEPATH line to:</para>

    <para><programlisting><![CDATA[
IMAGEPATH C:\Inetpub\wwwroot\tmp\
    ]]></programlisting></para>

    <para>If this <filename>tmp</filename> subdirectory doesn't exist in my web
    server, I would have to create it and give web users permissions to write to it.
    I will leave the IMAGEURL line as it is. IMAGEURL tells mapserver where 
    the mapserver-generated images are located, relative to the web root directory.</para>

        <para>
        Version 3.4 and higher uses a unified symbol file format which means you can
        store all symbols in one file. This allows for inline definitions (i.e.
        within a mapfile) of symbols and more straight forward mapscript access.
        Anyway here's what's needed to switch for newer versions of MapServer:
        </para>
        <orderedlist>
          <listitem><para>The lines starting with SHADESET, MARKERSET, AND 
           LINESET and the last END keyword should be deleted.</para></listitem>
          <listitem><para>"SYMBOLSET symbol/symbol.sym" should be added
           </para></listitem>
          <listitem><para>Make the new symbols.sym file by concatenating the 
           three symbol files together.
          The new symbols.sym file is also avialable online at <ulink 
          url="http://www2.dmsolutions.ca/mapserver/dl/symbols-for-ms34.sym">
          http://www2.dmsolutions.ca/mapserver/dl/symbols-for-ms34.sym</ulink>
          </para></listitem>
          <listitem><para>Get your gifs and pngs sorted out if you've switched over to png.
          </para></listitem>
          <listitem><para>Styled is no longer supported, you can delete them.
          </para></listitem>
          <listitem><para>Refer to png or gif symbols directly, not via the symbol file.
          </para></listitem>
        </orderedlist>


    <para>These should be the only things you need to change in <filename>demo.map</filename>.</para>
  </sect2>


  <sect2 id="template">
    <title>The HTML Template File</title>

    <para>The demo.html template file is used by MapServer to provide an interface and as a
    mechanism for delivering the generated graphics and other data. For the
    purpose of this demo application, you only need to make sure that the line</para>

    <para><programlisting><![CDATA[
<form method="GET" action="/cgi-bin/mapserv">
    ]]></programlisting></para>

    <para>points to the proper CGI program. This is probably correct for UNIX but
    will need to be modified to</para>

    <para><programlisting><![CDATA[
<form method="GET" action="/cgi-bin/mapserv.exe">
    ]]></programlisting></para>

    <para>for Windows.</para>

    <note> <title>Note</title>
    <para>
    You can not load the demo.html directly since it is a
    template file. Although it looks like a normal HTML file, the demo.html
    cannot be loaded directly on a browser as it needs parameters from the 
    MapServer CGI.</para></note>


    <para>After completing all the changes to the three files above, you should now
    have a working demo application. To test your application, open a web
    browser and enter the URL to the <filename>demo_init.html</filename>. This should
    be something like:</para>

    <para><ulink url="http://your.host.name/ms_demo/demo_init.html">
    http://your.host.name/ms_demo/demo_init.html</ulink></para>

    <para>where "your.host.name" should be replaced by your web server's
    address. In the event that your demo installation does not work, check for
    misspellings and/or look at some of the common error messages below. Also,
    check the subsection on debugging error messages to get some basic understanding
    on how to debug your MapServer applications.</para>
  </sect2>


  <sect2 id="error">
    <title>Common Error Messages</title>

    <para>Pointing a browser at <ulink     url="http://host/ms_demo/demo_init.html">http://host/ms_demo/demo_init.html</ulink>
    and pressing the 'initialize' button yields:</para>
   
    <variablelist>
      <varlistentry>
      <term><errorname>msLoadMap(): Unable to access file. (/ms_demo/demo.map)</errorname></term>
      <listitem>
        <para>You probably forgot to specify the complete path to the map file in
        <filename>demo_init.html</filename>. For example, change:</para>

        <para><programlisting><![CDATA[
<input type="hidden" name="map" value="ms_demo/demo.map">
        ]]></programlisting>

        to:

        <programlisting><![CDATA[
<input type="hidden" name="map" value="/var/www/htdocs/ms_demo/demo.map">
        ]]></programlisting></para>
      </listitem>
      </varlistentry>

      <varlistentry>
      <term><errorname>loadSymbol(): GD library error</errorname></term>
      <listitem>
        <para>This can occur if you have a new version (&gt;1.6(?)) of the GD library
        installed which doesn't support GIF images, And, you have a symbol file which
        contains a gif image. A workaround is to comment out all sections of the .map
        file which refer to the gif-containing symbol file, and the layers which refer
        to those symbols. For example:</para>

        <programlisting>
        <![CDATA[
#MARKERSET symbols/marker.sym
...
#LAYER
# NAME roads
# MAXSCALE 300000
# STATUS ON
# DATA ctyrdln3
# TYPE ANNOTATION
# LABELITEM &quot;road_name&quot;
# CLASS
# COLOR 255 255 255
# SYMBOL 'county_highway_shield' # &lt;= the 'bad' line
# LABEL
# MINFEATURESIZE 40
# MINDISTANCE 150
# POSITION CC
# SIZE TINY
# COLOR 0 0 0
# END
# END
#END # county road annotation
        ]]>
        </programlisting>
 
        <para>Alternatively, just comment out the CLASS section rather than
        the whole layer.</para>
      </listitem>
      </varlistentry>

      <varlistentry>
      <term><errorname>msDrawReferenceMap(): GD library error. Unable
        to initialize image.</errorname></term>
      <listitem>
        <para>This is probably the same problem as the previous one: no GIF support. Check
        and see if the REFERENCE image is a .GIF. If it is comment out the REF code
        block. (This is a workaround, not a fix.)</para>
      </listitem>
      </varlistentry>

      <varlistentry>
      <term><errorname>msLoadMap(): Premature End-of-File. Undefined symbol.</errorname></term>
      <listitem>
        <para>You have an unclosed object or class construct and the End Of File was
        encountered before mapserve found and END statement. Usually means an END
        statement was forgotten or inadvertantly commented out. (All object
        constructions must have an END. Study the LAYER construct in the previous
        section for an example).</para>
      </listitem>
      </varlistentry>
    </variablelist>
  </sect2>


  <sect2 id="debug">
    <title>Debugging Error Messages</title>

    <para>How to interpret the error messages you may see. For an example we'll use:
    <errorname> loadString(): Incorrect data type. (105):(3) </errorname>
    The function "loadString" failed because it was fed an incorrect data
    type; it was expecting a string and recieved a number. The error occured in
    line# 3 of the .map file (the line count starts at 0). The last set of brackets 
    contain the line number:</para>

    <para><errorname> (3) # line 3</errorname></para>

    <para>the previous brackets contain the value mapserv choked on:</para>

    <para><errorname> (105) # the line in the mapfile was: NAME 105d11</errorname></para>

    <para>So mapserver parsed "NAME 105d11" as an integer when a
    string was expected. In this example the solution is to make
    sure you quote values when you need them interpreted as
    characters rather than numbers:</para>

    <para><errorname> NAME &quot;105d11&quot;</errorname></para>

  </sect2>
</sect1>


<sect1 id="info">
  <title>Further Information</title>

  <para>The instructions provided here are meant to help you get your demo application
  working. Changing the template and map files should give you an
  understanding of the basic capabilities of MapServer. If you need further
  examples, there is a MapServer tutorial available at
  <ulink url="http://terrasip.gis.umn.edu/projects/tutorial">
  http://terrasip.gis.umn.edu/projects/tutorial</ulink>.
  For the Windows NT version of this tutorial, please visit 
  <ulink url="http://128.101.73.80/projects/tutorial">
  http://128.101.73.80/projects/tutorial</ulink>.
  Of course, documentation and other forms of support, including the mapserver-users
  listserv archives can be found at http://mapserver.gis.umn.edu.</para>
</sect1>

<sect1 id="ack">
  <title>Acknowledgements</title>
  <para>This demonstration application was created, and is being provided, by Steve
  Lime <email>steve.lime@dnr.state.mn.us</email>.
  The sections Common Error Messages and Debugging Error Messages were kindly
  provided by Matt Wilkie <email>Matt.Wilkie@gov.yk.ca</email>.</para>
</sect1>

</article>
