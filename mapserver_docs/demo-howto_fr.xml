<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" "http://mapserver.gis.umn.edu/mdp/docbkx412/docbookx.dtd">
<article>
	<articleinfo>
		<title>Instructions pour l'installation de l'application de démonstration MapServer</title>
		<author>
			<firstname>Pericles S.</firstname>
			<surname>Nacionales</surname>
			<affiliation>
				<orgname>University of Minnesota, Department of Forest Resources</orgname>
				<orgdiv>TerraSIP Project</orgdiv>
				<address>
					<email>pnaciona@gis.umn.edu</email>
				</address>
			</affiliation>
		</author>
		<othercredit>
			<contrib>Traduction</contrib>
			<firstname>Franz-Albert</firstname>
			<surname>Van Den Bussche</surname>
			<affiliation>
				<orgname>Club des Utilisateurs de Linux et des logiciels libres de Toulouse et des environs</orgname>
				<orgdiv>CULTe</orgdiv>
				<address>
					<email>franz@favdb.net</email>
				</address>
			</affiliation>
			<contrib>Relecture</contrib>
			<firstname>Nathalie</firstname>
			<surname>Vielmas</surname>
			<affiliation>
				<orgname>Club des Utilisateurs de Linux et des logiciels libres de Toulouse et des environs</orgname>
				<orgdiv>CULTe</orgdiv>
				<address>
					<email>nath@favdb.net</email>
				</address>
			</affiliation>
		</othercredit>
		<abstract>
			<para>Ce document donne les instructions de base pour la mise en oeuvre de l'application de démonstration de MapServer. Il est considéré ici que le programme CGI de MapServer CGI (mapserv ou mapserv.exe) a été installé sur le serveur oueb dans le répertoire cgi-bin.</para>
			<para>Dernière mise à jour:  17-07-2001</para>
		</abstract>
	</articleinfo>
	<sect1 id="intro">
		<title>Introduction</title>
		<para>Ce document décrit comment mettre en oeuvre et paramétrer les fichiers .map et de mise en forme pour un fonctionnement sur le logiciel CGI MapServer de l'ensemble des données de démonstration. Nous considèrerons que le programme CGI de MapServer (mapserv ou mapserv.exe) a été compilé et installé dans le répertoire cgi-bin du serveur oueb, et que ce serveur fonctionne. Ce document a été établi pour les utilisateurs Unix, mais des instructions particulières pour les utilisateurs Windows sont indiquées.</para>
		<para>Note sur les chemins pour WINDOWS, UNIX, et les URL:
  Lorsque vous spécifiez un chemin ou un sous répertoire, WINDOWS utilise le backslash (\) alors que UNIX utilise le slash normal (/). Pour l'URL, c'est toujours le slash normal qui est utilisé.</para>
		<note>
			<title>Démonstration MapServer 3.5</title>
			<para>Steve Lime a produit une nouvelle démonstration MapServer pour être utilisée avec la version 3.5.  Elle peut être obtenue depuis <ulink url="http://maps.dnr.state.mn.us/mapserver_demos/itasca.tar.gz">
  http://maps.dnr.state.mn.us/mapserver_demos/itasca.tar.gz</ulink>
			</para>
		</note>
	</sect1>
	<sect1 id="install">
		<title>Installation</title>
		<para>Si vous ne l'avez déjà fait, décompressez et détarez le paquetage ms_demo dans un répertoire accessible par le oueb (<filename>/home/httpd/htdocs</filename> ou <filename class="directory">C:\Inetpub\wwwroot</filename>).</para>
		<para>L'une des deux commandes suivantes devrait réaliser celà pour vous.</para>
		<para>
			<command>gunzip -c ms_demo.tar.gz | tar xvf</command>
		</para>
		<para>
			<command>tar xzvf ms_demo.tar.gz</command>
		</para>
		<para>(Sous Windows, WinZip ou un utilitaire similaire peut décompresser ce paquetage pour vous.)</para>
		<para>En guise d'exemple, je vais extraire mes fichiers dans <filename class="directory">/home/httpd/htdocs</filename> qui est aussi mon répertoire maître pour le serveur oueb. Si j'avais utilisé Windows NT et IIS 4.0, j'aurais extrait les fichiers dans <filename class="directory">C:\Inetpub\wwwroot</filename>. Ceci devrait générer plusieurs fichiers dans l'arbre de répertoire suivant:</para>
		<simplelist>
			<member>
				<filename class="directory">
           /home/httpd/htdocs/ms_demo</filename>
			</member>
			<member><filename class="directory">/data</filename>
			</member>
			<member><filename class="directory">/graphics</filename>
			</member>
			<member><filename class="directory">/perl</filename>
			</member>
			<member><filename class="directory">/symbols</filename>
			</member>
		</simplelist>
		<para>Ou pour Windows NT:</para>
		<simplelist>
			<member>
				<filename class="directory">
           C:\Inetpub\wwwroot\ms_demo</filename>
			</member>
			<member><filename class="directory">\data</filename>
			</member>
			<member><filename class="directory">\graphics</filename>
			</member>
			<member><filename class="directory">\perl</filename>
			</member>
			<member><filename class="directory">\symbols</filename>
			</member>
		</simplelist>
		<para>Pour que l'application de démonstration fonctionne avec votre MapServer, vous devez modifier trois fichiers--le fichier HTML d'initialisation, le fichier mapfile, et le fichier principal de mise en forme.</para>
		<sect2 id="init">
			<title>Le fichier <filename>demo_init.html</filename></title>
			<para>L'un des trois fichiers, dans la démonstration, que l'utilisateur doit modifier est le fichier <filename>demo_init.html</filename>. C'est un fichier au format HTML qui soumet les paramètres initiaux au CGI de MapServer. Vous devez vérifier que c'est le bon programme CGI de MapServer qui sera appelé. Pour UNIX, le programme se nomme <command>mapserv</command> et est appelé depuis le répertoire cgi-bin  sous la forme <command>/cgi-bin/mapserv</command>.
 Pour Windows NT, il se nomme <command>mapserv.exe</command> et est appelé sous la forme <command>/cgi-bin/mapserv.exe</command>. Cherchez la ligne:</para>
			<para>
				<programlisting><![CDATA[
<form method="GET" action="/cgi-bin/mapserv">
    ]]></programlisting>
			</para>
			<para>et changez ce qu'il faut. En principe pour les utilisateurs Unix vous n'avez pas besoin de changer quoi que ce soit et pour les utilisateurs Windows vous devriez avoir à ajouter l'extension <filename>.exe</filename> . Maintenant, cherchez la ligne:</para>
			<para>
				<programlisting><![CDATA[
<input type="hidden" name="map" value="ms_demo\demo.map">
    ]]></programlisting>
			</para>
			<para>et changez la pour le nouveau chemin de votre fichier demo.map. Dans mon exemple, ceci devrait donner:</para>
			<para>
				<programlisting><![CDATA[
<input type="hidden" name="map" value="/home/httpd/htdocs/ms_demo/demo.map">
    ]]></programlisting>
			</para>
			<para>ou pour Windows NT,</para>
			<para>
				<programlisting><![CDATA[
<input type="hidden" name="map" value="c:\Inetpub\wwwroot\ms_demo\demo.map">
    ]]></programlisting>
			</para>
			<para>C'est tout pour ce fichier.</para>
		</sect2>
		<sect2 id="mapfile">
			<title>Le MapFile</title>
			<para>Le mapfile est le fichier de configuration applicatif de MapServer. C'est dans ce fichier que vous spécifiez les chemins vers le fichier de mise en forme et vers les données. Le fichier mapfile de démonstration, contient de tels chemins qui doivent être modifiés avant que l'application ne puisse fonctionner.</para>
			<para>Ouvrez demo.map avec votre éditeur de texte habituel. Si vous êtes sous Windows, c'est ici que les slashes deviennent problématiques. Plusieurs des chemins dans ce fichier font référence à des répertoires locaux et pas à des URL. Il y a, de toute façon, un élément où vous devez spécifier un chemin d'URL et c'est celui indiqué par le mot clé IMAGEURL. Cherchez les lignes:</para>
			<para>
				<programlisting><![CDATA[IMAGEPATH /usr/local/apache/htdocs/tmp/IMAGEURL /tmp/]]></programlisting>
			</para>
			<para>Dans mon exemple, j'ai remplacé la ligne IMAGEPATH par:</para>
			<para>
				<programlisting><![CDATA[IMAGEPATH /home/httpd/htdocs/tmp/]]></programlisting>
			</para>
			<para>Si je n'ai pas de sous-répertoire <filename>tmp</filename>  dans <filename>/home/httpd/htdocs</filename>, je devrais le créer et m'assurer que les utilisateurs oueb auront le droit d'y écrire. Vérifier qu'il y a bien un slash en fin du chemin.</para>
			<para>Pour Windows NT, j'aurai besoin de changer la ligne IMAGEPATH en:</para>
			<para>
				<programlisting><![CDATA[IMAGEPATH C:\Inetpub\wwwroot\tmp\]]></programlisting>
			</para>
			<para>Si le sous-répertoire <filename>tmp</filename> n'existe pas dans mon serveur oueb je devrais le créer et veiller à ce que les utilisateurs aient le droit d'y écrire. IMAGEURL indique à MapServer que les images générées sont mises dans le répertoire, relatif au répertoire maître du oueb.</para>
			<para>La version 3.4 et les suivantes, a défini le format du fichier symbole permettant de stocker tous les symboles dans un unique fichier. Ceci permet les définitions en ligne (au sein du mapfile) des symboles et un accès plus direct du mapscript. De toute façon, voici ce qui est nécessaire pour basculer vers les nouvelles versions de MapServer:
        </para>
			<orderedlist>
				<listitem>
					<para>Les lignes commençant par SHADESET, MARKERSET, AND LINESET et se terminant par le mot clé END doivent être supprimées.</para>
				</listitem>
				<listitem>
					<para>"SYMBOLSET symbol/symbol.sym" doit être ajouté
           </para>
				</listitem>
				<listitem>
					<para>Fabriquez le nouveau fichier symbols.sym en concaténant les trois fichiers de symbole ensemble. Le nouveau fichier symbols.sym est aussi disponible sur <ulink url="http://www2.dmsolutions.ca/mapserver/dl/symbols-for-ms34.sym">http://www2.dmsolutions.ca/mapserver/dl/symbols-for-ms34.sym</ulink>
					</para>
				</listitem>
				<listitem>
					<para>Triez vos fichier GIF et PNG si vous voulez alterner.
          </para>
				</listitem>
				<listitem>
					<para>Les styles ne sont plus disponibles, vous pouvez les supprimer.
          </para>
				</listitem>
				<listitem>
					<para>Faites référence aux symboles PNG ou GIF directement, et non via le fichier symbole.
          </para>
				</listitem>
			</orderedlist>
			<para>C'est tout ce que vous devez changer dans le fichier <filename>demo.map</filename>.</para>
		</sect2>
		<sect2 id="template">
			<title>Le fichier HTML de mise en forme</title>
			<para>Le fichier de mise en forme demo.html est utilisé par MapServer pour fournir une interface et un mécanisme pour générer les images et autres données. Pour cette application de démonstration, vous devez simplement vérifier que la ligne</para>
			<para>
				<programlisting><![CDATA[
<form method="GET" action="/cgi-bin/mapserv">
    ]]></programlisting>
			</para>
			<para>pointe vers le programme CGI correct. C'est probablement correct pour UNIX mais devra être modifié en</para>
			<para>
				<programlisting><![CDATA[
<form method="GET" action="/cgi-bin/mapserv.exe">
    ]]></programlisting>
			</para>
			<para>pour Windows.</para>
			<note>
				<title>Note</title>
				<para>Vous ne pouvez pas charger directement demo.html puisqu'il s'agit d'un fichier de mise en forme. Il ressemble à un fichier HTML normal, mais ne peut pas être chargé directement par un navigateur parce qu'il a besoin de paramètres qui lui sont fournis par le CGI de MapServer.</para>
			</note>
			<para>Après avoir terminé les modifications des trois fichiers précédents, vous devriez disposer maintenant d'une application fonctionnelle. Pour le vérifier, ouvrez votre navigateur oueb et donnez l'URL du <filename>demo_init.html</filename>. Ceci devrait vous retourner quelque chose comme:</para>
			<para>
				<ulink url="http://your.host.name/ms_demo/demo_init.html">
    http://your.host.name/ms_demo/demo_init.html</ulink>
			</para>
			<para>où "your.host.name" devrait être remplacé par l'adresse de votre serveur oueb. Pour le cas où votre installation ne fonctionne pas, vérifiez les erreurs d'orthographe et/ou cherchez dans la partie des messages d'erreur habituels ci-après. Vérifiez aussi la partie des messages d'erreur de mise au point qui pourrait vous donner quelques indications de base pour comprendre comment débugger vos applications MapServer.</para>
		</sect2>
		<sect2 id="error">
			<title>Messages d'erreur habituels</title>
			<para>Avec votre navigateur allez sur l'adresse <ulink url="http://host/ms_demo/demo_init.html">http://host/ms_demo/demo_init.html</ulink> et appuyez sur le bouton d'initialisation ('initialize'):</para>
			<variablelist>
				<varlistentry>
					<term>
						<errorname>msLoadMap(): Unable to access file. (/ms_demo/demo.map)</errorname>
					</term>
					<listitem>
						<para>Vous avez oublié probablement le chemin complet vers le mapfile dans <filename>demo_init.html</filename>. Par exemple, changez:</para>
						<para>
							<programlisting><![CDATA[
<input type="hidden" name="map" value="ms_demo/demo.map">
        ]]></programlisting>

        en:

        <programlisting><![CDATA[
<input type="hidden" name="map" value="/var/www/htdocs/ms_demo/demo.map">
        ]]></programlisting>
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<errorname>loadSymbol(): GD library error</errorname>
					</term>
					<listitem>
						<para>Ceci peut se produire si vous avez une nouvelle version (&gt;1.6(?)) de la bibliothèque GD qui ne dispose pas des images GIF, et que vous avez un fichier symbole qui contient une image GIF. Un moyen de résoudre ce problème est de mettre en commentaire la partie du fichier .map qui fait référence à ces symboles. Par exemple:</para>
						<programlisting><![CDATA[
#MARKERSET symbols/marker.sym
....
#LAYER
# NAME roads
# MAXSCALE 300000
# STATUS ON
# DATA ctyrdln3
# TYPE ANNOTATION
# LABELITEM &quot;road_name&quot;
# CLASS
# COLOR 255 255 255
# SYMBOL 'county_highway_shield' # &lt;= the 'bad' line
# LABEL
# MINFEATURESIZE 40
# MINDISTANCE 150
# POSITION CC
# SIZE TINY
# COLOR 0 0 0
# END
# END
#END # county road annotation
        ]]></programlisting>
						<para>Une autre solution est de ne commenter que la partie CLASS plutôt que la totalité de la couche (LAYER).</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<errorname>msDrawReferenceMap(): GD library error. Unable
        to initialize image.</errorname>
					</term>
					<listitem>
						<para>Il s'agit probablement du même problème que précédemment: pas de support des GIF. Vérifiez si l'image REFERENCE est un .GIF. Si c'est le cas commentez le bloc de code REF. (Ceci est une solution temporaire, et non une résolution de bug.)</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<errorname>msLoadMap(): Premature End-of-File. Undefined symbol.</errorname>
					</term>
					<listitem>
						<para>Si vous n'avez pas cloturé un objet de couche ou de classe et que la fin de fichier est trouvée avant que MapServer ne trouve le mot clé END. Habituellement indique qu'un END a été oublié ou a été commenté par inadvertance. (Toute construction d'objet doit se terminer par END. Voyez la construction LAYER de l'exemple de la partie précédente).</para>
					</listitem>
				</varlistentry>
			</variablelist>
		</sect2>
		<sect2 id="debug">
			<title>Messages d'erreur de mise au point</title>
			<para>Comment interpréter les messages d'erreur que vous pouvez rencontrer. Comme exemple nous utiliserons:
    <errorname> loadString(): Incorrect data type. (105):(3) </errorname>
    La fonction "loadString" ne s'exécute pas normalement parce qu'elle a rencontré une donnée de type incorrect; elle attend une chaîne de caractères et c'est un nombre qu'elle a reçu. L'erreur s'est produite à la ligne numéro 3 du fichier .map (le compteur de ligne commence à 0). Le dernier ensemble entre parenthèse contient le numéro de la ligne:</para>
			<para>
				<errorname> (3) # line 3</errorname>
			</para>
			<para>l'ensemble entre parenthèses précédent contient la valeur concernée:</para>
			<para>
				<errorname> (105) # la ligne dans le mapfile était: NAME 105d11</errorname>
			</para>
			<para>Ainsi MapServer a interprété "NAME 105d11" comme un nombre alors qu'il attend une chaîne de caractères. Dans cet exemple la solution est de mettre les valeurs entre apostrophes lorsque vous avez besoin qu'elles soient interprétées comme chaînes de caractères plutôt que comme un nombre:</para>
			<para>
				<errorname> NAME "105d11"</errorname>
			</para>
		</sect2>
	</sect1>
	<sect1 id="info">
		<title>Imformations supplémentaires</title>
		<para>Les instructions données ici constituent une aide pour obtenir une application de démonstration fonctionnelle. En changeant les fichiers de mise en forme et de carte vous devriez apprendre les capacités de base de MapServer. Si vous avez besoin de plus d'exemples il existe un guide MapServer disponible sur <ulink url="http://terrasip.gis.umn.edu/projects/tutorial">http://terrasip.gis..umn.edu/projects/tutorial</ulink>.
  Pour une version Windows NT de ce guide allez sur <ulink url="http://128.101.73.80/projects/tutorial">http://128.101.73.80/projects/tutorial</ulink>.
  Bien entendu, la documentation et autres formes d'aide, incluant la liste mapserver-users et ses archives peuvent être trouvées sur http://mapserver.gis.umn.edu.</para>
	</sect1>
	<sect1 id="ack">
		<title>Remerciements</title>
		<para>Cette application de démonstration a été créée, et mise à disposition, par Steve Lime <email>steve.lime@dnr.state.mn.us</email>.
  Les parties messages d'erreur habituels et messages d'erreur de mise au point ont été aimablement fournies par Matt Wilkie <email>Matt.Wilkie@gov.yk.ca</email>.</para>
	</sect1>
</article>
