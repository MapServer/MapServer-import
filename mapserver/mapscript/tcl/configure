#!/bin/sh

# not a normal autoconf configure script
# grab the file ../../perlvars that mapserver made for the perl mapscript
# build, and use gcc and ld flags

if [ ! -f ../../perlvars ] ; then
   echo "you must build MapServer first."
   exit
fi

MAPSERVERHOME=`head -1 ../../perlvars | tail -1`
MAPSERVERDEFS=`head -2 ../../perlvars | tail -1`
MAPSERVERINCS=`head -3 ../../perlvars | tail -1`
MAPSERVERLIBS=`head -4 ../../perlvars | tail -1`

# check for --with-tcl= and/or --with-swig=
with_tcl=/usr/local
with_swig=/usr/local
for arg in $*
do
    case $arg in
	--help)
		echo "mapscript tcl configure options:"
		echo "--with-tcl=dir    where to find tcl"
		echo "--with-swig=dir   where to find swig"
		exit	
		;;
        --with-tcl=*)
		save_if=$IFS
		IFS==
		set -- $arg
		with_tcl=$2
		IFS=$save_ifs
		;;
	--with-swig=*)
		save_if=$IFS
		IFS==
		set -- $arg
		with_swig=$2
		IFS=$save_ifs
		;;
    esac
done


# look for Tcl configs

echo "looking for Tcl in $with_tcl"
if [ ! -f $with_tcl/lib/tclConfig.sh ] ; then
    echo "can not find tclConfig in $with_tcl"
    exit
fi
echo "                  found lib/tclConfig.sh"

# look for swig

echo "looking for Swig in $with_swig"
if [ ! -f $with_swig/include/swig.h ] ; then
    echo "can not find swig.h in $with_swig/include"
    exit
else
    echo "                  found include/swig.h"
fi
SWIGDIR=$with_swig


# source the tcl Configs

. $with_tcl/lib/tclConfig.sh
echo "tcl version = $TCL_VERSION"

# create our Makefile

echo "creating Makefile"

sed -e "s%@MAPSERVERHOME@%$MAPSERVERHOME%g" \
    -e "s%@MAPSERVERDEFS@%$MAPSERVERDEFS%g" \
    -e "s%@MAPSERVERINCS@%$MAPSERVERINCS%g" \
    -e "s%@MAPSERVERLIBS@%$MAPSERVERLIBS%g" \
    -e "s%@TCL_PREFIX@%$TCL_PREFIX%g" \
    -e "s%@TCL_EXEC_PREFIX@%$TCL_EXEC_PREFIX%g" \
    -e "s%@TCL_CC@%$TCL_CC%g" \
    -e "s%@TCL_DEFS@%$TCL_DEFS%g" \
    -e "s%@TCL_SHLIB_SUFFIX@%$TCL_SHLIB_SUFFIX%g" \
    -e "s%@TCL_SHLIB_CFLAGS@%$TCL_SHLIB_CFLAGS%g" \
    -e "s%@TCL_LD_SEARCH_FLAGS@%$TCL_LD_SEARCH_FLAGS%g" \
    -e "s%@TCL_SHLIB_LD@%$TCL_SHLIB_LD%g" \
    -e "s%@TCL_LIB_SPEC@%$TCL_LIB_SPEC%g" \
    -e "s%@TCL_STUB_LIB_SPEC@%$TCL_STUB_LIB_SPEC%g" \
    -e "s%@TCL_LIBS@%$TCL_LIBS%g" \
    -e "s%@LIB_RUNTIME_DIR@%$LIB_RUNTIME_DIR%g" \
    -e "s%@TCL_DBGX@%$TCL_DBGX%g" \
    -e "s%@SWIGDIR@%$SWIGDIR%g" \
 <Makefile.in >Makefile


