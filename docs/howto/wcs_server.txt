<div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="#intro">Introduction</a></dt><dd><dl><dt><a href="#related">WCS-Related information</a></dt><dt><a href="#software">Software Requirements</a></dt></dl></dd><dt><a href="#d45e65">Configuring your MapFile to serve WCS layers</a></dt><dd><dl><dt><a href="#d45e85">WEB object METADATA parameters</a></dt><dt><a href="#d45e257">LAYER object METADATA parameters</a></dt></dl></dd><dt><a href="#d45e380">Rules for handling SRS in a MapServer WCS</a></dt><dt><a href="#d45e385">Spatio/Temporal Indexes</a></dt><dt><a href="#d45e417">To-do items and known limitations</a></dt></dl></div><div class="sect1"><div class="titlepage"><div><h2 class="title"><a name="intro"></a>Introduction</h2></div></div><p>

      A WCS (or Web Coverage Server) allows for the publication of "coverages"- digital geospatial information representing space-varying phenomena. In the MapServer world it allows for un-filtered access to raster data. Conceptually it is easy think of WCS as a raster equivalent of WFS. The following documentation is based on the <a href="https://portal.opengeospatial.org/files/?artifact_id=3837" target="_top">Open GIS Consortium's (OGC) Web Coverage Server Interfaces Implementation Specification version 1.0.0</a>. 
    </p><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="related"></a>WCS-Related information</h3></div></div><p>Here are some WCS related links. Since these are highly detailed technical specifications, there is no need to read through them in their entirety to get a MapServer WCS up and running.  It is still recommended however to read them over and get familiar with the basics of each of them, in order to understand how it all works:</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="https://portal.opengeospatial.org/files/?artifact_id=3837" target="_top">Open GIS Consortium's (OGC) Web Coverage Server Interfaces Implementation Specification version 1.0.0</a>.</p></li></ul></div><p>Working knowledge of MapServer is of course also required.</p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="software"></a>Software Requirements</h3></div></div><p>In order to enable MapServer to serve WCS, it MUST be compiled against certain librairies:</p><div class="itemizedlist"><ul type="disc"><li><p>PROJ.4: The reprojection library. Version 4.4.3 or greater is required.</p></li><li><p>GDAL: I/O support library. Version x.x.x or greater is required.</p></li></ul></div><p>Please see the MapServer UNIX Compilation and Installation HOWTO for detailed instructions on compiling mapserver with support for these librairies and features.  For Windows users, look on the MapServer website to see if there are any binaries available that meet these requirements.</p></div></div><div class="sect1"><div class="titlepage"><div><h2 class="title"><a name="d45e65"></a>Configuring your MapFile to serve WCS layers</h2></div></div><p>Much as in the WMS and WFS support, WCS publishing is enabled by adding certain magic METADATA keyword/value pairs to a MapFile.</p><p>MapServer will serve and include in its WCS capabilities only the layers that meet the following conditions:</p><div class="itemizedlist"><ul type="disc"><li><p>Data source is of raster type that is processed using GDAL (e.g GeoTIFF, Erdas Imagine, ...)</p></li><li><p>LAYER NAME must be set</p></li><li><p>LAYER TYPE is RASTER</p></li><li><p>LAYER DUMP parameter set to TRUE</p></li></ul></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="d45e85"></a>WEB object METADATA parameters</h3></div></div><p>WCS support tries to leverage existing WMS or OWS metadata definitions. The rationale being that many values will be the same regardless of the type of service. The module will look for the following metadata prefixes (in order): wcs_, ows_ and finally wms_ unless otherwise noted.</p><div class="variablelist"><dl><dt><span class="term">metadatalink</span></dt><dd><p></p></dd><dt><span class="term">wcs_encoding</span></dt><dd><p></p></dd><dt><span class="term">description</span></dt><dd><p></p></dd><dt><span class="term">name</span></dt><dd><p></p></dd><dt><span class="term">label</span></dt><dd><p></p></dd><dt><span class="term">keywordlist</span></dt><dd><p></p></dd><dt><span class="term">fees</span></dt><dd><p></p></dd><dt><span class="term">accessconstraints</span></dt><dd><p></p></dd></dl></div><p>There are two ways to define service contact information. The WCS way (using the "responsibleparty" tags:</p><div class="variablelist"><dl><dt><span class="term">responsibleparty_individualname (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_organizationname (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_postionname (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_address_deliverypoint (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_address_city (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_address_administrativearea (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_address_postalcode (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_address_country (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_address_electronicmailaddress (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_phone_voice (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_phone_facsimile (wcs_ or ows_)</span></dt><dd><p></p></dd><dt><span class="term">responsibleparty_onlineresource (wcs_ or ows_)</span></dt><dd><p></p></dd></dl></div><p>Or using the method defined in the WMS support for mapserver:</p><div class="variablelist"><dl><dt><span class="term">contactperson</span></dt><dd><p></p></dd><dt><span class="term">contactorganization</span></dt><dd><p></p></dd><dt><span class="term">contactposition</span></dt><dd><p></p></dd><dt><span class="term">address</span></dt><dd><p></p></dd><dt><span class="term">city</span></dt><dd><p></p></dd><dt><span class="term">stateorprovince</span></dt><dd><p></p></dd><dt><span class="term">postcode</span></dt><dd><p></p></dd><dt><span class="term">country</span></dt><dd><p></p></dd><dt><span class="term">contactelectronicmailaddress</span></dt><dd><p></p></dd><dt><span class="term">contactvoicetelephone</span></dt><dd><p></p></dd><dt><span class="term">contactfacsimiletelephone</span></dt><dd><p></p></dd><dt><span class="term">service_onlineresource</span></dt><dd><p></p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="d45e257"></a>LAYER object METADATA parameters</h3></div></div><p>WCS support tries to leverage existing WMS or OWS metadata definitions. The rationale being that many values will be the same regardless of the type of service. The module will look for the following metadata prefixes (in order): wcs_, ows_ and finally wms_ unless otherwise noted.</p><div class="variablelist"><dl><dt><span class="term">metadatalink</span></dt><dd><p></p></dd><dt><span class="term">description</span></dt><dd><p></p></dd><dt><span class="term">name</span></dt><dd><p></p></dd><dt><span class="term">label</span></dt><dd><p></p></dd><dt><span class="term">keywordlist</span></dt><dd><p></p></dd><dt><span class="term">timeposition</span></dt><dd><p></p></dd><dt><span class="term">timeperiod</span></dt><dd><p></p></dd><dt><span class="term">timeitem</span></dt><dd><p>The attribute in the spatio/temporal index that contains time values</p></dd><dt><span class="term">extent</span></dt><dd><p>Must be provided with tiled data.</p></dd><dt><span class="term">srs</span></dt><dd><p></p></dd><dt><span class="term">nativeformat</span></dt><dd><p></p></dd><dt><span class="term">formats</span></dt><dd><p></p></dd></dl></div><p>Axis Descriptions: what are they? MapServer allows you define a number of these for a layer. Individual axis are identified by name when defining specific metadata (e.g. description). All defined axes must be listed in the rangeset_axes metadata tag so MapServer knows in advance what to expect. A special rangeset for multiband date is automatically generated by adding the name "bands" to the rangeset_axes list. If found MapServer will automatically generate metadata for the image bands. You may of course extend that basic support using the naming conventions below.</p><div class="variablelist"><dl><dt><span class="term">rangeset_axes</span></dt><dd><p>Delimited list of defined range sets.</p></dd><dt><span class="term">{name}_semantic</span></dt><dd><p></p></dd><dt><span class="term">{name}_refsys</span></dt><dd><p></p></dd><dt><span class="term">{name}_refsyslabel</span></dt><dd><p></p></dd><dt><span class="term">{name}_description</span></dt><dd><p></p></dd><dt><span class="term">{name}_label</span></dt><dd><p></p></dd><dt><span class="term">{name}_values</span></dt><dd><p></p></dd><dt><span class="term">{name}_values_semantic</span></dt><dd><p></p></dd><dt><span class="term">{name}_values_type</span></dt><dd><p></p></dd><dt><span class="term">{name}_interval</span></dt><dd><p>Only a single interval is supported per axis.</p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><h2 class="title"><a name="d45e380"></a>Rules for handling SRS in a MapServer WCS</h2></div></div><p>TODO!</p></div><div class="sect1"><div class="titlepage"><div><h2 class="title"><a name="d45e385"></a>Spatio/Temporal Indexes</h2></div></div><p>MapServer has long supported a method of breaking a dataset into smaller, more manageable pieces or tiles.  In this case a shapefile is used to store the boundary of each tile, and an attribute holds the location of the actual data. Within a MapServer mapfile the layer keywords TILEINDEX and TILEITEM are used to activate tiling.</p><p>Consider the example where an organization wants to serve hundreds or even thousands of MODIS scenes. Five images cover the spatial extent and each group of five varies by date of acquisition.  This turns out to be a fairly common scenario for organizations interested in WCS, one that the existing tiling support does not adequately address.  In previous versions of MapServer a developer would have to create one tile index and one layer definition for each group of five images. This could result in configuration files that are prohibitively long and difficult to manage.</p><p>In order to more efficiently support the WCS specification a new tiling scheme has been implemented within MapServer.  One that supports spatial sub-setting, but also ad hoc sub-setting based on any attributes found within tile index.  In many cases a temporal attribute could be used, but sub-setting is not limited to that case.  The new scheme introduces the concept of tile index layers, that is, a separate layer definition is used to describe the tile index dataset. With this we get all the benefits of any MapServer layer, most importantly we can apply MapServer filters to the data.  Filters can be defined at runtime using MapServer CGI, MapScript or via the WCS server interface.  The syntax for the layer using the index remains unchanged except that the value for TILEINDEX refers to the index layer instead of an external shapefile.</p><p>So, looking at the example above again we can reduce our MapServer configuration to two layer definitions, one for the tile index and one for the imagery itself.  Extracting a single dates worth of imagery is now a matter of setting the appropriate filter within the tile index layer.</p><p>Building Spatio-Temporal Tile Indexes</p><p>Developing these tile indexes is more difficult than basic indexes simply because there are no ready-made tools to do so.  Fortunately we can leverage existing tool available within MapServer or supporting libraries such as GDAL by post processing their output.</p><p>Taking the above example, building an index is relatively simple task if you are willing to roll up your sleeves and write a bit of code.  First, the basic spatial index needs to be built.  The GDAL utility gdaltindex already does this. Simply point gdaltindex at the directory containing the collection of MODIS images and it will build a shapefile index suitable for use with MapServer.  The next step would be to add the temporal information.  The pseudo code would look something like:</p><div class="itemizedlist"><ul type="disc"><li><p>open the index .dbf file for reading</p></li><li><p>create a new column to hold the image acquisition date</p></li><li><p>for each image; 1) extract the image acquisition date and 2) insert it into the new column</p></li><li><p>close the index .dbf file</p></li></ul></div><p>This general approach could be used for many cases.  A scripting language such as Perl, PHP or Python works well since they all have readily available modules for manipulating .dbf files.  A worst case would involve hand editing the resulting .dbf file using a desktop tool such as Mircosoft Access or ESRI Arcview.</p></div><div class="sect1"><div class="titlepage"><div><h2 class="title"><a name="d45e417"></a>To-do items and known limitations</h2></div></div><div class="itemizedlist"><ul type="disc"><li><p>This is the initial release of WCS support for MapServer and it has not been widely used nor tested.</p></li><li><p>For now we support only GET requests. The spec also talks about XML-encoded POST requests but that is not supported at this time. It is anticipated that a general XML request solution will be created for all OWS services.</p></li><li><p>MapServer does not derive all of the metadata it could from a given dataset. For example, you must explicitly list time periods covered by a layer. This should get better with time.</p></li><li><p>Only spatial, simple temporal and radiometric band subsetting is possible with the current implementation. Furture enhancements should allow for arbitrary subsets based on pixel values or tile/image attributes.</p></li></ul></div></div></div>